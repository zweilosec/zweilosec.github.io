<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="How to Zip and Unzip Files Using PowerShell" /><meta property="og:locale" content="en_US" /><meta name="description" content="How to Zip and Unzip Files Using the Compress-Archive and Expand-Archive PowerShell cmdlets for easier file exfiltration" /><meta property="og:description" content="How to Zip and Unzip Files Using the Compress-Archive and Expand-Archive PowerShell cmdlets for easier file exfiltration" /><link rel="canonical" href="https://zweilosec.github.io/posts/zip-unzip-files-powershell/" /><meta property="og:url" content="https://zweilosec.github.io/posts/zip-unzip-files-powershell/" /><meta property="og:site_name" content="Hackerâ€™s Rest" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-05-05T14:00:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="How to Zip and Unzip Files Using PowerShell" /><meta name="twitter:site" content="@zweilosec" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-05-05T20:34:43+00:00","datePublished":"2021-05-05T14:00:00+00:00","description":"How to Zip and Unzip Files Using the Compress-Archive and Expand-Archive PowerShell cmdlets for easier file exfiltration","headline":"How to Zip and Unzip Files Using PowerShell","mainEntityOfPage":{"@type":"WebPage","@id":"https://zweilosec.github.io/posts/zip-unzip-files-powershell/"},"url":"https://zweilosec.github.io/posts/zip-unzip-files-powershell/"}</script><title>How to Zip and Unzip Files Using PowerShell | Hacker's Rest</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Hacker's Rest"><meta name="application-name" content="Hacker's Rest"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-170504820-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-170504820-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatar/katana.gif" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Hacker's Rest</a></div><div class="site-subtitle font-italic">Notes documenting my journey to OSCP and beyond.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>PS C:\>WHOAMI</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/zweilosec" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/zweilosec" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG â€º <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>How to Zip and Unzip Files Using PowerShell</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>How to Zip and Unzip Files Using PowerShell</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> zweilosec </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, May 5, 2021, 2:00 PM +0000" prep="on" > May 5, 2021 <i class="unloaded">2021-05-05T14:00:00+00:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, May 5, 2021, 3:34 PM -0500" prefix="Updated " > May 5, 2021 <i class="unloaded">2021-05-05T20:34:43+00:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1083 words">6 min</span></div><div><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@zweilosec"></div></div><div class="post-content"><p>Recently, while working on the Hack the Box machine <a href="https://zweilosec.github.io/posts/sharp/">Sharp</a> I encountered a situation where I needed to exfiltrate a whole directory full of files and sub-folders back to my machine. Rather than trying to copy each file separately, or writing a script to recursively copy the files to my machine, I decided it would be much easier to zip the files up into one neat little package using PowerShellâ€™s built-in functionality. By using one simple PowerShell cmdlet you can compress an assortment of files into a smaller, more portable file that is much easier to exfiltrate off of a system.</p><h2 id="how-to-zip-files-using-powershell">How to Zip Files Using PowerShell</h2><h3 id="the-compress-archive-cmdlet">The <code class="language-plaintext highlighter-rouge">Compress-Archive</code> cmdlet</h3><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="n">PS</span><span class="w"> </span><span class="nx">C:\Users\User</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">Get-Help</span><span class="w"> </span><span class="nx">Compress-Archive</span><span class="w">

</span><span class="n">NAME</span><span class="w">
</span><span class="nx">Compress-Archive</span><span class="w">

</span><span class="n">SYNTAX</span><span class="w">
</span><span class="nx">Compress-Archive</span><span class="w"> </span><span class="p">[</span><span class="nt">-Path</span><span class="p">]</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">string</span><span class="p">[]</span><span class="err">&gt;</span><span class="w"> </span><span class="p">[</span><span class="nt">-DestinationPath</span><span class="p">]</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">string</span><span class="err">&gt;</span><span class="w"> </span><span class="p">[</span><span class="nt">-CompressionLevel</span><span class="w"> </span><span class="p">{</span><span class="n">Optimal</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">NoCompression</span><span class="w"> </span><span class="o">|</span><span class="w">
</span><span class="n">Fastest</span><span class="p">}</span><span class="err">]</span><span class="w"> </span><span class="p">[</span><span class="nt">-WhatIf</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="nt">-Confirm</span><span class="p">]</span><span class="w">  </span><span class="p">[</span><span class="err">&lt;</span><span class="n">CommonParameters</span><span class="err">&gt;</span><span class="p">]</span><span class="w">

</span><span class="n">Compress-Archive</span><span class="w"> </span><span class="p">[</span><span class="nt">-Path</span><span class="p">]</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">string</span><span class="p">[]</span><span class="err">&gt;</span><span class="w"> </span><span class="p">[</span><span class="nt">-DestinationPath</span><span class="p">]</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">string</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-Update</span><span class="w"> </span><span class="p">[</span><span class="nt">-CompressionLevel</span><span class="w"> </span><span class="p">{</span><span class="n">Optimal</span><span class="w"> </span><span class="o">|</span><span class="w">
</span><span class="n">NoCompression</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Fastest</span><span class="p">}</span><span class="err">]</span><span class="w"> </span><span class="p">[</span><span class="nt">-WhatIf</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="nt">-Confirm</span><span class="p">]</span><span class="w">  </span><span class="p">[</span><span class="err">&lt;</span><span class="n">CommonParameters</span><span class="err">&gt;</span><span class="p">]</span><span class="w">

</span><span class="n">Compress-Archive</span><span class="w"> </span><span class="p">[</span><span class="nt">-Path</span><span class="p">]</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">string</span><span class="p">[]</span><span class="err">&gt;</span><span class="w"> </span><span class="p">[</span><span class="nt">-DestinationPath</span><span class="p">]</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">string</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-Force</span><span class="w"> </span><span class="p">[</span><span class="nt">-CompressionLevel</span><span class="w"> </span><span class="p">{</span><span class="n">Optimal</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">NoCompression</span><span class="w">
</span><span class="o">|</span><span class="w"> </span><span class="n">Fastest</span><span class="p">}</span><span class="err">]</span><span class="w"> </span><span class="p">[</span><span class="nt">-WhatIf</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="nt">-Confirm</span><span class="p">]</span><span class="w">  </span><span class="p">[</span><span class="err">&lt;</span><span class="n">CommonParameters</span><span class="err">&gt;</span><span class="p">]</span><span class="w">

</span><span class="n">Compress-Archive</span><span class="w"> </span><span class="p">[</span><span class="nt">-DestinationPath</span><span class="p">]</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">string</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-LiteralPath</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">string</span><span class="p">[]</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-Update</span><span class="w"> </span><span class="p">[</span><span class="nt">-CompressionLevel</span><span class="w"> </span><span class="p">{</span><span class="n">Optimal</span><span class="w"> </span><span class="o">|</span><span class="w">
</span><span class="n">NoCompression</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Fastest</span><span class="p">}</span><span class="err">]</span><span class="w"> </span><span class="p">[</span><span class="nt">-WhatIf</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="nt">-Confirm</span><span class="p">]</span><span class="w">  </span><span class="p">[</span><span class="err">&lt;</span><span class="n">CommonParameters</span><span class="err">&gt;</span><span class="p">]</span><span class="w">

</span><span class="n">Compress-Archive</span><span class="w"> </span><span class="p">[</span><span class="nt">-DestinationPath</span><span class="p">]</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">string</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-LiteralPath</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">string</span><span class="p">[]</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-Force</span><span class="w"> </span><span class="p">[</span><span class="nt">-CompressionLevel</span><span class="w"> </span><span class="p">{</span><span class="n">Optimal</span><span class="w"> </span><span class="o">|</span><span class="w">
</span><span class="n">NoCompression</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Fastest</span><span class="p">}</span><span class="err">]</span><span class="w"> </span><span class="p">[</span><span class="nt">-WhatIf</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="nt">-Confirm</span><span class="p">]</span><span class="w">  </span><span class="p">[</span><span class="err">&lt;</span><span class="n">CommonParameters</span><span class="err">&gt;</span><span class="p">]</span><span class="w">

</span><span class="n">Compress-Archive</span><span class="w"> </span><span class="p">[</span><span class="nt">-DestinationPath</span><span class="p">]</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">string</span><span class="err">&gt;</span><span class="w"> </span><span class="nt">-LiteralPath</span><span class="w"> </span><span class="err">&lt;</span><span class="nx">string</span><span class="p">[]</span><span class="err">&gt;</span><span class="w"> </span><span class="p">[</span><span class="nt">-CompressionLevel</span><span class="w"> </span><span class="p">{</span><span class="n">Optimal</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">NoCompression</span><span class="w"> </span><span class="o">|</span><span class="w">
</span><span class="n">Fastest</span><span class="p">}</span><span class="err">]</span><span class="w"> </span><span class="p">[</span><span class="nt">-WhatIf</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="nt">-Confirm</span><span class="p">]</span><span class="w">  </span><span class="p">[</span><span class="err">&lt;</span><span class="n">CommonParameters</span><span class="err">&gt;</span><span class="p">]</span><span class="w">
</span></pre></table></code></div></div><p>According to Microsoftâ€™s <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.archive/compress-archive?view=powershell-7.1">documentation</a>:</p><blockquote><p>The <code class="language-plaintext highlighter-rouge">Compress-Archive</code> cmdlet creates a compressed, or zipped, archive file from one or more specified files or directories. An archive packages multiple files, with optional compression, into a single zipped file for easier distribution and storage. An archive file can be compressed by using the compression algorithm specified by the <code class="language-plaintext highlighter-rouge">CompressionLevel</code> parameter.</p></blockquote><p>Be aware that there is a limitation on the file size of archives created using this cmdlet.</p><blockquote><p>The <code class="language-plaintext highlighter-rouge">Compress-Archive</code> cmdlet uses the Microsoft .NET API <code class="language-plaintext highlighter-rouge">System.IO.Compression.ZipArchive</code> to compress files. The maximum file size is <strong>2 GB</strong> because thereâ€™s a limitation of the underlying API.</p></blockquote><p>The simplest method of using this cmdlet is to zip up all the files in a single directory.</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">Compress-Archive</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$in_path</span><span class="w"> </span><span class="nt">-DestinationPath</span><span class="w"> </span><span class="nv">$out_path</span><span class="nx">\</span><span class="nv">$out_file</span><span class="w">
</span></pre></table></code></div></div><p>From a PowerShell terminal zip up the files in the <code class="language-plaintext highlighter-rouge">$in_path</code> directory by specifying the <code class="language-plaintext highlighter-rouge">$out_path</code> and <code class="language-plaintext highlighter-rouge">$out_filename</code>. PowerShell will take everything inside of the specified directory and compress it, subfolders and all.</p><p>Note: Quotations around the file path are <strong>necessary</strong> when the file path contains a space!</p><h2 id="how-to-unzip-files-using-powershell">How to unzip files using PowerShell</h2><p>Once you copy the files to your local machine, you can use any tools or programs you have available to open the zip archive. However, if you wish to stick with using PowerShell, or must use it to extract the files on the same remote system, it is useful to know how to use the <code class="language-plaintext highlighter-rouge">Expand-Archive</code> cmdlet.</p><h3 id="the-expand-archive-cmdlet">The <code class="language-plaintext highlighter-rouge">Expand-Archive</code> cmdlet</h3><p>To recover the files from a zip archive specify the <code class="language-plaintext highlighter-rouge">$in_path</code> where the <code class="language-plaintext highlighter-rouge">$zip_file</code> is located and the <code class="language-plaintext highlighter-rouge">$out_path</code> you want the files extracted to. If you leave out the <code class="language-plaintext highlighter-rouge">-DestinationPath</code> parameter, PowerShell extracts the zip into the present working directory. PowerShell will create the folder structure inside the zip and place the contents inside. If the folder already exists in the destination, PowerShell will return an error when it tries to unzip the files. To bypass this error, you can force PowerShell to overwrite the data with by using the <code class="language-plaintext highlighter-rouge">-Force</code> parameter.</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">Expand-Archive</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$in_path</span><span class="nx">/</span><span class="nv">$zip_file</span><span class="w"> </span><span class="nt">-DestinationPath</span><span class="w"> </span><span class="nv">$out_path</span><span class="w"> </span><span class="nt">-Force</span><span class="w">
</span></pre></table></code></div></div><p>Warning: Using the <code class="language-plaintext highlighter-rouge">-Force</code> parameter will irrevocably replace currently existing files in the <code class="language-plaintext highlighter-rouge">$out_path</code> with no further warning.</p><h2 id="advanced-usage">Advanced Usage</h2><h3 id="zipping-multiple-files">Zipping multiple files</h3><p>In addition to zipping all of the files in a single directory, you can also zip multiple individual files or even multiple entire directories into one file. To do this, use a comma to separate the files and/or folders when specifying the <code class="language-plaintext highlighter-rouge">-Path</code> parameter.</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">Compress-Archive</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nx">~\.ssh</span><span class="p">,</span><span class="nx">~\Documents</span><span class="w"> </span><span class="nt">-DestinationPath</span><span class="w"> </span><span class="nv">$out_path</span><span class="nx">\</span><span class="nv">$out_file</span><span class="w">
</span></pre></table></code></div></div><p>Note: For files/folders inside the present working directory you do not need to specify a path for input files. However, you may want to always specify full paths for consistency (escpecially when embedding inside of a script).</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">Compress-Archive</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nx">Music</span><span class="p">,</span><span class="nx">Documents</span><span class="w"> </span><span class="nt">-DestinationPath</span><span class="w"> </span><span class="nv">$out_path</span><span class="nx">\</span><span class="nv">$out_file</span><span class="w">
</span></pre></table></code></div></div><p>Be aware, if you specify a folder that is empty it will not appear in your zip file!</p><h3 id="using-the-wildcard-character--to-further-control-selection-of-files">Using the wildcard character <code class="language-plaintext highlighter-rouge">*</code> to further control selection of files</h3><p>The <code class="language-plaintext highlighter-rouge">Compress-Archive</code> cmdlet lets you use a wildcard character (<code class="language-plaintext highlighter-rouge">*</code>) to further control selection of files for compression. There are three main ways you can use the wildcard character (<code class="language-plaintext highlighter-rouge">*</code>).</p><ol><li>Exclude the containing folder,<li>Compress only files inside the target directory, not folders (makes the selection non-recursive), or<li>Choose all files that match specific criteria.</ol><h3 id="zip-all-files-without-the-containing-folder">Zip all files without the containing folder</h3><p>By adding an asterisk (<code class="language-plaintext highlighter-rouge">*</code>) to the end of the file path you can tell PowerShell to only compress the files/folders inside of a directory, excluding the folder itself.</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">Compress-Archive</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$in_path</span><span class="nx">\</span><span class="o">*</span><span class="w"> </span><span class="nt">-DestinationPath</span><span class="w"> </span><span class="nv">$out_path</span><span class="nx">\</span><span class="nv">$out_file</span><span class="w">
</span></pre></table></code></div></div><h3 id="zip-only-files-in-a-folder-non-recursive">Zip only files in a folder (non-recursive)</h3><p>If you want to zip only the files in a direcrtory, excluding subdirectories, you can use the star-dot-star (<code class="language-plaintext highlighter-rouge">*.*</code>) notation.</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">Compress-Archive</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$directory</span><span class="nx">\</span><span class="o">*.*</span><span class="w"> </span><span class="nt">-DestinationPath</span><span class="w"> </span><span class="nv">$out</span><span class="nt">-path</span><span class="nx">\</span><span class="nv">$out_file</span><span class="w">
</span></pre></table></code></div></div><p>Note: This method is a hack that only works for files that have a file extension. Windows generally requires extensions, so this may not be an issue most of the time. However, be aware that files without an extension will be excluded (and folders with a <code class="language-plaintext highlighter-rouge">.</code> in the name will be included - with all files inside!).</p><h3 id="zip-all-files-that-match-specific-criteria">Zip all files that match specific criteria</h3><p>In a scenario where you have a folder with a number of different filetypes but only want to zip the files of one type you can use the wildcard to substitute for the filename and then specify the <code class="language-plaintext highlighter-rouge">$extension</code> of the filetype you wish to archive.</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">Compress-Archive</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$in_path</span><span class="nx">\</span><span class="o">*.</span><span class="nv">$extension</span><span class="w"> </span><span class="nt">-DestinationPath</span><span class="w"> </span><span class="nv">$out_path</span><span class="nx">\</span><span class="nv">$out_file</span><span class="w">
</span></pre></table></code></div></div><p>Note: This method is non-recursive and will not include files inside subdirectories.</p><h2 id="updating-an-existing-zip-archive">Updating an existing zip archive</h2><p>You can update an existing zipped file by adding the <code class="language-plaintext highlighter-rouge">-Update</code> parameter to the <code class="language-plaintext highlighter-rouge">Compress-Archive</code> cmdlet. This will allow you to replace files with newer ones of the same name, or add completely new files. This parameter can be combined with any of the previous file/folder selection methods.</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">Compress-Archive</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$in_path</span><span class="w"> </span><span class="nt">-DestinationPath</span><span class="w"> </span><span class="nv">$out_path</span><span class="nx">\</span><span class="nv">$out_file</span><span class="w"> </span><span class="nt">-Update</span><span class="w"> 
</span></pre></table></code></div></div><h2 id="references">References</h2><ul><li><a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.archive/compress-archive?view=powershell-7.1">https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.archive/compress-archive?view=powershell-7.1</a></ul><p>If you have comments, issues, or other feedback, or have any other fun or useful tips or tricks to share, feel free to contact me on Github at <a href="https://github.com/zweilosec">https://github.com/zweilosec</a> or in the comments below!</p><p>If you like this content and would like to see more, please consider buying me a coffee! <a href="https://www.buymeacoffee.com/zweilosec"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://img.buymeacoffee.com/button-api/?text=Buy me a coffee&amp;emoji=&amp;slug=zweilosec&amp;button_colour=FFDD00&amp;font_colour=000000&amp;font_family=Lato&amp;outline_colour=000000&amp;coffee_colour=ffffff" /></a></p></div><script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="zweilosec" data-description="Support me on Buy me a coffee!" data-message="If you like this content and would like to see more, please consider buying me a coffee!" data-color="#FFDD00" data-position="Right" data-x_margin="18" data-y_margin="18"></script><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/tips-tricks/'>Tips & Tricks</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/powershell/" class="post-tag no-text-decoration" >powershell</a> <a href="/tags/zip/" class="post-tag no-text-decoration" >zip</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=How to Zip and Unzip Files Using PowerShell - Hacker's Rest&url=https://zweilosec.github.io/posts/zip-unzip-files-powershell/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=How to Zip and Unzip Files Using PowerShell - Hacker's Rest&u=https://zweilosec.github.io/posts/zip-unzip-files-powershell/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=How to Zip and Unzip Files Using PowerShell - Hacker's Rest&url=https://zweilosec.github.io/posts/zip-unzip-files-powershell/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/upgrade-linux-shell/">Upgrade a linux reverse shell to a fully usable TTY shell</a><li><a href="/posts/late/">Hack The Box - Late Writeup</a><li><a href="/posts/acute/">Hack The Box - Acute Writeup</a><li><a href="/posts/jekyll-chirpy-github-pages-blog/">How to use GitHub Pages to host a blog with Jekyll Chirpy theme</a><li><a href="/posts/zip-unzip-files-powershell/">How to Zip and Unzip Files Using PowerShell</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/hacking/">hacking</a> <a class="post-tag" href="/tags/hack-the-box/">hack the box</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/redteam/">redteam</a> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/unfinished/">unfinished</a> <a class="post-tag" href="/tags/oscp/">oscp</a> <a class="post-tag" href="/tags/tj-null/">tj_null</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <script src="https://utteranc.es/client.js" repo="zweilosec/zweilosec.github.io" issue-term="title" label="comments ðŸ’¬" theme="github-dark" crossorigin="anonymous" async> </script><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/sharp/"><div class="card-body"> <span class="timeago small" > May 1, 2021 <i class="unloaded">2021-05-01T14:00:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack the Box - Sharp Writeup</h3><div class="text-muted small"><p> HTB - Sharp Overview This hard-difficulty Windows machine from Hack the Box was both challenging and fun. As the name suggests, it focuses on a few user-made code projects that use the C Sharp...</p></div></div></a></div><div class="card"> <a href="/posts/resolute/"><div class="card-body"> <span class="timeago small" > May 24, 2020 <i class="unloaded">2020-05-24T14:00:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack the Box - Resolute Writeup</h3><div class="text-muted small"><p> HTB - Resolute Overview A medium-difficulty Windows box that was fairly straightforward. Privilege escalation required going through two different users and taking advantage of Windows domain ...</p></div></div></a></div><div class="card"> <a href="/posts/monteverde/"><div class="card-body"> <span class="timeago small" > May 30, 2020 <i class="unloaded">2020-05-30T14:00:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack the Box - Monteverde Writeup</h3><div class="text-muted small"><p> HTB - Monteverde Overview Short description to include any strange things to be dealt withâ€¦when there is a proper description here the website build will stop breaking. Hopefully this is enough...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/using-github-issues-for-blog-comments/" class="btn btn-outline-primary" prompt="Older"><p>Using GitHub Issues for Blog Comments Using utteranc.es</p></a> <a href="/posts/attended/" class="btn btn-outline-primary" prompt="Newer"><p>Hack The Box - Attended Writeup</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> Â© 2023 <a href="https://twitter.com/zweilosec">zweilosec</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/hacking/">hacking</a> <a class="post-tag" href="/tags/hack-the-box/">hack the box</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/redteam/">redteam</a> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/unfinished/">unfinished</a> <a class="post-tag" href="/tags/oscp/">oscp</a> <a class="post-tag" href="/tags/tj-null/">tj_null</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://zweilosec.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
